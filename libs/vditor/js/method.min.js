/*!
 * Vditor v3.9.6 - A markdown editor written in TypeScript.
 *
 * MIT License
 *
 * Copyright (c) 2018-present B3log 开源, b3log.org
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
/******/ var __webpack_modules__ = ({

/***/ 54:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "g": () => (/* binding */ Constants)
/* harmony export */ });
/* unused harmony export VDITOR_VERSION */
var _VDITOR_VERSION = (/* unused pure expression or super */ null && ("3.9.6"));

var Constants = /** @class */ (function () {
    function Constants() {
    }
    Constants.ZWSP = "\u200b";
    Constants.DROP_EDITOR = "application/editor";
    Constants.MOBILE_WIDTH = 520;
    Constants.CLASS_MENU_DISABLED = "vditor-menu--disabled";
    Constants.EDIT_TOOLBARS = ["emoji", "headings", "bold", "italic", "strike", "link", "list",
        "ordered-list", "outdent", "indent", "check", "line", "quote", "code", "inline-code", "insert-after",
        "insert-before", "upload", "record", "table"];
    Constants.CODE_THEME = ["abap", "algol", "algol_nu", "arduino", "autumn", "borland", "bw",
        "colorful", "dracula", "emacs", "friendly", "fruity", "github", "igor", "lovelace", "manni", "monokai",
        "monokailight", "murphy", "native", "paraiso-dark", "paraiso-light", "pastie", "perldoc", "pygments",
        "rainbow_dash", "rrt", "solarized-dark", "solarized-dark256", "solarized-light", "swapoff", "tango", "trac",
        "vim", "vs", "xcode", "ant-design"];
    Constants.CODE_LANGUAGES = ["mermaid", "echarts", "mindmap", "plantuml", "abc", "graphviz", "flowchart", "apache",
        "js", "ts", "html", "markmap",
        // common
        "properties", "apache", "bash", "c", "csharp", "cpp", "css", "coffeescript", "diff", "go", "xml", "http",
        "json", "java", "javascript", "kotlin", "less", "lua", "makefile", "markdown", "nginx", "objectivec", "php",
        "php-template", "perl", "plaintext", "python", "python-repl", "r", "ruby", "rust", "scss", "sql", "shell",
        "swift", "ini", "typescript", "vbnet", "yaml",
        "ada", "clojure", "dart", "erb", "fortran", "gradle", "haskell", "julia", "julia-repl", "lisp", "matlab",
        "pgsql", "powershell", "sql_more", "stata", "cmake", "mathematica",
        // ext
        "solidity", "yul"
    ];
    Constants.CDN = "https://unpkg.com/vditor@" + "3.9.6";
    Constants.DIST = "dist";
    Constants.BASE_URL = Constants.CDN + "/" + Constants.DIST;
    Constants._STATIC_PATH = {
        logo: "images/logo.png",
        method: "method.min.js",
        style: "index.css",
        emoji: "images/emoji",
        i18n: "js/i18n",
        icons: "js/icons",
        theme: "css/content-theme",
        abc: "js/abcjs/abcjs_basic.min.js",
        echarts: "js/echarts/echarts.min.js",
        flowchart: "js/flowchart.js/flowchart.min.js",
        graphviz: "js/graphviz/viz.js",
        lute: "js/lute/lute.min.js",
        markmap: "js/markmap/markmap.min.js",
        mermaid: "js/mermaid/mermaid.min.js",
        plantuml: "js/plantuml/plantuml-encoder.min.js",
        highlight: "js/highlight.js",
        katex: "js/katex",
        mathjax: "js/mathjax",
    };
    Constants.STATIC_PATH = {
        logo: Constants.BASE_URL + "/" + Constants._STATIC_PATH.logo,
        method: Constants.BASE_URL + "/" + Constants._STATIC_PATH.method,
        style: Constants.BASE_URL + "/" + Constants._STATIC_PATH.style,
        emoji: Constants.BASE_URL + "/" + Constants._STATIC_PATH.emoji,
        i18n: Constants.BASE_URL + "/" + Constants._STATIC_PATH.i18n,
        icons: Constants.BASE_URL + "/" + Constants._STATIC_PATH.icons,
        theme: Constants.BASE_URL + "/" + Constants._STATIC_PATH.theme,
        abc: Constants.BASE_URL + "/" + Constants._STATIC_PATH.abc,
        echarts: Constants.BASE_URL + "/" + Constants._STATIC_PATH.echarts,
        flowchart: Constants.BASE_URL + "/" + Constants._STATIC_PATH.flowchart,
        graphviz: Constants.BASE_URL + "/" + Constants._STATIC_PATH.graphviz,
        lute: Constants.BASE_URL + "/" + Constants._STATIC_PATH.lute,
        markmap: Constants.BASE_URL + "/" + Constants._STATIC_PATH.markmap,
        mermaid: Constants.BASE_URL + "/" + Constants._STATIC_PATH.mermaid,
        plantuml: Constants.BASE_URL + "/" + Constants._STATIC_PATH.plantuml,
        highlight: Constants.BASE_URL + "/" + Constants._STATIC_PATH.highlight,
        katex: Constants.BASE_URL + "/" + Constants._STATIC_PATH.katex,
        mathjax: Constants.BASE_URL + "/" + Constants._STATIC_PATH.mathjax,
    };
    Constants.MARKDOWN_OPTIONS = {
        autoSpace: false,
        gfmAutoLink: true,
        codeBlockPreview: true,
        fixTermTypo: false,
        footnotes: true,
        linkBase: "",
        linkPrefix: "",
        listStyle: false,
        mark: false,
        mathBlockPreview: true,
        paragraphBeginningSpace: false,
        sanitize: true,
        toc: false,
    };
    Constants.HLJS_OPTIONS = {
        enable: true,
        lineNumber: false,
        defaultLang: "",
        style: "github",
    };
    Constants.MATH_OPTIONS = {
        engine: "KaTeX",
        inlineDigit: false,
        macros: {},
    };
    Constants.THEME_OPTIONS = {
        current: "light",
        list: {
            "ant-design": "Ant Design",
            "dark": "Dark",
            "light": "Light",
            "wechat": "WeChat",
        },
        path: Constants.STATIC_PATH.theme,
    };
    return Constants;
}());



/***/ }),

/***/ 478:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Q": () => (/* binding */ abcRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var abcRender = function (element, abcPath) {
    if (element === void 0) { element = document; }
    if (abcPath === void 0) { abcPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.abc */ .g.STATIC_PATH.abc; }
    var abcElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.abcRenderAdapter.getElements(element);
    if (abcElements.length > 0) {
        (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(abcPath, "vditorAbcjsScript").then(function () {
            abcElements.forEach(function (item) {
                if (item.parentElement.classList.contains("vditor-wysiwyg__pre") ||
                    item.parentElement.classList.contains("vditor-ir__marker--pre")) {
                    return;
                }
                if (item.getAttribute("data-processed") === "true") {
                    return;
                }
                ABCJS.renderAbc(item, _adapterRender__WEBPACK_IMPORTED_MODULE_1__.abcRenderAdapter.getCode(item).trim());
                item.style.overflowX = "auto";
                item.setAttribute("data-processed", "true");
            });
        });
    }
};


/***/ }),

/***/ 156:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "abcRenderAdapter": () => (/* binding */ abcRenderAdapter),
/* harmony export */   "chartRenderAdapter": () => (/* binding */ chartRenderAdapter),
/* harmony export */   "flowchartRenderAdapter": () => (/* binding */ flowchartRenderAdapter),
/* harmony export */   "graphvizRenderAdapter": () => (/* binding */ graphvizRenderAdapter),
/* harmony export */   "markmapRenderAdapter": () => (/* binding */ markmapRenderAdapter),
/* harmony export */   "mathRenderAdapter": () => (/* binding */ mathRenderAdapter),
/* harmony export */   "mermaidRenderAdapter": () => (/* binding */ mermaidRenderAdapter),
/* harmony export */   "mindmapRenderAdapter": () => (/* binding */ mindmapRenderAdapter),
/* harmony export */   "plantumlRenderAdapter": () => (/* binding */ plantumlRenderAdapter)
/* harmony export */ });
var mathRenderAdapter = {
    getCode: function (mathElement) { return mathElement.textContent; },
    getElements: function (element) { return element.querySelectorAll(".language-math"); },
};
var mermaidRenderAdapter = {
    /** 不仅要返回code，并且需要将 code 设置为 el 的 innerHTML */
    getCode: function (el) { return el.textContent; },
    getElements: function (element) { return element.querySelectorAll(".language-mermaid"); },
};
var markmapRenderAdapter = {
    getCode: function (el) { return el.textContent; },
    getElements: function (element) { return element.querySelectorAll(".language-markmap"); },
};
var mindmapRenderAdapter = {
    getCode: function (el) { return el.getAttribute("data-code"); },
    getElements: function (el) { return el.querySelectorAll(".language-mindmap"); },
};
var chartRenderAdapter = {
    getCode: function (el) { return el.innerText; },
    getElements: function (el) { return el.querySelectorAll(".language-echarts"); },
};
var abcRenderAdapter = {
    getCode: function (el) { return el.textContent; },
    getElements: function (el) { return el.querySelectorAll(".language-abc"); },
};
var graphvizRenderAdapter = {
    getCode: function (el) { return el.textContent; },
    getElements: function (el) { return el.querySelectorAll(".language-graphviz"); },
};
var flowchartRenderAdapter = {
    getCode: function (el) { return el.textContent; },
    getElements: function (el) { return el.querySelectorAll(".language-flowchart"); },
};
var plantumlRenderAdapter = {
    getCode: function (el) { return el.textContent; },
    getElements: function (el) { return el.querySelectorAll(".language-plantuml"); },
};


/***/ }),

/***/ 314:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "p": () => (/* binding */ chartRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var chartRender = function (element, echartsPath, theme) {
    if (element === void 0) { element = document; }
    if (echartsPath === void 0) { echartsPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.echarts */ .g.STATIC_PATH.echarts; }
    var echartsElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.chartRenderAdapter.getElements(element);
    if (echartsElements.length > 0) {
        (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(echartsPath, "vditorEchartsScript").then(function () {
            echartsElements.forEach(function (e) {
                if (e.parentElement.classList.contains("vditor-wysiwyg__pre") ||
                    e.parentElement.classList.contains("vditor-ir__marker--pre")) {
                    return;
                }
                var text = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.chartRenderAdapter.getCode(e).trim();
                if (!text) {
                    return;
                }
                try {
                    if (e.getAttribute("data-processed") === "true") {
                        return;
                    }
                    var option = JSON.parse(text);
                    echarts.init(e, theme === "dark" ? "dark" : undefined).setOption(option);
                    e.setAttribute("data-processed", "true");
                }
                catch (error) {
                    e.className = "vditor-reset--error";
                    e.innerHTML = "echarts render error: <br>" + error;
                }
            });
        });
    }
};


/***/ }),

/***/ 730:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "O": () => (/* binding */ codeRender)
/* harmony export */ });
/* harmony import */ var _util_code160to32__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(51);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);


var codeRender = function (element) {
    element.querySelectorAll("pre > code").forEach(function (e, index) {
        var _a, _b, _c;
        if (e.parentElement.classList.contains("vditor-wysiwyg__pre") ||
            e.parentElement.classList.contains("vditor-ir__marker--pre")) {
            return;
        }
        if (e.classList.contains("language-mermaid") || e.classList.contains("language-flowchart") ||
            e.classList.contains("language-echarts") || e.classList.contains("language-mindmap") ||
            e.classList.contains("language-plantuml") || e.classList.contains("language-markmap") ||
            e.classList.contains("language-abc") || e.classList.contains("language-graphviz") ||
            e.classList.contains("language-math")) {
            return;
        }
        if (e.style.maxHeight.indexOf("px") > -1) {
            return;
        }
        // 避免预览区在渲染后由于代码块过多产生性能问题 https://github.com/b3log/vditor/issues/67
        if (element.classList.contains("vditor-preview") && index > 5) {
            return;
        }
        var codeText = e.innerText;
        if (e.classList.contains("highlight-chroma")) {
            var codeElement = document.createElement("code");
            codeElement.innerHTML = e.innerHTML;
            codeElement.querySelectorAll(".highlight-ln").forEach(function (item) {
                item.remove();
            });
            codeText = codeElement.innerText;
        }
        else if (codeText.endsWith("\n")) {
            codeText = codeText.substr(0, codeText.length - 1);
        }
        var iconHTML = '<svg><use xlink:href="#vditor-icon-copy"></use></svg>';
        if (!document.getElementById("vditorIconScript")) {
            iconHTML = '<svg viewBox="0 0 32 32"><path d="M22.545-0h-17.455c-1.6 0-2.909 1.309-2.909 2.909v20.364h2.909v-20.364h17.455v-2.909zM26.909 5.818h-16c-1.6 0-2.909 1.309-2.909 2.909v20.364c0 1.6 1.309 2.909 2.909 2.909h16c1.6 0 2.909-1.309 2.909-2.909v-20.364c0-1.6-1.309-2.909-2.909-2.909zM26.909 29.091h-16v-20.364h16v20.364z"></path></svg>';
        }
        var divElement = document.createElement("div");
        divElement.className = "vditor-copy";
        divElement.innerHTML = "<span aria-label=\"" + (((_a = window.VditorI18n) === null || _a === void 0 ? void 0 : _a.copy) || "复制") + "\"\nonmouseover=\"this.setAttribute('aria-label', '" + (((_b = window.VditorI18n) === null || _b === void 0 ? void 0 : _b.copy) || "复制") + "')\"\nclass=\"vditor-tooltipped vditor-tooltipped__w\"\nonclick=\"this.previousElementSibling.select();document.execCommand('copy');this.setAttribute('aria-label', '" + (((_c = window.VditorI18n) === null || _c === void 0 ? void 0 : _c.copied) || "已复制") + "')\">" + iconHTML + "</span>";
        var textarea = document.createElement("textarea");
        textarea.value = (0,_util_code160to32__WEBPACK_IMPORTED_MODULE_1__/* .code160to32 */ .X)(codeText);
        divElement.insertAdjacentElement("afterbegin", textarea);
        e.before(divElement);
        e.style.maxHeight = (window.outerHeight - 40) + "px";
        // https://github.com/Vanessa219/vditor/issues/1356
        e.insertAdjacentHTML("afterend", "<span style=\"position: absolute\">" + _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.ZWSP */ .g.ZWSP + "</span>");
    });
};


/***/ }),

/***/ 66:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "P": () => (/* binding */ flowchartRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var flowchartRender = function (element, flowchartPath) {
    if (flowchartPath === void 0) { flowchartPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.flowchart */ .g.STATIC_PATH.flowchart; }
    var flowchartElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.flowchartRenderAdapter.getElements(element);
    if (flowchartElements.length === 0) {
        return;
    }
    (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(flowchartPath, "vditorFlowchartScript").then(function () {
        flowchartElements.forEach(function (item) {
            if (item.getAttribute("data-processed") === "true") {
                return;
            }
            var flowchartObj = flowchart.parse(_adapterRender__WEBPACK_IMPORTED_MODULE_1__.flowchartRenderAdapter.getCode(item));
            item.innerHTML = "";
            flowchartObj.drawSVG(item);
            item.setAttribute("data-processed", "true");
        });
    });
};


/***/ }),

/***/ 218:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "v": () => (/* binding */ graphvizRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var graphvizRender = function (element, graphvizPath) {
    if (graphvizPath === void 0) { graphvizPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.graphviz */ .g.STATIC_PATH.graphviz; }
    var graphvizElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.graphvizRenderAdapter.getElements(element);
    if (graphvizElements.length === 0) {
        return;
    }
    (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(graphvizPath, "vditorGraphVizScript").then(function () {
        graphvizElements.forEach(function (e) {
            var code = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.graphvizRenderAdapter.getCode(e);
            if (e.parentElement.classList.contains("vditor-wysiwyg__pre") ||
                e.parentElement.classList.contains("vditor-ir__marker--pre")) {
                return;
            }
            if (e.getAttribute("data-processed") === "true" || code.trim() === "") {
                return;
            }
            try {
                var blob = new Blob(["importScripts('" + document.getElementById("vditorGraphVizScript").src.replace("viz.js", "full.render.js") + "');"], { type: "application/javascript" });
                var url = window.URL || window.webkitURL;
                var blobUrl = url.createObjectURL(blob);
                var worker = new Worker(blobUrl);
                new Viz({ worker: worker })
                    .renderSVGElement(code).then(function (result) {
                    e.innerHTML = result.outerHTML;
                }).catch(function (error) {
                    e.innerHTML = "graphviz render error: <br>" + error;
                    e.className = "vditor-reset--error";
                });
            }
            catch (e) {
                console.error("graphviz error", e);
            }
            e.setAttribute("data-processed", "true");
        });
    });
};


/***/ }),

/***/ 702:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "s": () => (/* binding */ highlightRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _util_addStyle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(578);



var highlightRender = function (hljsOption, element, highlightPath) {
    if (element === void 0) { element = document; }
    if (highlightPath === void 0) { highlightPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.highlight */ .g.STATIC_PATH.highlight; }
    var style = hljsOption.style;
    if (!_constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.CODE_THEME.includes */ .g.CODE_THEME.includes(style)) {
        style = "github";
    }
    var vditorHljsStyle = document.getElementById("vditorHljsStyle");
    var href = highlightPath + "/styles/" + style + ".css";
    if (vditorHljsStyle && vditorHljsStyle.href !== href) {
        vditorHljsStyle.remove();
    }
    (0,_util_addStyle__WEBPACK_IMPORTED_MODULE_1__/* .addStyle */ .c)(highlightPath + "/styles/" + style + ".css", "vditorHljsStyle");
    if (hljsOption.enable === false) {
        return;
    }
    var codes = element.querySelectorAll("pre > code");
    if (codes.length === 0) {
        return;
    }
    (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(highlightPath + "/highlight.pack.js", "vditorHljsScript").then(function () {
        (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(highlightPath + "/solidity.min.js", "vditorHljsSolidityScript").then(function () {
            (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(highlightPath + "/yul.min.js", "vditorHljsYulScript").then(function () {
                element.querySelectorAll("pre > code").forEach(function (block) {
                    // ir & wysiwyg 区域不渲染
                    if (block.parentElement.classList.contains("vditor-ir__marker--pre") ||
                        block.parentElement.classList.contains("vditor-wysiwyg__pre")) {
                        return;
                    }
                    if (block.classList.contains("language-mermaid") || block.classList.contains("language-flowchart") ||
                        block.classList.contains("language-echarts") || block.classList.contains("language-mindmap") ||
                        block.classList.contains("language-plantuml") ||
                        block.classList.contains("language-abc") || block.classList.contains("language-graphviz") ||
                        block.classList.contains("language-math")) {
                        return;
                    }
                    if (hljsOption.defaultLang !== "" && block.className.indexOf("language-") === -1) {
                        block.classList.add("language-" + hljsOption.defaultLang);
                    }
                    hljs.highlightElement(block);
                    if (!hljsOption.lineNumber) {
                        return;
                    }
                    block.classList.add("vditor-linenumber");
                    var linenNumberTemp = block.querySelector(".vditor-linenumber__temp");
                    if (!linenNumberTemp) {
                        linenNumberTemp = document.createElement("div");
                        linenNumberTemp.className = "vditor-linenumber__temp";
                        block.insertAdjacentElement("beforeend", linenNumberTemp);
                    }
                    var whiteSpace = getComputedStyle(block).whiteSpace;
                    var isSoftWrap = false;
                    if (whiteSpace === "pre-wrap" || whiteSpace === "pre-line") {
                        isSoftWrap = true;
                    }
                    var lineNumberHTML = "";
                    var lineList = block.textContent.split(/\r\n|\r|\n/g);
                    lineList.pop();
                    lineList.map(function (line) {
                        var lineHeight = "";
                        if (isSoftWrap) {
                            linenNumberTemp.textContent = line || "\n";
                            lineHeight = " style=\"height:" + linenNumberTemp.getBoundingClientRect().height + "px\"";
                        }
                        lineNumberHTML += "<span" + lineHeight + "></span>";
                    });
                    linenNumberTemp.style.display = "none";
                    lineNumberHTML = "<span class=\"vditor-linenumber__rows\">" + lineNumberHTML + "</span>";
                    block.insertAdjacentHTML("beforeend", lineNumberHTML);
                });
            });
        });
    });
};


/***/ }),

/***/ 563:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "K": () => (/* binding */ markmapRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var enabled = {};
var transform = function (transformer, content) {
    var result = transformer.transform(content);
    var keys = Object.keys(result.features).filter(function (key) { return !enabled[key]; });
    keys.forEach(function (key) {
        enabled[key] = true;
    });
    var _a = transformer.getAssets(keys), styles = _a.styles, scripts = _a.scripts;
    var markmap = window.markmap;
    if (styles)
        markmap.loadCSS(styles);
    if (scripts)
        markmap.loadJS(scripts);
    return result;
};
var init = function (el, code) {
    var _a = window.markmap, Transformer = _a.Transformer, Markmap = _a.Markmap, deriveOptions = _a.deriveOptions, globalCSS = _a.globalCSS;
    var transformer = new Transformer();
    el.innerHTML = '<svg style="width:100%"></svg>';
    var svg = el.firstChild;
    var mm = Markmap.create(svg, null);
    var _b = transform(transformer, code), root = _b.root, frontmatter = _b.frontmatter;
    var markmapOptions = frontmatter === null || frontmatter === void 0 ? void 0 : frontmatter.markmap;
    var frontmatterOptions = deriveOptions(markmapOptions);
    mm.setData(root, frontmatterOptions);
    mm.fit();
};
var markmapRender = function (element, markmapPath, theme) {
    if (markmapPath === void 0) { markmapPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.markmap */ .g.STATIC_PATH.markmap; }
    var markmapElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.markmapRenderAdapter.getElements(element);
    if (markmapElements.length === 0) {
        return;
    }
    (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(markmapPath, "vditorMermaidScript").then(function () {
        markmapElements.forEach(function (item) {
            var code = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.markmapRenderAdapter.getCode(item);
            if (item.getAttribute("data-processed") === "true" || code.trim() === "") {
                return;
            }
            var render = document.createElement("div");
            render.className = "language-markmap";
            item.parentNode.appendChild(render);
            init(render, code);
            if (item.parentNode.childNodes[0].nodeName == "CODE") {
                item.parentNode.removeChild(item.parentNode.childNodes[0]);
            }
        });
    });
};


/***/ }),

/***/ 466:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "H": () => (/* binding */ mathRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(526);
/* harmony import */ var _util_addStyle__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(578);
/* harmony import */ var _util_code160to32__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(51);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);





var mathRender = function (element, options) {
    var mathElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.mathRenderAdapter.getElements(element);
    if (mathElements.length === 0) {
        return;
    }
    var defaultOptions = {
        katex: _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.katex */ .g.STATIC_PATH.katex,
        mathjax: _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.mathjax */ .g.STATIC_PATH.mathjax,
        math: {
            engine: "KaTeX",
            inlineDigit: false,
            macros: {},
        },
    };
    if (options && options.math) {
        options.math =
            Object.assign({}, defaultOptions.math, options.math);
    }
    options = Object.assign({}, defaultOptions, options);
    if (options.math.engine === "KaTeX") {
        (0,_util_addStyle__WEBPACK_IMPORTED_MODULE_2__/* .addStyle */ .c)(options.katex + "/katex.min.css", "vditorKatexStyle");
        (0,_util_addScript__WEBPACK_IMPORTED_MODULE_3__/* .addScript */ .G)(options.katex + "/katex.min.js", "vditorKatexScript").then(function () {
            (0,_util_addScript__WEBPACK_IMPORTED_MODULE_3__/* .addScript */ .G)(options.katex + "/mhchem.min.js", "vditorKatexChemScript").then(function () {
                mathElements.forEach(function (mathElement) {
                    if (mathElement.parentElement.classList.contains("vditor-wysiwyg__pre") ||
                        mathElement.parentElement.classList.contains("vditor-ir__marker--pre")) {
                        return;
                    }
                    if (mathElement.getAttribute("data-math")) {
                        return;
                    }
                    var math = (0,_util_code160to32__WEBPACK_IMPORTED_MODULE_4__/* .code160to32 */ .X)(_adapterRender__WEBPACK_IMPORTED_MODULE_1__.mathRenderAdapter.getCode(mathElement));
                    mathElement.setAttribute("data-math", math);
                    try {
                        mathElement.innerHTML = katex.renderToString(math, {
                            displayMode: mathElement.tagName === "DIV",
                            output: "html",
                        });
                    }
                    catch (e) {
                        mathElement.innerHTML = e.message;
                        mathElement.className = "language-math vditor-reset--error";
                    }
                    mathElement.addEventListener("copy", function (event) {
                        event.stopPropagation();
                        event.preventDefault();
                        var vditorMathElement = event.currentTarget.closest(".language-math");
                        event.clipboardData.setData("text/html", vditorMathElement.innerHTML);
                        event.clipboardData.setData("text/plain", vditorMathElement.getAttribute("data-math"));
                    });
                });
            });
        });
    }
    else if (options.math.engine === "MathJax") {
        var chainAsync_1 = function (fns) {
            if (fns.length === 0) {
                return;
            }
            var curr = 0;
            var last = fns[fns.length - 1];
            var next = function () {
                var fn = fns[curr++];
                fn === last ? fn() : fn(next);
            };
            next();
        };
        if (!window.MathJax) {
            window.MathJax = {
                loader: {
                    paths: { mathjax: options.mathjax },
                },
                startup: {
                    typeset: false,
                },
                tex: {
                    macros: options.math.macros,
                },
            };
            // https://github.com/Vanessa219/vditor/issues/1453
            Object.assign(window.MathJax, options.math.mathJaxOptions);
        }
        // 循环加载会抛异常
        (0,_util_addScript__WEBPACK_IMPORTED_MODULE_3__/* .addScriptSync */ .J)(options.mathjax + "/tex-svg-full.js", "protyleMathJaxScript");
        var renderMath_1 = function (mathElement, next) {
            var math = (0,_util_code160to32__WEBPACK_IMPORTED_MODULE_4__/* .code160to32 */ .X)(mathElement.textContent).trim();
            var mathOptions = window.MathJax.getMetricsFor(mathElement);
            mathOptions.display = mathElement.tagName === "DIV";
            window.MathJax.tex2svgPromise(math, mathOptions).then(function (node) {
                mathElement.innerHTML = "";
                mathElement.setAttribute("data-math", math);
                mathElement.append(node);
                window.MathJax.startup.document.clear();
                window.MathJax.startup.document.updateDocument();
                var errorTextElement = node.querySelector('[data-mml-node="merror"]');
                if (errorTextElement && errorTextElement.textContent.trim() !== "") {
                    mathElement.innerHTML = errorTextElement.textContent.trim();
                    mathElement.className = "vditor-reset--error";
                }
                if (next) {
                    next();
                }
            });
        };
        window.MathJax.startup.promise.then(function () {
            var chains = [];
            var _loop_1 = function (i) {
                var mathElement = mathElements[i];
                if (!mathElement.parentElement.classList.contains("vditor-wysiwyg__pre") &&
                    !mathElement.parentElement.classList.contains("vditor-ir__marker--pre") &&
                    !mathElement.getAttribute("data-math") && (0,_util_code160to32__WEBPACK_IMPORTED_MODULE_4__/* .code160to32 */ .X)(mathElement.textContent).trim()) {
                    chains.push(function (next) {
                        if (i === mathElements.length - 1) {
                            renderMath_1(mathElement);
                        }
                        else {
                            renderMath_1(mathElement, next);
                        }
                    });
                }
            };
            for (var i = 0; i < mathElements.length; i++) {
                _loop_1(i);
            }
            chainAsync_1(chains);
        });
    }
};


/***/ }),

/***/ 554:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Y": () => (/* binding */ mediaRender)
/* harmony export */ });
var videoRender = function (element, url) {
    element.insertAdjacentHTML("afterend", "<video controls=\"controls\" src=\"" + url + "\"></video>");
    element.remove();
};
var audioRender = function (element, url) {
    element.insertAdjacentHTML("afterend", "<audio controls=\"controls\" src=\"" + url + "\"></audio>");
    element.remove();
};
var iframeRender = function (element, url) {
    var youtubeMatch = url.match(/\/\/(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w|-]{11})(?:(?:[\?&]t=)(\S+))?/);
    var youkuMatch = url.match(/\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/);
    var qqMatch = url.match(/\/\/v\.qq\.com\/x\/cover\/.*\/([^\/]+)\.html\??.*/);
    var coubMatch = url.match(/(?:www\.|\/\/)coub\.com\/view\/(\w+)/);
    var facebookMatch = url.match(/(?:www\.|\/\/)facebook\.com\/([^\/]+)\/videos\/([0-9]+)/);
    var dailymotionMatch = url.match(/.+dailymotion.com\/(video|hub)\/(\w+)\?/);
    var bilibiliMatch = url.match(/(?:www\.|\/\/)bilibili\.com\/video\/(\w+)/);
    var tedMatch = url.match(/(?:www\.|\/\/)ted\.com\/talks\/(\w+)/);
    if (youtubeMatch && youtubeMatch[1].length === 11) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\" src=\"//www.youtube.com/embed/" + (youtubeMatch[1] +
            (youtubeMatch[2] ? "?start=" + youtubeMatch[2] : "")) + "\"></iframe>");
        element.remove();
    }
    else if (youkuMatch && youkuMatch[1]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\" src=\"//player.youku.com/embed/" + youkuMatch[1] + "\"></iframe>");
        element.remove();
    }
    else if (qqMatch && qqMatch[1]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\" src=\"https://v.qq.com/txp/iframe/player.html?vid=" + qqMatch[1] + "\"></iframe>");
        element.remove();
    }
    else if (coubMatch && coubMatch[1]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\"\n src=\"//coub.com/embed/" + coubMatch[1] + "?muted=false&autostart=false&originalSize=true&startWithHD=true\"></iframe>");
        element.remove();
    }
    else if (facebookMatch && facebookMatch[0]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\"\n src=\"https://www.facebook.com/plugins/video.php?href=" + encodeURIComponent(facebookMatch[0]) + "\"></iframe>");
        element.remove();
    }
    else if (dailymotionMatch && dailymotionMatch[2]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\"\n src=\"https://www.dailymotion.com/embed/video/" + dailymotionMatch[2] + "\"></iframe>");
        element.remove();
    }
    else if (bilibiliMatch && bilibiliMatch[1]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\"\n src=\"//player.bilibili.com/player.html?bvid=" + bilibiliMatch[1] + "\"></iframe>");
        element.remove();
    }
    else if (tedMatch && tedMatch[1]) {
        element.insertAdjacentHTML("afterend", "<iframe class=\"iframe__video\" src=\"//embed.ted.com/talks/" + tedMatch[1] + "\"></iframe>");
        element.remove();
    }
};
var mediaRender = function (element) {
    if (!element) {
        return;
    }
    element.querySelectorAll("a").forEach(function (aElement) {
        var url = aElement.getAttribute("href");
        if (!url) {
            return;
        }
        if (url.match(/^.+.(mp4|m4v|ogg|ogv|webm)$/)) {
            videoRender(aElement, url);
        }
        else if (url.match(/^.+.(mp3|wav|flac)$/)) {
            audioRender(aElement, url);
        }
        else {
            iframeRender(aElement, url);
        }
    });
};


/***/ }),

/***/ 40:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "i": () => (/* binding */ mermaidRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var mermaidRender = function (element, mermaidPath, theme) {
    if (mermaidPath === void 0) { mermaidPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.mermaid */ .g.STATIC_PATH.mermaid; }
    var mermaidElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.mermaidRenderAdapter.getElements(element);
    if (mermaidElements.length === 0) {
        return;
    }
    (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(mermaidPath, "vditorMermaidScript").then(function () {
        var config = {
            securityLevel: "loose",
            altFontFamily: "sans-serif",
            fontFamily: "sans-serif",
            startOnLoad: false,
            flowchart: {
                htmlLabels: true,
                useMaxWidth: !0
            },
            sequence: {
                useMaxWidth: true,
                diagramMarginX: 8,
                diagramMarginY: 8,
                boxMargin: 8
            },
            gantt: {
                leftPadding: 75,
                rightPadding: 20
            }
        };
        if (theme === "dark") {
            config.theme = "dark";
        }
        mermaid.initialize(config);
        mermaidElements.forEach(function (item) {
            var code = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.mermaidRenderAdapter.getCode(item);
            if (item.getAttribute("data-processed") === "true" || code.trim() === "") {
                return;
            }
            mermaid.init(undefined, item);
            item.setAttribute("data-processed", "true");
        });
    });
};


/***/ }),

/***/ 749:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "P": () => (/* binding */ mindmapRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var mindmapRender = function (element, echartsPath, theme) {
    if (element === void 0) { element = document; }
    if (echartsPath === void 0) { echartsPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.echarts */ .g.STATIC_PATH.echarts; }
    var mindmapElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.mindmapRenderAdapter.getElements(element);
    if (mindmapElements.length > 0) {
        (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(echartsPath, "vditorEchartsScript").then(function () {
            mindmapElements.forEach(function (e) {
                if (e.parentElement.classList.contains("vditor-wysiwyg__pre") ||
                    e.parentElement.classList.contains("vditor-ir__marker--pre")) {
                    return;
                }
                var text = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.mindmapRenderAdapter.getCode(e);
                if (!text) {
                    return;
                }
                try {
                    if (e.getAttribute("data-processed") === "true") {
                        return;
                    }
                    echarts.init(e, theme === "dark" ? "dark" : undefined).setOption({
                        series: [
                            {
                                data: [JSON.parse(decodeURIComponent(text))],
                                initialTreeDepth: -1,
                                itemStyle: {
                                    borderWidth: 0,
                                    color: "#4285f4",
                                },
                                label: {
                                    backgroundColor: "#f6f8fa",
                                    borderColor: "#d1d5da",
                                    borderRadius: 5,
                                    borderWidth: 0.5,
                                    color: "#586069",
                                    lineHeight: 20,
                                    offset: [-5, 0],
                                    padding: [0, 5],
                                    position: "insideRight",
                                },
                                lineStyle: {
                                    color: "#d1d5da",
                                    width: 1,
                                },
                                roam: true,
                                symbol: function (value, params) {
                                    var _a;
                                    if ((_a = params === null || params === void 0 ? void 0 : params.data) === null || _a === void 0 ? void 0 : _a.children) {
                                        return "circle";
                                    }
                                    else {
                                        return "path://";
                                    }
                                },
                                type: "tree",
                            },
                        ],
                        tooltip: {
                            trigger: "item",
                            triggerOn: "mousemove",
                        },
                    });
                    e.setAttribute("data-processed", "true");
                }
                catch (error) {
                    e.className = "vditor-reset--error";
                    e.innerHTML = "mindmap render error: <br>" + error;
                }
            });
        });
    }
};


/***/ }),

/***/ 818:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "k": () => (/* binding */ outlineRender)
/* harmony export */ });
/* harmony import */ var _util_hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(64);
/* harmony import */ var _mathRender__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(466);


var outlineRender = function (contentElement, targetElement, vditor) {
    var tocHTML = "";
    var ids = [];
    Array.from(contentElement.children).forEach(function (item, index) {
        if ((0,_util_hasClosestByHeadings__WEBPACK_IMPORTED_MODULE_1__/* .hasClosestByHeadings */ .W)(item)) {
            if (vditor) {
                var lastIndex = item.id.lastIndexOf("_");
                item.id = item.id.substring(0, lastIndex === -1 ? undefined : lastIndex) + "_" + index;
            }
            ids.push(item.id);
            tocHTML += item.outerHTML.replace("<wbr>", "");
        }
    });
    if (tocHTML === "") {
        targetElement.innerHTML = "";
        return "";
    }
    var tempElement = document.createElement("div");
    if (vditor) {
        vditor.lute.SetToC(true);
        if (vditor.currentMode === "wysiwyg" && !vditor.preview.element.contains(contentElement)) {
            tempElement.innerHTML = vditor.lute.SpinVditorDOM("<p>[ToC]</p>" + tocHTML);
        }
        else if (vditor.currentMode === "ir" && !vditor.preview.element.contains(contentElement)) {
            tempElement.innerHTML = vditor.lute.SpinVditorIRDOM("<p>[ToC]</p>" + tocHTML);
        }
        else {
            tempElement.innerHTML = vditor.lute.HTML2VditorDOM("<p>[ToC]</p>" + tocHTML);
        }
        vditor.lute.SetToC(vditor.options.preview.markdown.toc);
    }
    else {
        targetElement.classList.add("vditor-outline");
        var lute = Lute.New();
        lute.SetToC(true);
        tempElement.innerHTML = lute.HTML2VditorDOM("<p>[ToC]</p>" + tocHTML);
    }
    var headingsElement = tempElement.firstElementChild.querySelectorAll("li > span[data-target-id]");
    headingsElement.forEach(function (item, index) {
        if (item.nextElementSibling && item.nextElementSibling.tagName === "UL") {
            var iconHTML = "<svg class='vditor-outline__action'><use xlink:href='#vditor-icon-down'></use></svg>";
            if (!document.getElementById("vditorIconScript")) {
                iconHTML = '<svg class="vditor-outline__action" viewBox="0 0 32 32"><path d="M3.76 6.12l12.24 12.213 12.24-12.213 3.76 3.76-16 16-16-16 3.76-3.76z"></path></svg>';
            }
            item.innerHTML = iconHTML + "<span>" + item.innerHTML + "</span>";
        }
        else {
            item.innerHTML = "<svg></svg><span>" + item.innerHTML + "</span>";
        }
        item.setAttribute("data-target-id", ids[index]);
    });
    tocHTML = tempElement.firstElementChild.innerHTML;
    if (headingsElement.length === 0) {
        targetElement.innerHTML = "";
        return tocHTML;
    }
    targetElement.innerHTML = tocHTML;
    if (vditor) {
        (0,_mathRender__WEBPACK_IMPORTED_MODULE_0__/* .mathRender */ .H)(targetElement, {
            katex: vditor.options.staticPath.katex,
            mathjax: vditor.options.staticPath.mathjax,
            math: vditor.options.preview.math,
        });
    }
    targetElement.firstElementChild.addEventListener("click", function (event) {
        var target = event.target;
        while (target && !target.isEqualNode(targetElement)) {
            if (target.classList.contains("vditor-outline__action")) {
                if (target.classList.contains("vditor-outline__action--close")) {
                    target.classList.remove("vditor-outline__action--close");
                    target.parentElement.nextElementSibling.setAttribute("style", "display:block");
                }
                else {
                    target.classList.add("vditor-outline__action--close");
                    target.parentElement.nextElementSibling.setAttribute("style", "display:none");
                }
                event.preventDefault();
                event.stopPropagation();
                break;
            }
            else if (target.getAttribute("data-target-id")) {
                event.preventDefault();
                event.stopPropagation();
                var idElement = document.getElementById(target.getAttribute("data-target-id"));
                if (!idElement) {
                    return;
                }
                if (vditor) {
                    if (vditor.options.height === "auto") {
                        var windowScrollY = idElement.offsetTop + vditor.element.offsetTop;
                        if (!vditor.options.toolbarConfig.pin) {
                            windowScrollY += vditor.toolbar.element.offsetHeight;
                        }
                        window.scrollTo(window.scrollX, windowScrollY);
                    }
                    else {
                        if (vditor.element.offsetTop < window.scrollY) {
                            window.scrollTo(window.scrollX, vditor.element.offsetTop);
                        }
                        if (vditor.preview.element.contains(contentElement)) {
                            contentElement.parentElement.scrollTop = idElement.offsetTop;
                        }
                        else {
                            contentElement.scrollTop = idElement.offsetTop;
                        }
                    }
                }
                else {
                    window.scrollTo(window.scrollX, idElement.offsetTop);
                }
                break;
            }
            target = target.parentElement;
        }
    });
    return tocHTML;
};


/***/ }),

/***/ 408:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "B": () => (/* binding */ plantumlRender)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addScript__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(526);
/* harmony import */ var _adapterRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(156);



var plantumlRender = function (element, plantumlPath) {
    if (element === void 0) { element = document; }
    if (plantumlPath === void 0) { plantumlPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.plantuml */ .g.STATIC_PATH.plantuml; }
    var plantumlElements = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.plantumlRenderAdapter.getElements(element);
    if (plantumlElements.length === 0) {
        return;
    }
    (0,_util_addScript__WEBPACK_IMPORTED_MODULE_2__/* .addScript */ .G)(plantumlPath, "vditorPlantumlScript").then(function () {
        plantumlElements.forEach(function (e) {
            if (e.parentElement.classList.contains("vditor-wysiwyg__pre") ||
                e.parentElement.classList.contains("vditor-ir__marker--pre")) {
                return;
            }
            var text = _adapterRender__WEBPACK_IMPORTED_MODULE_1__.plantumlRenderAdapter.getCode(e).trim();
            if (!text) {
                return;
            }
            try {
                e.innerHTML = "<img src=\"http://www.plantuml.com/plantuml/svg/~1" + plantumlEncoder.encode(text) + "\">";
            }
            catch (error) {
                e.className = "vditor-reset--error";
                e.innerHTML = "plantuml render error: <br>" + error;
            }
        });
    });
};


/***/ }),

/***/ 895:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "X": () => (/* binding */ setLute)
/* harmony export */ });
var setLute = function (options) {
    var lute = Lute.New();
    lute.PutEmojis(options.emojis);
    lute.SetEmojiSite(options.emojiSite);
    lute.SetHeadingAnchor(options.headingAnchor);
    lute.SetInlineMathAllowDigitAfterOpenMarker(options.inlineMathDigit);
    lute.SetAutoSpace(options.autoSpace);
    lute.SetToC(options.toc);
    lute.SetFootnotes(options.footnotes);
    lute.SetFixTermTypo(options.fixTermTypo);
    lute.SetVditorCodeBlockPreview(options.codeBlockPreview);
    lute.SetVditorMathBlockPreview(options.mathBlockPreview);
    lute.SetSanitize(options.sanitize);
    lute.SetChineseParagraphBeginningSpace(options.paragraphBeginningSpace);
    lute.SetRenderListStyle(options.listStyle);
    lute.SetLinkBase(options.linkBase);
    lute.SetLinkPrefix(options.linkPrefix);
    lute.SetMark(options.mark);
    lute.SetGFMAutoLink(options.gfmAutoLink);
    if (options.lazyLoadImage) {
        lute.SetImageLazyLoading(options.lazyLoadImage);
    }
    return lute;
};


/***/ }),

/***/ 863:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "E": () => (/* binding */ previewImage)
/* harmony export */ });
var previewImage = function (oldImgElement, lang, theme) {
    if (lang === void 0) { lang = "zh_CN"; }
    if (theme === void 0) { theme = "classic"; }
    var oldImgRect = oldImgElement.getBoundingClientRect();
    var height = 36;
    document.body.insertAdjacentHTML("beforeend", "<div class=\"vditor vditor-img" + (theme === "dark" ? " vditor--dark" : "") + "\">\n    <div class=\"vditor-img__bar\">\n      <span class=\"vditor-img__btn\" data-deg=\"0\">\n        <svg><use xlink:href=\"#vditor-icon-redo\"></use></svg>\n        " + window.VditorI18n.spin + "\n      </span>\n      <span class=\"vditor-img__btn\"  onclick=\"this.parentElement.parentElement.outerHTML = '';document.body.style.overflow = ''\">\n        X &nbsp;" + window.VditorI18n.close + "\n      </span>\n    </div>\n    <div class=\"vditor-img__img\" onclick=\"this.parentElement.outerHTML = '';document.body.style.overflow = ''\">\n      <img style=\"width: " + oldImgElement.width + "px;height:" + oldImgElement.height + "px;transform: translate3d(" + oldImgRect.left + "px, " + (oldImgRect.top - height) + "px, 0)\" src=\"" + oldImgElement.getAttribute("src") + "\">\n    </div>\n</div>");
    document.body.style.overflow = "hidden";
    // 图片从原始位置移动到预览正中间的动画效果
    var imgElement = document.querySelector(".vditor-img img");
    var translate3d = "translate3d(" + Math.max(0, window.innerWidth - oldImgElement.naturalWidth) / 2 + "px, " + Math.max(0, window.innerHeight - height - oldImgElement.naturalHeight) / 2 + "px, 0)";
    setTimeout(function () {
        imgElement.setAttribute("style", "transition: transform .3s ease-in-out;transform: " + translate3d);
        setTimeout(function () {
            imgElement.parentElement.scrollTo((imgElement.parentElement.scrollWidth - imgElement.parentElement.clientWidth) / 2, (imgElement.parentElement.scrollHeight - imgElement.parentElement.clientHeight) / 2);
        }, 400);
    });
    // 旋转
    var btnElement = document.querySelector(".vditor-img__btn");
    btnElement.addEventListener("click", function () {
        var deg = parseInt(btnElement.getAttribute("data-deg"), 10) + 90;
        if ((deg / 90) % 2 === 1 && oldImgElement.naturalWidth > imgElement.parentElement.clientHeight) {
            imgElement.style.transform = "translate3d(" + Math.max(0, window.innerWidth - oldImgElement.naturalWidth) / 2 + "px, " + (oldImgElement.naturalWidth / 2 - oldImgElement.naturalHeight / 2) + "px, 0) rotateZ(" + deg + "deg)";
        }
        else {
            imgElement.style.transform = translate3d + " rotateZ(" + deg + "deg)";
        }
        btnElement.setAttribute("data-deg", deg.toString());
        setTimeout(function () {
            imgElement.parentElement.scrollTo((imgElement.parentElement.scrollWidth - imgElement.parentElement.clientWidth) / 2, (imgElement.parentElement.scrollHeight - imgElement.parentElement.clientHeight) / 2);
        }, 400);
    });
};


/***/ }),

/***/ 312:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Y": () => (/* binding */ setCodeTheme)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);
/* harmony import */ var _util_addStyle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(578);


var setCodeTheme = function (codeTheme, highlightPath) {
    if (highlightPath === void 0) { highlightPath = _constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.STATIC_PATH.highlight */ .g.STATIC_PATH.highlight; }
    if (!_constants__WEBPACK_IMPORTED_MODULE_0__/* .Constants.CODE_THEME.includes */ .g.CODE_THEME.includes(codeTheme)) {
        codeTheme = "github";
    }
    var vditorHljsStyle = document.getElementById("vditorHljsStyle");
    var href = highlightPath + "/styles/" + codeTheme + ".css";
    if (!vditorHljsStyle) {
        (0,_util_addStyle__WEBPACK_IMPORTED_MODULE_1__/* .addStyle */ .c)(href, "vditorHljsStyle");
    }
    else if (vditorHljsStyle.href !== href) {
        vditorHljsStyle.remove();
        (0,_util_addStyle__WEBPACK_IMPORTED_MODULE_1__/* .addStyle */ .c)(href, "vditorHljsStyle");
    }
};


/***/ }),

/***/ 227:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Z": () => (/* binding */ setContentTheme)
/* harmony export */ });
/* harmony import */ var _util_addStyle__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(578);

var setContentTheme = function (contentTheme, path) {
    if (!contentTheme || !path) {
        return;
    }
    var vditorContentTheme = document.getElementById("vditorContentTheme");
    var cssPath = path + "/" + contentTheme + ".css";
    if (!vditorContentTheme) {
        (0,_util_addStyle__WEBPACK_IMPORTED_MODULE_0__/* .addStyle */ .c)(cssPath, "vditorContentTheme");
    }
    else if (vditorContentTheme.getAttribute("href") !== cssPath) {
        vditorContentTheme.remove();
        (0,_util_addStyle__WEBPACK_IMPORTED_MODULE_0__/* .addStyle */ .c)(cssPath, "vditorContentTheme");
    }
};


/***/ }),

/***/ 526:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "G": () => (/* binding */ addScript),
/* harmony export */   "J": () => (/* binding */ addScriptSync)
/* harmony export */ });
var addScriptSync = function (path, id) {
    if (document.getElementById(id)) {
        return false;
    }
    var xhrObj = new XMLHttpRequest();
    xhrObj.open("GET", path, false);
    xhrObj.setRequestHeader("Accept", "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01");
    xhrObj.send("");
    var scriptElement = document.createElement("script");
    scriptElement.type = "text/javascript";
    scriptElement.text = xhrObj.responseText;
    scriptElement.id = id;
    document.head.appendChild(scriptElement);
};
var addScript = function (path, id) {
    return new Promise(function (resolve, reject) {
        if (document.getElementById(id)) {
            // 脚本加载后再次调用直接返回
            resolve();
            return false;
        }
        var scriptElement = document.createElement("script");
        scriptElement.src = path;
        scriptElement.async = true;
        // 循环调用时 Chrome 不会重复请求 js
        document.head.appendChild(scriptElement);
        scriptElement.onload = function () {
            if (document.getElementById(id)) {
                // 循环调用需清除 DOM 中的 script 标签
                scriptElement.remove();
                resolve();
                return false;
            }
            scriptElement.id = id;
            resolve();
        };
    });
};


/***/ }),

/***/ 578:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "c": () => (/* binding */ addStyle)
/* harmony export */ });
var addStyle = function (url, id) {
    if (!document.getElementById(id)) {
        var styleElement = document.createElement("link");
        styleElement.id = id;
        styleElement.rel = "stylesheet";
        styleElement.type = "text/css";
        styleElement.href = url;
        document.getElementsByTagName("head")[0].appendChild(styleElement);
    }
};


/***/ }),

/***/ 51:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "X": () => (/* binding */ code160to32)
/* harmony export */ });
var code160to32 = function (text) {
    // 非打断空格转换为空格
    return text.replace(/\u00a0/g, " ");
};


/***/ }),

/***/ 827:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "fb": () => (/* binding */ hasClosestByClassName),
/* harmony export */   "lG": () => (/* binding */ hasClosestByMatchTag)
/* harmony export */ });
/* unused harmony exports hasTopClosestByClassName, hasTopClosestByAttribute, hasTopClosestByTag, getTopList, hasClosestByAttribute, hasClosestBlock, getLastNode */

var hasTopClosestByClassName = function (element, className) {
    var closest = hasClosestByClassName(element, className);
    var parentClosest = false;
    var findTop = false;
    while (closest && !closest.classList.contains("vditor-reset") && !findTop) {
        parentClosest = hasClosestByClassName(closest.parentElement, className);
        if (parentClosest) {
            closest = parentClosest;
        }
        else {
            findTop = true;
        }
    }
    return closest || false;
};
var hasTopClosestByAttribute = function (element, attr, value) {
    var closest = hasClosestByAttribute(element, attr, value);
    var parentClosest = false;
    var findTop = false;
    while (closest && !closest.classList.contains("vditor-reset") && !findTop) {
        parentClosest = hasClosestByAttribute(closest.parentElement, attr, value);
        if (parentClosest) {
            closest = parentClosest;
        }
        else {
            findTop = true;
        }
    }
    return closest || false;
};
var hasTopClosestByTag = function (element, nodeName) {
    var closest = hasClosestByTag(element, nodeName);
    var parentClosest = false;
    var findTop = false;
    while (closest && !closest.classList.contains("vditor-reset") && !findTop) {
        parentClosest = hasClosestByTag(closest.parentElement, nodeName);
        if (parentClosest) {
            closest = parentClosest;
        }
        else {
            findTop = true;
        }
    }
    return closest || false;
};
var getTopList = function (element) {
    var topUlElement = hasTopClosestByTag(element, "UL");
    var topOlElement = hasTopClosestByTag(element, "OL");
    var topListElement = topUlElement;
    if (topOlElement && (!topUlElement || (topUlElement && topOlElement.contains(topUlElement)))) {
        topListElement = topOlElement;
    }
    return topListElement;
};
var hasClosestByAttribute = function (element, attr, value) {
    if (!element) {
        return false;
    }
    if (element.nodeType === 3) {
        element = element.parentElement;
    }
    var e = element;
    var isClosest = false;
    while (e && !isClosest && !e.classList.contains("vditor-reset")) {
        if (e.getAttribute(attr) === value) {
            isClosest = true;
        }
        else {
            e = e.parentElement;
        }
    }
    return isClosest && e;
};
var hasClosestBlock = function (element) {
    if (!element) {
        return false;
    }
    if (element.nodeType === 3) {
        element = element.parentElement;
    }
    var e = element;
    var isClosest = false;
    var blockElement = hasClosestByAttribute(element, "data-block", "0");
    if (blockElement) {
        return blockElement;
    }
    while (e && !isClosest && !e.classList.contains("vditor-reset")) {
        if (e.tagName === "H1" ||
            e.tagName === "H2" ||
            e.tagName === "H3" ||
            e.tagName === "H4" ||
            e.tagName === "H5" ||
            e.tagName === "H6" ||
            e.tagName === "P" ||
            e.tagName === "BLOCKQUOTE" ||
            e.tagName === "OL" ||
            e.tagName === "UL") {
            isClosest = true;
        }
        else {
            e = e.parentElement;
        }
    }
    return isClosest && e;
};
var hasClosestByMatchTag = function (element, nodeName) {
    if (!element) {
        return false;
    }
    if (element.nodeType === 3) {
        element = element.parentElement;
    }
    var e = element;
    var isClosest = false;
    while (e && !isClosest && !e.classList.contains("vditor-reset")) {
        if (e.nodeName === nodeName) {
            isClosest = true;
        }
        else {
            e = e.parentElement;
        }
    }
    return isClosest && e;
};
var hasClosestByClassName = function (element, className) {
    if (!element) {
        return false;
    }
    if (element.nodeType === 3) {
        element = element.parentElement;
    }
    var e = element;
    var isClosest = false;
    while (e && !isClosest && !e.classList.contains("vditor-reset")) {
        if (e.classList.contains(className)) {
            isClosest = true;
        }
        else {
            e = e.parentElement;
        }
    }
    return isClosest && e;
};
var getLastNode = function (node) {
    while (node && node.lastChild) {
        node = node.lastChild;
    }
    return node;
};


/***/ }),

/***/ 64:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "W": () => (/* binding */ hasClosestByHeadings)
/* harmony export */ });
/* unused harmony export hasClosestByTag */
// NOTE: 减少 method.ts 打包，故从 hasClosest.ts 中拆分
var hasClosestByTag = function (element, nodeName) {
    if (!element) {
        return false;
    }
    if (element.nodeType === 3) {
        element = element.parentElement;
    }
    var e = element;
    var isClosest = false;
    while (e && !isClosest && !e.classList.contains("vditor-reset")) {
        if (e.nodeName.indexOf(nodeName) === 0) {
            isClosest = true;
        }
        else {
            e = e.parentElement;
        }
    }
    return isClosest && e;
};
var hasClosestByHeadings = function (element) {
    var headingElement = hasClosestByTag(element, "H");
    if (headingElement && headingElement.tagName.length === 2 && headingElement.tagName !== "HR") {
        return headingElement;
    }
    return false;
};


/***/ }),

/***/ 640:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "T": () => (/* binding */ merge)
/* harmony export */ });
var merge = function () {
    var options = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        options[_i] = arguments[_i];
    }
    var target = {};
    var merger = function (obj) {
        for (var prop in obj) {
            if (obj.hasOwnProperty(prop)) {
                if (Object.prototype.toString.call(obj[prop]) === "[object Object]") {
                    target[prop] = merge(target[prop], obj[prop]);
                }
                else {
                    target[prop] = obj[prop];
                }
            }
        }
    };
    for (var i = 0; i < options.length; i++) {
        merger(options[i]);
    }
    return target;
};


/***/ }),

/***/ 393:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Hc": () => (/* binding */ setSelectionFocus)
/* harmony export */ });
/* unused harmony exports getEditorRange, getCursorPosition, selectIsEditor, getSelectPosition, setSelectionByPosition, setRangeByWbr, insertHTML */
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(54);



var getEditorRange = function (vditor) {
    var range;
    var element = vditor[vditor.currentMode].element;
    if (getSelection().rangeCount > 0) {
        range = getSelection().getRangeAt(0);
        if (element.isEqualNode(range.startContainer) || element.contains(range.startContainer)) {
            return range;
        }
    }
    if (vditor[vditor.currentMode].range) {
        return vditor[vditor.currentMode].range;
    }
    element.focus();
    range = element.ownerDocument.createRange();
    range.setStart(element, 0);
    range.collapse(true);
    return range;
};
var getCursorPosition = function (editor) {
    var range = window.getSelection().getRangeAt(0);
    if (!editor.contains(range.startContainer) && !hasClosestByClassName(range.startContainer, "vditor-panel--none")) {
        return {
            left: 0,
            top: 0,
        };
    }
    var parentRect = editor.parentElement.getBoundingClientRect();
    var cursorRect;
    if (range.getClientRects().length === 0) {
        if (range.startContainer.nodeType === 3) {
            // 空行时，会出现没有 br 的情况，需要根据父元素 <p> 获取位置信息
            var parent_1 = range.startContainer.parentElement;
            if (parent_1 && parent_1.getClientRects().length > 0) {
                cursorRect = parent_1.getClientRects()[0];
            }
            else {
                return {
                    left: 0,
                    top: 0,
                };
            }
        }
        else {
            var children = range.startContainer.children;
            if (children[range.startOffset] &&
                children[range.startOffset].getClientRects().length > 0) {
                // markdown 模式回车
                cursorRect = children[range.startOffset].getClientRects()[0];
            }
            else if (range.startContainer.childNodes.length > 0) {
                // in table or code block
                var cloneRange = range.cloneRange();
                range.selectNode(range.startContainer.childNodes[Math.max(0, range.startOffset - 1)]);
                cursorRect = range.getClientRects()[0];
                range.setEnd(cloneRange.endContainer, cloneRange.endOffset);
                range.setStart(cloneRange.startContainer, cloneRange.startOffset);
            }
            else {
                cursorRect = range.startContainer.getClientRects()[0];
            }
            if (!cursorRect) {
                var parentElement = range.startContainer.childNodes[range.startOffset];
                while (!parentElement.getClientRects ||
                    (parentElement.getClientRects && parentElement.getClientRects().length === 0)) {
                    parentElement = parentElement.parentElement;
                }
                cursorRect = parentElement.getClientRects()[0];
            }
        }
    }
    else {
        cursorRect = range.getClientRects()[0];
    }
    return {
        left: cursorRect.left - parentRect.left,
        top: cursorRect.top - parentRect.top,
    };
};
var selectIsEditor = function (editor, range) {
    if (!range) {
        if (getSelection().rangeCount === 0) {
            return false;
        }
        else {
            range = getSelection().getRangeAt(0);
        }
    }
    var container = range.commonAncestorContainer;
    return editor.isEqualNode(container) || editor.contains(container);
};
var setSelectionFocus = function (range) {
    var selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
};
var getSelectPosition = function (selectElement, editorElement, range) {
    var position = {
        end: 0,
        start: 0,
    };
    if (!range) {
        if (getSelection().rangeCount === 0) {
            return position;
        }
        range = window.getSelection().getRangeAt(0);
    }
    if (selectIsEditor(editorElement, range)) {
        var preSelectionRange = range.cloneRange();
        if (selectElement.childNodes[0] && selectElement.childNodes[0].childNodes[0]) {
            preSelectionRange.setStart(selectElement.childNodes[0].childNodes[0], 0);
        }
        else {
            preSelectionRange.selectNodeContents(selectElement);
        }
        preSelectionRange.setEnd(range.startContainer, range.startOffset);
        position.start = preSelectionRange.toString().length;
        position.end = position.start + range.toString().length;
    }
    return position;
};
var setSelectionByPosition = function (start, end, editor) {
    var charIndex = 0;
    var line = 0;
    var pNode = editor.childNodes[line];
    var foundStart = false;
    var stop = false;
    start = Math.max(0, start);
    end = Math.max(0, end);
    var range = editor.ownerDocument.createRange();
    range.setStart(pNode || editor, 0);
    range.collapse(true);
    while (!stop && pNode) {
        var nextCharIndex = charIndex + pNode.textContent.length;
        if (!foundStart && start >= charIndex && start <= nextCharIndex) {
            if (start === 0) {
                range.setStart(pNode, 0);
            }
            else {
                if (pNode.childNodes[0].nodeType === 3) {
                    range.setStart(pNode.childNodes[0], start - charIndex);
                }
                else if (pNode.nextSibling) {
                    range.setStartBefore(pNode.nextSibling);
                }
                else {
                    range.setStartAfter(pNode);
                }
            }
            foundStart = true;
            if (start === end) {
                stop = true;
                break;
            }
        }
        if (foundStart && end >= charIndex && end <= nextCharIndex) {
            if (end === 0) {
                range.setEnd(pNode, 0);
            }
            else {
                if (pNode.childNodes[0].nodeType === 3) {
                    range.setEnd(pNode.childNodes[0], end - charIndex);
                }
                else if (pNode.nextSibling) {
                    range.setEndBefore(pNode.nextSibling);
                }
                else {
                    range.setEndAfter(pNode);
                }
            }
            stop = true;
        }
        charIndex = nextCharIndex;
        pNode = editor.childNodes[++line];
    }
    if (!stop && editor.childNodes[line - 1]) {
        range.setStartBefore(editor.childNodes[line - 1]);
    }
    setSelectionFocus(range);
    return range;
};
var setRangeByWbr = function (element, range) {
    var wbrElement = element.querySelector("wbr");
    if (!wbrElement) {
        return;
    }
    if (!wbrElement.previousElementSibling) {
        if (wbrElement.previousSibling) {
            // text<wbr>
            range.setStart(wbrElement.previousSibling, wbrElement.previousSibling.textContent.length);
        }
        else if (wbrElement.nextSibling) {
            if (wbrElement.nextSibling.nodeType === 3) {
                // <wbr>text
                range.setStart(wbrElement.nextSibling, 0);
            }
            else {
                // <wbr><br> https://github.com/Vanessa219/vditor/issues/400
                range.setStartBefore(wbrElement.nextSibling);
            }
        }
        else {
            // 内容为空
            range.setStart(wbrElement.parentElement, 0);
        }
    }
    else {
        if (wbrElement.previousElementSibling.isSameNode(wbrElement.previousSibling)) {
            if (wbrElement.previousElementSibling.lastChild) {
                // <em>text</em><wbr>
                range.setStartBefore(wbrElement);
                range.collapse(true);
                setSelectionFocus(range);
                // fix Chrome set range bug: **c**
                if (isChrome() && (wbrElement.previousElementSibling.tagName === "EM" ||
                    wbrElement.previousElementSibling.tagName === "STRONG" ||
                    wbrElement.previousElementSibling.tagName === "S")) {
                    range.insertNode(document.createTextNode(Constants.ZWSP));
                    range.collapse(false);
                }
                wbrElement.remove();
                return;
            }
            else {
                // <br><wbr>
                range.setStartAfter(wbrElement.previousElementSibling);
            }
        }
        else {
            // <em>text</em>text<wbr>
            range.setStart(wbrElement.previousSibling, wbrElement.previousSibling.textContent.length);
        }
    }
    range.collapse(true);
    wbrElement.remove();
    setSelectionFocus(range);
};
var insertHTML = function (html, vditor) {
    // 使用 lute 方法会添加 p 元素，只有一个 p 元素的时候进行删除
    var tempElement = document.createElement("div");
    tempElement.innerHTML = html;
    var tempBlockElement = tempElement.querySelectorAll("p");
    if (tempBlockElement.length === 1 && !tempBlockElement[0].previousSibling && !tempBlockElement[0].nextSibling &&
        vditor[vditor.currentMode].element.children.length > 0 && tempElement.firstElementChild.tagName === "P") {
        html = tempBlockElement[0].innerHTML.trim();
    }
    var pasteElement = document.createElement("div");
    pasteElement.innerHTML = html;
    var range = getEditorRange(vditor);
    if (range.toString() !== "") {
        vditor[vditor.currentMode].preventInput = true;
        document.execCommand("delete", false, "");
    }
    if (pasteElement.firstElementChild &&
        pasteElement.firstElementChild.getAttribute("data-block") === "0") {
        // 粘贴内容为块元素时，应在下一段落中插入
        pasteElement.lastElementChild.insertAdjacentHTML("beforeend", "<wbr>");
        var blockElement = hasClosestBlock(range.startContainer);
        if (!blockElement) {
            vditor[vditor.currentMode].element.insertAdjacentHTML("beforeend", pasteElement.innerHTML);
        }
        else {
            blockElement.insertAdjacentHTML("afterend", pasteElement.innerHTML);
        }
        setRangeByWbr(vditor[vditor.currentMode].element, range);
    }
    else {
        var pasteTemplate = document.createElement("template");
        pasteTemplate.innerHTML = html;
        range.insertNode(pasteTemplate.content.cloneNode(true));
        range.collapse(false);
        setSelectionFocus(range);
    }
};


/***/ })

/******/ });
/************************************************************************/
/******/ // The module cache
/******/ var __webpack_module_cache__ = {};
/******/ 
/******/ // The require function
/******/ function __webpack_require__(moduleId) {
/******/ 	// Check if module is in cache
/******/ 	var cachedModule = __webpack_module_cache__[moduleId];
/******/ 	if (cachedModule !== undefined) {
/******/ 		return cachedModule.exports;
/******/ 	}
/******/ 	// Create a new module (and put it into the cache)
/******/ 	var module = __webpack_module_cache__[moduleId] = {
/******/ 		// no module.id needed
/******/ 		// no module.loaded needed
/******/ 		exports: {}
/******/ 	};
/******/ 
/******/ 	// Execute the module function
/******/ 	__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 
/******/ 	// Return the exports of the module
/******/ 	return module.exports;
/******/ }
/******/ 
/************************************************************************/
/******/ /* webpack/runtime/define property getters */
/******/ (() => {
/******/ 	// define getter functions for harmony exports
/******/ 	__webpack_require__.d = (exports, definition) => {
/******/ 		for(var key in definition) {
/******/ 			if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 				Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 			}
/******/ 		}
/******/ 	};
/******/ })();
/******/ 
/******/ /* webpack/runtime/hasOwnProperty shorthand */
/******/ (() => {
/******/ 	__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ })();
/******/ 
/******/ /* webpack/runtime/make namespace object */
/******/ (() => {
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = (exports) => {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/ })();
/******/ 
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "Z": () => (/* binding */ method)
});

// EXTERNAL MODULE: ./src/ts/markdown/abcRender.ts
var abcRender = __webpack_require__(478);
// EXTERNAL MODULE: ./src/ts/markdown/adapterRender.ts
var adapterRender = __webpack_require__(156);
// EXTERNAL MODULE: ./src/ts/markdown/chartRender.ts
var chartRender = __webpack_require__(314);
// EXTERNAL MODULE: ./src/ts/markdown/codeRender.ts
var codeRender = __webpack_require__(730);
// EXTERNAL MODULE: ./src/ts/markdown/flowchartRender.ts
var flowchartRender = __webpack_require__(66);
// EXTERNAL MODULE: ./src/ts/markdown/graphvizRender.ts
var graphvizRender = __webpack_require__(218);
// EXTERNAL MODULE: ./src/ts/markdown/highlightRender.ts
var highlightRender = __webpack_require__(702);
;// CONCATENATED MODULE: ./src/ts/markdown/lazyLoadImageRender.ts
var lazyLoadImageRender = function (element) {
    if (element === void 0) { element = document; }
    var loadImg = function (it) {
        var testImage = document.createElement("img");
        testImage.src = it.getAttribute("data-src");
        testImage.addEventListener("load", function () {
            if (!it.getAttribute("style") && !it.getAttribute("class") &&
                !it.getAttribute("width") && !it.getAttribute("height")) {
                if (testImage.naturalHeight > testImage.naturalWidth &&
                    testImage.naturalWidth / testImage.naturalHeight <
                        document.querySelector(".vditor-reset").clientWidth / (window.innerHeight - 40) &&
                    testImage.naturalHeight > (window.innerHeight - 40)) {
                    it.style.height = (window.innerHeight - 40) + "px";
                }
            }
            it.src = testImage.src;
        });
        it.removeAttribute("data-src");
    };
    if (!("IntersectionObserver" in window)) {
        element.querySelectorAll("img").forEach(function (imgElement) {
            if (imgElement.getAttribute("data-src")) {
                loadImg(imgElement);
            }
        });
        return false;
    }
    if (window.vditorImageIntersectionObserver) {
        window.vditorImageIntersectionObserver.disconnect();
        element.querySelectorAll("img").forEach(function (imgElement) {
            window.vditorImageIntersectionObserver.observe(imgElement);
        });
    }
    else {
        window.vditorImageIntersectionObserver = new IntersectionObserver(function (entries) {
            entries.forEach(function (entrie) {
                if ((typeof entrie.isIntersecting === "undefined"
                    ? entrie.intersectionRatio !== 0
                    : entrie.isIntersecting)
                    && entrie.target.getAttribute("data-src")) {
                    loadImg(entrie.target);
                }
            });
        });
        element.querySelectorAll("img").forEach(function (imgElement) {
            window.vditorImageIntersectionObserver.observe(imgElement);
        });
    }
};

// EXTERNAL MODULE: ./src/ts/markdown/mathRender.ts
var mathRender = __webpack_require__(466);
// EXTERNAL MODULE: ./src/ts/markdown/mediaRender.ts
var mediaRender = __webpack_require__(554);
// EXTERNAL MODULE: ./src/ts/markdown/mermaidRender.ts
var mermaidRender = __webpack_require__(40);
// EXTERNAL MODULE: ./src/ts/markdown/markmapRender.ts
var markmapRender = __webpack_require__(563);
// EXTERNAL MODULE: ./src/ts/markdown/mindmapRender.ts
var mindmapRender = __webpack_require__(749);
// EXTERNAL MODULE: ./src/ts/markdown/outlineRender.ts
var outlineRender = __webpack_require__(818);
// EXTERNAL MODULE: ./src/ts/markdown/plantumlRender.ts
var plantumlRender = __webpack_require__(408);
// EXTERNAL MODULE: ./src/ts/constants.ts
var constants = __webpack_require__(54);
// EXTERNAL MODULE: ./src/ts/ui/setContentTheme.ts
var setContentTheme = __webpack_require__(227);
// EXTERNAL MODULE: ./src/ts/util/addScript.ts
var addScript = __webpack_require__(526);
// EXTERNAL MODULE: ./src/ts/util/hasClosest.ts
var hasClosest = __webpack_require__(827);
// EXTERNAL MODULE: ./src/ts/util/merge.ts
var merge = __webpack_require__(640);
;// CONCATENATED MODULE: ./src/ts/markdown/anchorRender.ts
var anchorRender = function (type) {
    document.querySelectorAll(".vditor-anchor").forEach(function (anchor) {
        if (type === 1) {
            anchor.classList.add("vditor-anchor--left");
        }
        anchor.onclick = function () {
            var id = anchor.getAttribute("href").substr(1);
            var top = document.getElementById("vditorAnchor-" + id).offsetTop;
            document.querySelector("html").scrollTop = top;
        };
    });
    window.onhashchange = function () {
        var element = document.getElementById("vditorAnchor-" + decodeURIComponent(window.location.hash.substr(1)));
        if (element) {
            document.querySelector("html").scrollTop = element.offsetTop;
        }
    };
};

// EXTERNAL MODULE: ./src/ts/markdown/setLute.ts
var setLute = __webpack_require__(895);
// EXTERNAL MODULE: ./src/ts/util/selection.ts
var selection = __webpack_require__(393);
;// CONCATENATED MODULE: ./src/ts/markdown/speechRender.ts

var speechRender = function (element, lang) {
    if (lang === void 0) { lang = "zh_CN"; }
    if (typeof speechSynthesis === "undefined" || typeof SpeechSynthesisUtterance === "undefined") {
        return;
    }
    var playSVG = '<svg><use xlink:href="#vditor-icon-play"></use></svg>';
    var pauseSVG = '<svg><use xlink:href="#vditor-icon-pause"></use></svg>';
    if (!document.getElementById("vditorIconScript")) {
        playSVG = '<svg viewBox="0 0 32 32"><path d="M3.436 0l25.128 16-25.128 16v-32z"></path></svg>';
        pauseSVG = '<svg viewBox="0 0 32 32"><path d="M20.617 0h9.128v32h-9.128v-32zM2.255 32v-32h9.128v32h-9.128z"></path></svg>';
    }
    var speechDom = document.querySelector(".vditor-speech");
    if (!speechDom) {
        speechDom = document.createElement("div");
        speechDom.className = "vditor-speech";
        document.body.insertAdjacentElement("beforeend", speechDom);
        var getVoice = function () {
            var voices = speechSynthesis.getVoices();
            var currentVoice;
            var defaultVoice;
            voices.forEach(function (item) {
                if (item.lang === lang.replace("_", "-")) {
                    currentVoice = item;
                }
                if (item.default) {
                    defaultVoice = item;
                }
            });
            if (!currentVoice) {
                currentVoice = defaultVoice;
            }
            return currentVoice;
        };
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = getVoice;
        }
        var voice_1 = getVoice();
        speechDom.onclick = function () {
            if (speechDom.className === "vditor-speech") {
                var utterThis = new SpeechSynthesisUtterance(speechDom.getAttribute("data-text"));
                utterThis.voice = voice_1;
                utterThis.onend = function () {
                    speechDom.className = "vditor-speech";
                    speechSynthesis.cancel();
                    speechDom.innerHTML = playSVG;
                };
                speechSynthesis.speak(utterThis);
                speechDom.className = "vditor-speech vditor-speech--current";
                speechDom.innerHTML = pauseSVG;
            }
            else {
                if (speechSynthesis.speaking) {
                    if (speechSynthesis.paused) {
                        speechSynthesis.resume();
                        speechDom.innerHTML = pauseSVG;
                    }
                    else {
                        speechSynthesis.pause();
                        speechDom.innerHTML = playSVG;
                    }
                }
            }
            (0,selection/* setSelectionFocus */.Hc)(window.vditorSpeechRange);
        };
        document.body.addEventListener("click", function () {
            if (getSelection().toString().trim() === "" && speechDom.style.display === "block") {
                speechDom.className = "vditor-speech";
                speechSynthesis.cancel();
                speechDom.style.display = "none";
            }
        });
    }
    element.addEventListener("mouseup", function (event) {
        var text = getSelection().toString().trim();
        speechSynthesis.cancel();
        if (getSelection().toString().trim() === "") {
            if (speechDom.style.display === "block") {
                speechDom.className = "vditor-speech";
                speechDom.style.display = "none";
            }
            return;
        }
        window.vditorSpeechRange = getSelection().getRangeAt(0).cloneRange();
        var rect = getSelection().getRangeAt(0).getBoundingClientRect();
        speechDom.innerHTML = playSVG;
        speechDom.style.display = "block";
        speechDom.style.top = (rect.top + rect.height + document.querySelector("html").scrollTop - 20) + "px";
        speechDom.style.left = (event.clientX + 2) + "px";
        speechDom.setAttribute("data-text", text);
    });
};

;// CONCATENATED MODULE: ./src/ts/markdown/previewRender.ts
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};





















var mergeOptions = function (options) {
    var defaultOption = {
        anchor: 0,
        cdn: constants/* Constants.CDN */.g.CDN,
        dist: constants/* Constants.DIST */.g.DIST,
        staticPath: constants/* Constants.STATIC_PATH */.g.STATIC_PATH,
        customEmoji: {},
        emojiPath: ((options && options.emojiPath) || constants/* Constants.CDN */.g.CDN) + "/" + constants/* Constants.DIST */.g.DIST + "/" + constants/* Constants._STATIC_PATH.emoji */.g._STATIC_PATH.emoji,
        hljs: constants/* Constants.HLJS_OPTIONS */.g.HLJS_OPTIONS,
        icon: "ant",
        lang: "zh_CN",
        markdown: constants/* Constants.MARKDOWN_OPTIONS */.g.MARKDOWN_OPTIONS,
        math: constants/* Constants.MATH_OPTIONS */.g.MATH_OPTIONS,
        mode: "light",
        speech: {
            enable: false,
        },
        theme: constants/* Constants.THEME_OPTIONS */.g.THEME_OPTIONS,
    };
    return (0,merge/* merge */.T)(defaultOption, options);
};
var md2html = function (mdText, options) {
    var mergedOptions = mergeOptions(options);
    return (0,addScript/* addScript */.G)(mergedOptions.staticPath.lute, "vditorLuteScript").then(function () {
        var lute = (0,setLute/* setLute */.X)({
            autoSpace: mergedOptions.markdown.autoSpace,
            gfmAutoLink: mergedOptions.markdown.gfmAutoLink,
            codeBlockPreview: mergedOptions.markdown.codeBlockPreview,
            emojiSite: mergedOptions.emojiPath,
            emojis: mergedOptions.customEmoji,
            fixTermTypo: mergedOptions.markdown.fixTermTypo,
            footnotes: mergedOptions.markdown.footnotes,
            headingAnchor: mergedOptions.anchor !== 0,
            inlineMathDigit: mergedOptions.math.inlineDigit,
            lazyLoadImage: mergedOptions.lazyLoadImage,
            linkBase: mergedOptions.markdown.linkBase,
            linkPrefix: mergedOptions.markdown.linkPrefix,
            listStyle: mergedOptions.markdown.listStyle,
            mark: mergedOptions.markdown.mark,
            mathBlockPreview: mergedOptions.markdown.mathBlockPreview,
            paragraphBeginningSpace: mergedOptions.markdown.paragraphBeginningSpace,
            sanitize: mergedOptions.markdown.sanitize,
            toc: mergedOptions.markdown.toc,
        });
        if (options === null || options === void 0 ? void 0 : options.renderers) {
            lute.SetJSRenderers({
                renderers: {
                    Md2HTML: options.renderers,
                },
            });
        }
        lute.SetHeadingID(true);
        return lute.Md2HTML(mdText);
    });
};
var previewRender = function (previewElement, markdown, options) { return __awaiter(void 0, void 0, void 0, function () {
    var mergedOptions, html, i18nScriptPrefix, i18nScriptID_1;
    return __generator(this, function (_a) {
        switch (_a.label) {
            case 0:
                mergedOptions = mergeOptions(options);
                return [4 /*yield*/, md2html(markdown, mergedOptions)];
            case 1:
                html = _a.sent();
                if (mergedOptions.transform) {
                    html = mergedOptions.transform(html);
                }
                previewElement.innerHTML = html;
                previewElement.classList.add("vditor-reset");
                if (!!mergedOptions.i18n) return [3 /*break*/, 5];
                if (!!["en_US", "fr_FR", "pt_BR", "ja_JP", "ko_KR", "ru_RU", "sv_SE", "zh_CN", "zh_TW"].includes(mergedOptions.lang)) return [3 /*break*/, 2];
                throw new Error("options.lang error, see https://ld246.com/article/1549638745630#options");
            case 2:
                i18nScriptPrefix = "vditorI18nScript";
                i18nScriptID_1 = i18nScriptPrefix + mergedOptions.lang;
                document.querySelectorAll("head script[id^=\"" + i18nScriptPrefix + "\"]").forEach(function (el) {
                    if (el.id !== i18nScriptID_1) {
                        document.head.removeChild(el);
                    }
                });
                return [4 /*yield*/, (0,addScript/* addScript */.G)(mergedOptions.staticPath.i18n + "/" + mergedOptions.lang + ".js", i18nScriptID_1)];
            case 3:
                _a.sent();
                _a.label = 4;
            case 4: return [3 /*break*/, 6];
            case 5:
                window.VditorI18n = mergedOptions.i18n;
                _a.label = 6;
            case 6:
                if (!mergedOptions.icon) return [3 /*break*/, 8];
                return [4 /*yield*/, (0,addScript/* addScript */.G)(mergedOptions.staticPath.icons + "/" + mergedOptions.icon + ".js", "vditorIconScript")];
            case 7:
                _a.sent();
                _a.label = 8;
            case 8:
                (0,setContentTheme/* setContentTheme */.Z)(mergedOptions.theme.current, mergedOptions.theme.path);
                if (mergedOptions.anchor === 1) {
                    previewElement.classList.add("vditor-reset--anchor");
                }
                (0,codeRender/* codeRender */.O)(previewElement);
                (0,highlightRender/* highlightRender */.s)(mergedOptions.hljs, previewElement, mergedOptions.staticPath.highlight);
                (0,mathRender/* mathRender */.H)(previewElement, {
                    katex: mergedOptions.staticPath.katex,
                    mathjax: mergedOptions.staticPath.mathjax,
                    math: mergedOptions.math,
                });
                (0,mermaidRender/* mermaidRender */.i)(previewElement, mergedOptions.staticPath.mermaid, mergedOptions.mode);
                (0,markmapRender/* markmapRender */.K)(previewElement, mergedOptions.staticPath.markmap, mergedOptions.mode);
                (0,flowchartRender/* flowchartRender */.P)(previewElement, mergedOptions.staticPath.flowchart);
                (0,graphvizRender/* graphvizRender */.v)(previewElement, mergedOptions.staticPath.graphviz);
                (0,chartRender/* chartRender */.p)(previewElement, mergedOptions.staticPath.echarts, mergedOptions.mode);
                (0,mindmapRender/* mindmapRender */.P)(previewElement, mergedOptions.staticPath.echarts, mergedOptions.mode);
                (0,plantumlRender/* plantumlRender */.B)(previewElement, mergedOptions.staticPath.plantuml);
                (0,abcRender/* abcRender */.Q)(previewElement, mergedOptions.staticPath.abc);
                (0,mediaRender/* mediaRender */.Y)(previewElement);
                if (mergedOptions.speech.enable) {
                    speechRender(previewElement);
                }
                if (mergedOptions.anchor !== 0) {
                    anchorRender(mergedOptions.anchor);
                }
                if (mergedOptions.after) {
                    mergedOptions.after();
                }
                if (mergedOptions.lazyLoadImage) {
                    lazyLoadImageRender(previewElement);
                }
                previewElement.addEventListener("click", function (event) {
                    var spanElement = (0,hasClosest/* hasClosestByMatchTag */.lG)(event.target, "SPAN");
                    if (spanElement && (0,hasClosest/* hasClosestByClassName */.fb)(spanElement, "vditor-toc")) {
                        var headingElement = previewElement.querySelector("#" + spanElement.getAttribute("data-target-id"));
                        if (headingElement) {
                            window.scrollTo(window.scrollX, headingElement.offsetTop);
                        }
                        return;
                    }
                });
                return [2 /*return*/];
        }
    });
}); };

// EXTERNAL MODULE: ./src/ts/preview/image.ts
var preview_image = __webpack_require__(863);
// EXTERNAL MODULE: ./src/ts/ui/setCodeTheme.ts
var setCodeTheme = __webpack_require__(312);
;// CONCATENATED MODULE: ./src/method.ts




















var Vditor = /** @class */ (function () {
    function Vditor() {
    }
    /** 点击图片放大 */
    Vditor.adapterRender = adapterRender;
    /** 点击图片放大 */
    Vditor.previewImage = preview_image/* previewImage */.E;
    /** 为 element 中的代码块添加复制按钮 */
    Vditor.codeRender = codeRender/* codeRender */.O;
    /** 对 graphviz 进行渲染 */
    Vditor.graphvizRender = graphvizRender/* graphvizRender */.v;
    /** 为 element 中的代码块进行高亮渲染 */
    Vditor.highlightRender = highlightRender/* highlightRender */.s;
    /** 对数学公式进行渲染 */
    Vditor.mathRender = mathRender/* mathRender */.H;
    /** 流程图/时序图/甘特图渲染 */
    Vditor.mermaidRender = mermaidRender/* mermaidRender */.i;
    /** 支持markdown的思维导图 */
    Vditor.markmapRender = markmapRender/* markmapRender */.K;
    /** flowchart.js 渲染 */
    Vditor.flowchartRender = flowchartRender/* flowchartRender */.P;
    /** 图表渲染 */
    Vditor.chartRender = chartRender/* chartRender */.p;
    /** 五线谱渲染 */
    Vditor.abcRender = abcRender/* abcRender */.Q;
    /** 脑图渲染 */
    Vditor.mindmapRender = mindmapRender/* mindmapRender */.P;
    /** plantuml渲染 */
    Vditor.plantumlRender = plantumlRender/* plantumlRender */.B;
    /** 大纲渲染 */
    Vditor.outlineRender = outlineRender/* outlineRender */.k;
    /** 为[特定链接](https://github.com/Vanessa219/vditor/issues/7)分别渲染为视频、音频、嵌入的 iframe */
    Vditor.mediaRender = mediaRender/* mediaRender */.Y;
    /** 对选中的文字进行阅读 */
    Vditor.speechRender = speechRender;
    /** 对图片进行懒加载 */
    Vditor.lazyLoadImageRender = lazyLoadImageRender;
    /** Markdown 文本转换为 HTML，该方法需使用[异步编程](https://ld246.com/article/1546828434083?r=Vaness) */
    Vditor.md2html = md2html;
    /** 页面 Markdown 文章渲染 */
    Vditor.preview = previewRender;
    /** 设置代码主题 */
    Vditor.setCodeTheme = setCodeTheme/* setCodeTheme */.Y;
    /** 设置内容主题 */
    Vditor.setContentTheme = setContentTheme/* setContentTheme */.Z;
    return Vditor;
}());
/* harmony default export */ const method = (Vditor);

})();

var __webpack_exports__default = __webpack_exports__.Z;
export { __webpack_exports__default as default };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7Ozs7Ozs7Ozs7QUNyQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDVE87QUFDUDtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUNIeUQ7QUFDbEQ7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O0FDckpBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUMxQk87QUFDUDtBQUNBLHFCQUFxQix1QkFBdUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG9CQUFvQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztBQ3RCeUM7QUFDRTtBQUMyQjtBQUMvRDtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7U0Nu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QW1CO0FBQ3BEO0FBQ0EscUJBQXFCLE9BQU87QUFDNUI7QUFDQSxxQkFBcUIsYUFBYTtBQUNsQztBQUNBLDBCQUEwQixnQ0FBWTtBQUN0QztBQUNBLDZCQUE2QixzQ0FBZTtBQUM1QztBQUNBLENBQUM7QUFDRCw2Q0FBZSxNQUFNLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3IvLi9zcmMvdHMvY29uc3RhbnRzLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9hYmNSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL2FkYXB0ZXJSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL2NoYXJ0UmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9jb2RlUmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9mbG93Y2hhcnRSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL2dyYXBodml6UmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9oaWdobGlnaHRSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL21hcmttYXBSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL21hdGhSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL21lZGlhUmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9tZXJtYWlkUmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9taW5kbWFwUmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9vdXRsaW5lUmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9wbGFudHVtbFJlbmRlci50cyIsIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3IvLi9zcmMvdHMvbWFya2Rvd24vc2V0THV0ZS50cyIsIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3IvLi9zcmMvdHMvcHJldmlldy9pbWFnZS50cyIsIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3IvLi9zcmMvdHMvdWkvc2V0Q29kZVRoZW1lLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy91aS9zZXRDb250ZW50VGhlbWUudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL3V0aWwvYWRkU2NyaXB0LnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy91dGlsL2FkZFN0eWxlLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy91dGlsL2NvZGUxNjB0bzMyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy91dGlsL2hhc0Nsb3Nlc3QudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL3V0aWwvaGFzQ2xvc2VzdEJ5SGVhZGluZ3MudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL3V0aWwvbWVyZ2UudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL3V0aWwvc2VsZWN0aW9uLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3Ivd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9sYXp5TG9hZEltYWdlUmVuZGVyLnRzIiwid2VicGFjazovL0BzaXl1YW4tY29tbXVuaXR5L3ZkaXRvci8uL3NyYy90cy9tYXJrZG93bi9hbmNob3JSZW5kZXIudHMiLCJ3ZWJwYWNrOi8vQHNpeXVhbi1jb21tdW5pdHkvdmRpdG9yLy4vc3JjL3RzL21hcmtkb3duL3NwZWVjaFJlbmRlci50cyIsIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3IvLi9zcmMvdHMvbWFya2Rvd24vcHJldmlld1JlbmRlci50cyIsIndlYnBhY2s6Ly9Ac2l5dWFuLWNvbW11bml0eS92ZGl0b3IvLi9zcmMvbWV0aG9kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBfVkRJVE9SX1ZFUlNJT04gPSBWRElUT1JfVkVSU0lPTjtcclxuZXhwb3J0IHsgX1ZESVRPUl9WRVJTSU9OIGFzIFZESVRPUl9WRVJTSU9OIH07XHJcbnZhciBDb25zdGFudHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb25zdGFudHMoKSB7XHJcbiAgICB9XHJcbiAgICBDb25zdGFudHMuWldTUCA9IFwiXFx1MjAwYlwiO1xyXG4gICAgQ29uc3RhbnRzLkRST1BfRURJVE9SID0gXCJhcHBsaWNhdGlvbi9lZGl0b3JcIjtcclxuICAgIENvbnN0YW50cy5NT0JJTEVfV0lEVEggPSA1MjA7XHJcbiAgICBDb25zdGFudHMuQ0xBU1NfTUVOVV9ESVNBQkxFRCA9IFwidmRpdG9yLW1lbnUtLWRpc2FibGVkXCI7XHJcbiAgICBDb25zdGFudHMuRURJVF9UT09MQkFSUyA9IFtcImVtb2ppXCIsIFwiaGVhZGluZ3NcIiwgXCJib2xkXCIsIFwiaXRhbGljXCIsIFwic3RyaWtlXCIsIFwibGlua1wiLCBcImxpc3RcIixcclxuICAgICAgICBcIm9yZGVyZWQtbGlzdFwiLCBcIm91dGRlbnRcIiwgXCJpbmRlbnRcIiwgXCJjaGVja1wiLCBcImxpbmVcIiwgXCJxdW90ZVwiLCBcImNvZGVcIiwgXCJpbmxpbmUtY29kZVwiLCBcImluc2VydC1hZnRlclwiLFxyXG4gICAgICAgIFwiaW5zZXJ0LWJlZm9yZVwiLCBcInVwbG9hZFwiLCBcInJlY29yZFwiLCBcInRhYmxlXCJdO1xyXG4gICAgQ29uc3RhbnRzLkNPREVfVEhFTUUgPSBbXCJhYmFwXCIsIFwiYWxnb2xcIiwgXCJhbGdvbF9udVwiLCBcImFyZHVpbm9cIiwgXCJhdXR1bW5cIiwgXCJib3JsYW5kXCIsIFwiYndcIixcclxuICAgICAgICBcImNvbG9yZnVsXCIsIFwiZHJhY3VsYVwiLCBcImVtYWNzXCIsIFwiZnJpZW5kbHlcIiwgXCJmcnVpdHlcIiwgXCJnaXRodWJcIiwgXCJpZ29yXCIsIFwibG92ZWxhY2VcIiwgXCJtYW5uaVwiLCBcIm1vbm9rYWlcIixcclxuICAgICAgICBcIm1vbm9rYWlsaWdodFwiLCBcIm11cnBoeVwiLCBcIm5hdGl2ZVwiLCBcInBhcmFpc28tZGFya1wiLCBcInBhcmFpc28tbGlnaHRcIiwgXCJwYXN0aWVcIiwgXCJwZXJsZG9jXCIsIFwicHlnbWVudHNcIixcclxuICAgICAgICBcInJhaW5ib3dfZGFzaFwiLCBcInJydFwiLCBcInNvbGFyaXplZC1kYXJrXCIsIFwic29sYXJpemVkLWRhcmsyNTZcIiwgXCJzb2xhcml6ZWQtbGlnaHRcIiwgXCJzd2Fwb2ZmXCIsIFwidGFuZ29cIiwgXCJ0cmFjXCIsXHJcbiAgICAgICAgXCJ2aW1cIiwgXCJ2c1wiLCBcInhjb2RlXCIsIFwiYW50LWRlc2lnblwiXTtcclxuICAgIENvbnN0YW50cy5DT0RFX0xBTkdVQUdFUyA9IFtcIm1lcm1haWRcIiwgXCJlY2hhcnRzXCIsIFwibWluZG1hcFwiLCBcInBsYW50dW1sXCIsIFwiYWJjXCIsIFwiZ3JhcGh2aXpcIiwgXCJmbG93Y2hhcnRcIiwgXCJhcGFjaGVcIixcclxuICAgICAgICBcImpzXCIsIFwidHNcIiwgXCJodG1sXCIsIFwibWFya21hcFwiLFxyXG4gICAgICAgIC8vIGNvbW1vblxyXG4gICAgICAgIFwicHJvcGVydGllc1wiLCBcImFwYWNoZVwiLCBcImJhc2hcIiwgXCJjXCIsIFwiY3NoYXJwXCIsIFwiY3BwXCIsIFwiY3NzXCIsIFwiY29mZmVlc2NyaXB0XCIsIFwiZGlmZlwiLCBcImdvXCIsIFwieG1sXCIsIFwiaHR0cFwiLFxyXG4gICAgICAgIFwianNvblwiLCBcImphdmFcIiwgXCJqYXZhc2NyaXB0XCIsIFwia290bGluXCIsIFwibGVzc1wiLCBcImx1YVwiLCBcIm1ha2VmaWxlXCIsIFwibWFya2Rvd25cIiwgXCJuZ2lueFwiLCBcIm9iamVjdGl2ZWNcIiwgXCJwaHBcIixcclxuICAgICAgICBcInBocC10ZW1wbGF0ZVwiLCBcInBlcmxcIiwgXCJwbGFpbnRleHRcIiwgXCJweXRob25cIiwgXCJweXRob24tcmVwbFwiLCBcInJcIiwgXCJydWJ5XCIsIFwicnVzdFwiLCBcInNjc3NcIiwgXCJzcWxcIiwgXCJzaGVsbFwiLFxyXG4gICAgICAgIFwic3dpZnRcIiwgXCJpbmlcIiwgXCJ0eXBlc2NyaXB0XCIsIFwidmJuZXRcIiwgXCJ5YW1sXCIsXHJcbiAgICAgICAgXCJhZGFcIiwgXCJjbG9qdXJlXCIsIFwiZGFydFwiLCBcImVyYlwiLCBcImZvcnRyYW5cIiwgXCJncmFkbGVcIiwgXCJoYXNrZWxsXCIsIFwianVsaWFcIiwgXCJqdWxpYS1yZXBsXCIsIFwibGlzcFwiLCBcIm1hdGxhYlwiLFxyXG4gICAgICAgIFwicGdzcWxcIiwgXCJwb3dlcnNoZWxsXCIsIFwic3FsX21vcmVcIiwgXCJzdGF0YVwiLCBcImNtYWtlXCIsIFwibWF0aGVtYXRpY2FcIixcclxuICAgICAgICAvLyBleHRcclxuICAgICAgICBcInNvbGlkaXR5XCIsIFwieXVsXCJcclxuICAgIF07XHJcbiAgICBDb25zdGFudHMuQ0ROID0gXCJodHRwczovL3VucGtnLmNvbS92ZGl0b3JAXCIgKyBWRElUT1JfVkVSU0lPTjtcclxuICAgIENvbnN0YW50cy5ESVNUID0gXCJkaXN0XCI7XHJcbiAgICBDb25zdGFudHMuQkFTRV9VUkwgPSBDb25zdGFudHMuQ0ROICsgXCIvXCIgKyBDb25zdGFudHMuRElTVDtcclxuICAgIENvbnN0YW50cy5fU1RBVElDX1BBVEggPSB7XHJcbiAgICAgICAgbG9nbzogXCJpbWFnZXMvbG9nby5wbmdcIixcclxuICAgICAgICBtZXRob2Q6IFwibWV0aG9kLm1pbi5qc1wiLFxyXG4gICAgICAgIHN0eWxlOiBcImluZGV4LmNzc1wiLFxyXG4gICAgICAgIGVtb2ppOiBcImltYWdlcy9lbW9qaVwiLFxyXG4gICAgICAgIGkxOG46IFwianMvaTE4blwiLFxyXG4gICAgICAgIGljb25zOiBcImpzL2ljb25zXCIsXHJcbiAgICAgICAgdGhlbWU6IFwiY3NzL2NvbnRlbnQtdGhlbWVcIixcclxuICAgICAgICBhYmM6IFwianMvYWJjanMvYWJjanNfYmFzaWMubWluLmpzXCIsXHJcbiAgICAgICAgZWNoYXJ0czogXCJqcy9lY2hhcnRzL2VjaGFydHMubWluLmpzXCIsXHJcbiAgICAgICAgZmxvd2NoYXJ0OiBcImpzL2Zsb3djaGFydC5qcy9mbG93Y2hhcnQubWluLmpzXCIsXHJcbiAgICAgICAgZ3JhcGh2aXo6IFwianMvZ3JhcGh2aXovdml6LmpzXCIsXHJcbiAgICAgICAgbHV0ZTogXCJqcy9sdXRlL2x1dGUubWluLmpzXCIsXHJcbiAgICAgICAgbWFya21hcDogXCJqcy9tYXJrbWFwL21hcmttYXAubWluLmpzXCIsXHJcbiAgICAgICAgbWVybWFpZDogXCJqcy9tZXJtYWlkL21lcm1haWQubWluLmpzXCIsXHJcbiAgICAgICAgcGxhbnR1bWw6IFwianMvcGxhbnR1bWwvcGxhbnR1bWwtZW5jb2Rlci5taW4uanNcIixcclxuICAgICAgICBoaWdobGlnaHQ6IFwianMvaGlnaGxpZ2h0LmpzXCIsXHJcbiAgICAgICAga2F0ZXg6IFwianMva2F0ZXhcIixcclxuICAgICAgICBtYXRoamF4OiBcImpzL21hdGhqYXhcIixcclxuICAgIH07XHJcbiAgICBDb25zdGFudHMuU1RBVElDX1BBVEggPSB7XHJcbiAgICAgICAgbG9nbzogQ29uc3RhbnRzLkJBU0VfVVJMICsgXCIvXCIgKyBDb25zdGFudHMuX1NUQVRJQ19QQVRILmxvZ28sXHJcbiAgICAgICAgbWV0aG9kOiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEgubWV0aG9kLFxyXG4gICAgICAgIHN0eWxlOiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEguc3R5bGUsXHJcbiAgICAgICAgZW1vamk6IENvbnN0YW50cy5CQVNFX1VSTCArIFwiL1wiICsgQ29uc3RhbnRzLl9TVEFUSUNfUEFUSC5lbW9qaSxcclxuICAgICAgICBpMThuOiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEguaTE4bixcclxuICAgICAgICBpY29uczogQ29uc3RhbnRzLkJBU0VfVVJMICsgXCIvXCIgKyBDb25zdGFudHMuX1NUQVRJQ19QQVRILmljb25zLFxyXG4gICAgICAgIHRoZW1lOiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEgudGhlbWUsXHJcbiAgICAgICAgYWJjOiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEguYWJjLFxyXG4gICAgICAgIGVjaGFydHM6IENvbnN0YW50cy5CQVNFX1VSTCArIFwiL1wiICsgQ29uc3RhbnRzLl9TVEFUSUNfUEFUSC5lY2hhcnRzLFxyXG4gICAgICAgIGZsb3djaGFydDogQ29uc3RhbnRzLkJBU0VfVVJMICsgXCIvXCIgKyBDb25zdGFudHMuX1NUQVRJQ19QQVRILmZsb3djaGFydCxcclxuICAgICAgICBncmFwaHZpejogQ29uc3RhbnRzLkJBU0VfVVJMICsgXCIvXCIgKyBDb25zdGFudHMuX1NUQVRJQ19QQVRILmdyYXBodml6LFxyXG4gICAgICAgIGx1dGU6IENvbnN0YW50cy5CQVNFX1VSTCArIFwiL1wiICsgQ29uc3RhbnRzLl9TVEFUSUNfUEFUSC5sdXRlLFxyXG4gICAgICAgIG1hcmttYXA6IENvbnN0YW50cy5CQVNFX1VSTCArIFwiL1wiICsgQ29uc3RhbnRzLl9TVEFUSUNfUEFUSC5tYXJrbWFwLFxyXG4gICAgICAgIG1lcm1haWQ6IENvbnN0YW50cy5CQVNFX1VSTCArIFwiL1wiICsgQ29uc3RhbnRzLl9TVEFUSUNfUEFUSC5tZXJtYWlkLFxyXG4gICAgICAgIHBsYW50dW1sOiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEgucGxhbnR1bWwsXHJcbiAgICAgICAgaGlnaGxpZ2h0OiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEguaGlnaGxpZ2h0LFxyXG4gICAgICAgIGthdGV4OiBDb25zdGFudHMuQkFTRV9VUkwgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEgua2F0ZXgsXHJcbiAgICAgICAgbWF0aGpheDogQ29uc3RhbnRzLkJBU0VfVVJMICsgXCIvXCIgKyBDb25zdGFudHMuX1NUQVRJQ19QQVRILm1hdGhqYXgsXHJcbiAgICB9O1xyXG4gICAgQ29uc3RhbnRzLk1BUktET1dOX09QVElPTlMgPSB7XHJcbiAgICAgICAgYXV0b1NwYWNlOiBmYWxzZSxcclxuICAgICAgICBnZm1BdXRvTGluazogdHJ1ZSxcclxuICAgICAgICBjb2RlQmxvY2tQcmV2aWV3OiB0cnVlLFxyXG4gICAgICAgIGZpeFRlcm1UeXBvOiBmYWxzZSxcclxuICAgICAgICBmb290bm90ZXM6IHRydWUsXHJcbiAgICAgICAgbGlua0Jhc2U6IFwiXCIsXHJcbiAgICAgICAgbGlua1ByZWZpeDogXCJcIixcclxuICAgICAgICBsaXN0U3R5bGU6IGZhbHNlLFxyXG4gICAgICAgIG1hcms6IGZhbHNlLFxyXG4gICAgICAgIG1hdGhCbG9ja1ByZXZpZXc6IHRydWUsXHJcbiAgICAgICAgcGFyYWdyYXBoQmVnaW5uaW5nU3BhY2U6IGZhbHNlLFxyXG4gICAgICAgIHNhbml0aXplOiB0cnVlLFxyXG4gICAgICAgIHRvYzogZmFsc2UsXHJcbiAgICB9O1xyXG4gICAgQ29uc3RhbnRzLkhMSlNfT1BUSU9OUyA9IHtcclxuICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgbGluZU51bWJlcjogZmFsc2UsXHJcbiAgICAgICAgZGVmYXVsdExhbmc6IFwiXCIsXHJcbiAgICAgICAgc3R5bGU6IFwiZ2l0aHViXCIsXHJcbiAgICB9O1xyXG4gICAgQ29uc3RhbnRzLk1BVEhfT1BUSU9OUyA9IHtcclxuICAgICAgICBlbmdpbmU6IFwiS2FUZVhcIixcclxuICAgICAgICBpbmxpbmVEaWdpdDogZmFsc2UsXHJcbiAgICAgICAgbWFjcm9zOiB7fSxcclxuICAgIH07XHJcbiAgICBDb25zdGFudHMuVEhFTUVfT1BUSU9OUyA9IHtcclxuICAgICAgICBjdXJyZW50OiBcImxpZ2h0XCIsXHJcbiAgICAgICAgbGlzdDoge1xyXG4gICAgICAgICAgICBcImFudC1kZXNpZ25cIjogXCJBbnQgRGVzaWduXCIsXHJcbiAgICAgICAgICAgIFwiZGFya1wiOiBcIkRhcmtcIixcclxuICAgICAgICAgICAgXCJsaWdodFwiOiBcIkxpZ2h0XCIsXHJcbiAgICAgICAgICAgIFwid2VjaGF0XCI6IFwiV2VDaGF0XCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYXRoOiBDb25zdGFudHMuU1RBVElDX1BBVEgudGhlbWUsXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENvbnN0YW50cztcclxufSgpKTtcclxuZXhwb3J0IHsgQ29uc3RhbnRzIH07XHJcbiIsImltcG9ydCB7IENvbnN0YW50cyB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcclxuaW1wb3J0IHsgYWRkU2NyaXB0IH0gZnJvbSBcIi4uL3V0aWwvYWRkU2NyaXB0XCI7XHJcbmltcG9ydCB7IGFiY1JlbmRlckFkYXB0ZXIgfSBmcm9tIFwiLi9hZGFwdGVyUmVuZGVyXCI7XHJcbmV4cG9ydCB2YXIgYWJjUmVuZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGFiY1BhdGgpIHtcclxuICAgIGlmIChlbGVtZW50ID09PSB2b2lkIDApIHsgZWxlbWVudCA9IGRvY3VtZW50OyB9XHJcbiAgICBpZiAoYWJjUGF0aCA9PT0gdm9pZCAwKSB7IGFiY1BhdGggPSBDb25zdGFudHMuU1RBVElDX1BBVEguYWJjOyB9XHJcbiAgICB2YXIgYWJjRWxlbWVudHMgPSBhYmNSZW5kZXJBZGFwdGVyLmdldEVsZW1lbnRzKGVsZW1lbnQpO1xyXG4gICAgaWYgKGFiY0VsZW1lbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhZGRTY3JpcHQoYWJjUGF0aCwgXCJ2ZGl0b3JBYmNqc1NjcmlwdFwiKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYWJjRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3Itd3lzaXd5Z19fcHJlXCIpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1pcl9fbWFya2VyLS1wcmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiKSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBBQkNKUy5yZW5kZXJBYmMoaXRlbSwgYWJjUmVuZGVyQWRhcHRlci5nZXRDb2RlKGl0ZW0pLnRyaW0oKSk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLm92ZXJmbG93WCA9IFwiYXV0b1wiO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiLCBcInRydWVcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG4iLCJleHBvcnQgdmFyIG1hdGhSZW5kZXJBZGFwdGVyID0ge1xyXG4gICAgZ2V0Q29kZTogZnVuY3Rpb24gKG1hdGhFbGVtZW50KSB7IHJldHVybiBtYXRoRWxlbWVudC50ZXh0Q29udGVudDsgfSxcclxuICAgIGdldEVsZW1lbnRzOiBmdW5jdGlvbiAoZWxlbWVudCkgeyByZXR1cm4gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmd1YWdlLW1hdGhcIik7IH0sXHJcbn07XHJcbmV4cG9ydCB2YXIgbWVybWFpZFJlbmRlckFkYXB0ZXIgPSB7XHJcbiAgICAvKiog5LiN5LuF6KaB6L+U5ZueY29kZe+8jOW5tuS4lOmcgOimgeWwhiBjb2RlIOiuvue9ruS4uiBlbCDnmoQgaW5uZXJIVE1MICovXHJcbiAgICBnZXRDb2RlOiBmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLnRleHRDb250ZW50OyB9LFxyXG4gICAgZ2V0RWxlbWVudHM6IGZ1bmN0aW9uIChlbGVtZW50KSB7IHJldHVybiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubGFuZ3VhZ2UtbWVybWFpZFwiKTsgfSxcclxufTtcclxuZXhwb3J0IHZhciBtYXJrbWFwUmVuZGVyQWRhcHRlciA9IHtcclxuICAgIGdldENvZGU6IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwudGV4dENvbnRlbnQ7IH0sXHJcbiAgICBnZXRFbGVtZW50czogZnVuY3Rpb24gKGVsZW1lbnQpIHsgcmV0dXJuIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5sYW5ndWFnZS1tYXJrbWFwXCIpOyB9LFxyXG59O1xyXG5leHBvcnQgdmFyIG1pbmRtYXBSZW5kZXJBZGFwdGVyID0ge1xyXG4gICAgZ2V0Q29kZTogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNvZGVcIik7IH0sXHJcbiAgICBnZXRFbGVtZW50czogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmd1YWdlLW1pbmRtYXBcIik7IH0sXHJcbn07XHJcbmV4cG9ydCB2YXIgY2hhcnRSZW5kZXJBZGFwdGVyID0ge1xyXG4gICAgZ2V0Q29kZTogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5pbm5lclRleHQ7IH0sXHJcbiAgICBnZXRFbGVtZW50czogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmd1YWdlLWVjaGFydHNcIik7IH0sXHJcbn07XHJcbmV4cG9ydCB2YXIgYWJjUmVuZGVyQWRhcHRlciA9IHtcclxuICAgIGdldENvZGU6IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwudGV4dENvbnRlbnQ7IH0sXHJcbiAgICBnZXRFbGVtZW50czogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmd1YWdlLWFiY1wiKTsgfSxcclxufTtcclxuZXhwb3J0IHZhciBncmFwaHZpelJlbmRlckFkYXB0ZXIgPSB7XHJcbiAgICBnZXRDb2RlOiBmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLnRleHRDb250ZW50OyB9LFxyXG4gICAgZ2V0RWxlbWVudHM6IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwucXVlcnlTZWxlY3RvckFsbChcIi5sYW5ndWFnZS1ncmFwaHZpelwiKTsgfSxcclxufTtcclxuZXhwb3J0IHZhciBmbG93Y2hhcnRSZW5kZXJBZGFwdGVyID0ge1xyXG4gICAgZ2V0Q29kZTogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC50ZXh0Q29udGVudDsgfSxcclxuICAgIGdldEVsZW1lbnRzOiBmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubGFuZ3VhZ2UtZmxvd2NoYXJ0XCIpOyB9LFxyXG59O1xyXG5leHBvcnQgdmFyIHBsYW50dW1sUmVuZGVyQWRhcHRlciA9IHtcclxuICAgIGdldENvZGU6IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwudGV4dENvbnRlbnQ7IH0sXHJcbiAgICBnZXRFbGVtZW50czogZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiLmxhbmd1YWdlLXBsYW50dW1sXCIpOyB9LFxyXG59O1xyXG4iLCJpbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IGFkZFNjcmlwdCB9IGZyb20gXCIuLi91dGlsL2FkZFNjcmlwdFwiO1xyXG5pbXBvcnQgeyBjaGFydFJlbmRlckFkYXB0ZXIgfSBmcm9tIFwiLi9hZGFwdGVyUmVuZGVyXCI7XHJcbmV4cG9ydCB2YXIgY2hhcnRSZW5kZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZWNoYXJ0c1BhdGgsIHRoZW1lKSB7XHJcbiAgICBpZiAoZWxlbWVudCA9PT0gdm9pZCAwKSB7IGVsZW1lbnQgPSBkb2N1bWVudDsgfVxyXG4gICAgaWYgKGVjaGFydHNQYXRoID09PSB2b2lkIDApIHsgZWNoYXJ0c1BhdGggPSBDb25zdGFudHMuU1RBVElDX1BBVEguZWNoYXJ0czsgfVxyXG4gICAgdmFyIGVjaGFydHNFbGVtZW50cyA9IGNoYXJ0UmVuZGVyQWRhcHRlci5nZXRFbGVtZW50cyhlbGVtZW50KTtcclxuICAgIGlmIChlY2hhcnRzRWxlbWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGFkZFNjcmlwdChlY2hhcnRzUGF0aCwgXCJ2ZGl0b3JFY2hhcnRzU2NyaXB0XCIpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBlY2hhcnRzRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3Itd3lzaXd5Z19fcHJlXCIpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1pcl9fbWFya2VyLS1wcmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGNoYXJ0UmVuZGVyQWRhcHRlci5nZXRDb2RlKGUpLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1wcm9jZXNzZWRcIikgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IEpTT04ucGFyc2UodGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWNoYXJ0cy5pbml0KGUsIHRoZW1lID09PSBcImRhcmtcIiA/IFwiZGFya1wiIDogdW5kZWZpbmVkKS5zZXRPcHRpb24ob3B0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShcImRhdGEtcHJvY2Vzc2VkXCIsIFwidHJ1ZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuY2xhc3NOYW1lID0gXCJ2ZGl0b3ItcmVzZXQtLWVycm9yXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5pbm5lckhUTUwgPSBcImVjaGFydHMgcmVuZGVyIGVycm9yOiA8YnI+XCIgKyBlcnJvcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcbiIsImltcG9ydCB7IGNvZGUxNjB0bzMyIH0gZnJvbSBcIi4uL3V0aWwvY29kZTE2MHRvMzJcIjtcclxuaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xyXG5leHBvcnQgdmFyIGNvZGVSZW5kZXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwicHJlID4gY29kZVwiKS5mb3JFYWNoKGZ1bmN0aW9uIChlLCBpbmRleCkge1xyXG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xyXG4gICAgICAgIGlmIChlLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLXd5c2l3eWdfX3ByZVwiKSB8fFxyXG4gICAgICAgICAgICBlLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLWlyX19tYXJrZXItLXByZVwiKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlLmNsYXNzTGlzdC5jb250YWlucyhcImxhbmd1YWdlLW1lcm1haWRcIikgfHwgZS5jbGFzc0xpc3QuY29udGFpbnMoXCJsYW5ndWFnZS1mbG93Y2hhcnRcIikgfHxcclxuICAgICAgICAgICAgZS5jbGFzc0xpc3QuY29udGFpbnMoXCJsYW5ndWFnZS1lY2hhcnRzXCIpIHx8IGUuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtbWluZG1hcFwiKSB8fFxyXG4gICAgICAgICAgICBlLmNsYXNzTGlzdC5jb250YWlucyhcImxhbmd1YWdlLXBsYW50dW1sXCIpIHx8IGUuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtbWFya21hcFwiKSB8fFxyXG4gICAgICAgICAgICBlLmNsYXNzTGlzdC5jb250YWlucyhcImxhbmd1YWdlLWFiY1wiKSB8fCBlLmNsYXNzTGlzdC5jb250YWlucyhcImxhbmd1YWdlLWdyYXBodml6XCIpIHx8XHJcbiAgICAgICAgICAgIGUuY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtbWF0aFwiKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlLnN0eWxlLm1heEhlaWdodC5pbmRleE9mKFwicHhcIikgPiAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOmBv+WFjemihOiniOWMuuWcqOa4suafk+WQjueUseS6juS7o+eggeWdl+i/h+WkmuS6p+eUn+aAp+iDvemXrumimCBodHRwczovL2dpdGh1Yi5jb20vYjNsb2cvdmRpdG9yL2lzc3Vlcy82N1xyXG4gICAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1wcmV2aWV3XCIpICYmIGluZGV4ID4gNSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjb2RlVGV4dCA9IGUuaW5uZXJUZXh0O1xyXG4gICAgICAgIGlmIChlLmNsYXNzTGlzdC5jb250YWlucyhcImhpZ2hsaWdodC1jaHJvbWFcIikpIHtcclxuICAgICAgICAgICAgdmFyIGNvZGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNvZGVcIik7XHJcbiAgICAgICAgICAgIGNvZGVFbGVtZW50LmlubmVySFRNTCA9IGUuaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICBjb2RlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmhpZ2hsaWdodC1sblwiKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29kZVRleHQgPSBjb2RlRWxlbWVudC5pbm5lclRleHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNvZGVUZXh0LmVuZHNXaXRoKFwiXFxuXCIpKSB7XHJcbiAgICAgICAgICAgIGNvZGVUZXh0ID0gY29kZVRleHQuc3Vic3RyKDAsIGNvZGVUZXh0Lmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaWNvbkhUTUwgPSAnPHN2Zz48dXNlIHhsaW5rOmhyZWY9XCIjdmRpdG9yLWljb24tY29weVwiPjwvdXNlPjwvc3ZnPic7XHJcbiAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZkaXRvckljb25TY3JpcHRcIikpIHtcclxuICAgICAgICAgICAgaWNvbkhUTUwgPSAnPHN2ZyB2aWV3Qm94PVwiMCAwIDMyIDMyXCI+PHBhdGggZD1cIk0yMi41NDUtMGgtMTcuNDU1Yy0xLjYgMC0yLjkwOSAxLjMwOS0yLjkwOSAyLjkwOXYyMC4zNjRoMi45MDl2LTIwLjM2NGgxNy40NTV2LTIuOTA5ek0yNi45MDkgNS44MThoLTE2Yy0xLjYgMC0yLjkwOSAxLjMwOS0yLjkwOSAyLjkwOXYyMC4zNjRjMCAxLjYgMS4zMDkgMi45MDkgMi45MDkgMi45MDloMTZjMS42IDAgMi45MDktMS4zMDkgMi45MDktMi45MDl2LTIwLjM2NGMwLTEuNi0xLjMwOS0yLjkwOS0yLjkwOS0yLjkwOXpNMjYuOTA5IDI5LjA5MWgtMTZ2LTIwLjM2NGgxNnYyMC4zNjR6XCI+PC9wYXRoPjwvc3ZnPic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBkaXZFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBkaXZFbGVtZW50LmNsYXNzTmFtZSA9IFwidmRpdG9yLWNvcHlcIjtcclxuICAgICAgICBkaXZFbGVtZW50LmlubmVySFRNTCA9IFwiPHNwYW4gYXJpYS1sYWJlbD1cXFwiXCIgKyAoKChfYSA9IHdpbmRvdy5WZGl0b3JJMThuKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29weSkgfHwgXCLlpI3liLZcIikgKyBcIlxcXCJcXG5vbm1vdXNlb3Zlcj1cXFwidGhpcy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnXCIgKyAoKChfYiA9IHdpbmRvdy5WZGl0b3JJMThuKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY29weSkgfHwgXCLlpI3liLZcIikgKyBcIicpXFxcIlxcbmNsYXNzPVxcXCJ2ZGl0b3ItdG9vbHRpcHBlZCB2ZGl0b3ItdG9vbHRpcHBlZF9fd1xcXCJcXG5vbmNsaWNrPVxcXCJ0aGlzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuc2VsZWN0KCk7ZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTt0aGlzLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdcIiArICgoKF9jID0gd2luZG93LlZkaXRvckkxOG4pID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5jb3BpZWQpIHx8IFwi5bey5aSN5Yi2XCIpICsgXCInKVxcXCI+XCIgKyBpY29uSFRNTCArIFwiPC9zcGFuPlwiO1xyXG4gICAgICAgIHZhciB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcclxuICAgICAgICB0ZXh0YXJlYS52YWx1ZSA9IGNvZGUxNjB0bzMyKGNvZGVUZXh0KTtcclxuICAgICAgICBkaXZFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChcImFmdGVyYmVnaW5cIiwgdGV4dGFyZWEpO1xyXG4gICAgICAgIGUuYmVmb3JlKGRpdkVsZW1lbnQpO1xyXG4gICAgICAgIGUuc3R5bGUubWF4SGVpZ2h0ID0gKHdpbmRvdy5vdXRlckhlaWdodCAtIDQwKSArIFwicHhcIjtcclxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vVmFuZXNzYTIxOS92ZGl0b3IvaXNzdWVzLzEzNTZcclxuICAgICAgICBlLmluc2VydEFkamFjZW50SFRNTChcImFmdGVyZW5kXCIsIFwiPHNwYW4gc3R5bGU9XFxcInBvc2l0aW9uOiBhYnNvbHV0ZVxcXCI+XCIgKyBDb25zdGFudHMuWldTUCArIFwiPC9zcGFuPlwiKTtcclxuICAgIH0pO1xyXG59O1xyXG4iLCJpbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IGFkZFNjcmlwdCB9IGZyb20gXCIuLi91dGlsL2FkZFNjcmlwdFwiO1xyXG5pbXBvcnQgeyBmbG93Y2hhcnRSZW5kZXJBZGFwdGVyIH0gZnJvbSBcIi4vYWRhcHRlclJlbmRlclwiO1xyXG5leHBvcnQgdmFyIGZsb3djaGFydFJlbmRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCBmbG93Y2hhcnRQYXRoKSB7XHJcbiAgICBpZiAoZmxvd2NoYXJ0UGF0aCA9PT0gdm9pZCAwKSB7IGZsb3djaGFydFBhdGggPSBDb25zdGFudHMuU1RBVElDX1BBVEguZmxvd2NoYXJ0OyB9XHJcbiAgICB2YXIgZmxvd2NoYXJ0RWxlbWVudHMgPSBmbG93Y2hhcnRSZW5kZXJBZGFwdGVyLmdldEVsZW1lbnRzKGVsZW1lbnQpO1xyXG4gICAgaWYgKGZsb3djaGFydEVsZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGFkZFNjcmlwdChmbG93Y2hhcnRQYXRoLCBcInZkaXRvckZsb3djaGFydFNjcmlwdFwiKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBmbG93Y2hhcnRFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmdldEF0dHJpYnV0ZShcImRhdGEtcHJvY2Vzc2VkXCIpID09PSBcInRydWVcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBmbG93Y2hhcnRPYmogPSBmbG93Y2hhcnQucGFyc2UoZmxvd2NoYXJ0UmVuZGVyQWRhcHRlci5nZXRDb2RlKGl0ZW0pKTtcclxuICAgICAgICAgICAgaXRlbS5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgICAgICBmbG93Y2hhcnRPYmouZHJhd1NWRyhpdGVtKTtcclxuICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiLCBcInRydWVcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuIiwiaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBhZGRTY3JpcHQgfSBmcm9tIFwiLi4vdXRpbC9hZGRTY3JpcHRcIjtcclxuaW1wb3J0IHsgZ3JhcGh2aXpSZW5kZXJBZGFwdGVyIH0gZnJvbSBcIi4vYWRhcHRlclJlbmRlclwiO1xyXG5leHBvcnQgdmFyIGdyYXBodml6UmVuZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGdyYXBodml6UGF0aCkge1xyXG4gICAgaWYgKGdyYXBodml6UGF0aCA9PT0gdm9pZCAwKSB7IGdyYXBodml6UGF0aCA9IENvbnN0YW50cy5TVEFUSUNfUEFUSC5ncmFwaHZpejsgfVxyXG4gICAgdmFyIGdyYXBodml6RWxlbWVudHMgPSBncmFwaHZpelJlbmRlckFkYXB0ZXIuZ2V0RWxlbWVudHMoZWxlbWVudCk7XHJcbiAgICBpZiAoZ3JhcGh2aXpFbGVtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBhZGRTY3JpcHQoZ3JhcGh2aXpQYXRoLCBcInZkaXRvckdyYXBoVml6U2NyaXB0XCIpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGdyYXBodml6RWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgY29kZSA9IGdyYXBodml6UmVuZGVyQWRhcHRlci5nZXRDb2RlKGUpO1xyXG4gICAgICAgICAgICBpZiAoZS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci13eXNpd3lnX19wcmVcIikgfHxcclxuICAgICAgICAgICAgICAgIGUucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3ItaXJfX21hcmtlci0tcHJlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGUuZ2V0QXR0cmlidXRlKFwiZGF0YS1wcm9jZXNzZWRcIikgPT09IFwidHJ1ZVwiIHx8IGNvZGUudHJpbSgpID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW1wiaW1wb3J0U2NyaXB0cygnXCIgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZkaXRvckdyYXBoVml6U2NyaXB0XCIpLnNyYy5yZXBsYWNlKFwidml6LmpzXCIsIFwiZnVsbC5yZW5kZXIuanNcIikgKyBcIicpO1wiXSwgeyB0eXBlOiBcImFwcGxpY2F0aW9uL2phdmFzY3JpcHRcIiB9KTtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvYlVybCA9IHVybC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2VyID0gbmV3IFdvcmtlcihibG9iVXJsKTtcclxuICAgICAgICAgICAgICAgIG5ldyBWaXooeyB3b3JrZXI6IHdvcmtlciB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZW5kZXJTVkdFbGVtZW50KGNvZGUpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuaW5uZXJIVE1MID0gcmVzdWx0Lm91dGVySFRNTDtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuaW5uZXJIVE1MID0gXCJncmFwaHZpeiByZW5kZXIgZXJyb3I6IDxicj5cIiArIGVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuY2xhc3NOYW1lID0gXCJ2ZGl0b3ItcmVzZXQtLWVycm9yXCI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImdyYXBodml6IGVycm9yXCIsIGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKFwiZGF0YS1wcm9jZXNzZWRcIiwgXCJ0cnVlXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn07XHJcbiIsImltcG9ydCB7IENvbnN0YW50cyB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcclxuaW1wb3J0IHsgYWRkU2NyaXB0IH0gZnJvbSBcIi4uL3V0aWwvYWRkU2NyaXB0XCI7XHJcbmltcG9ydCB7IGFkZFN0eWxlIH0gZnJvbSBcIi4uL3V0aWwvYWRkU3R5bGVcIjtcclxuZXhwb3J0IHZhciBoaWdobGlnaHRSZW5kZXIgPSBmdW5jdGlvbiAoaGxqc09wdGlvbiwgZWxlbWVudCwgaGlnaGxpZ2h0UGF0aCkge1xyXG4gICAgaWYgKGVsZW1lbnQgPT09IHZvaWQgMCkgeyBlbGVtZW50ID0gZG9jdW1lbnQ7IH1cclxuICAgIGlmIChoaWdobGlnaHRQYXRoID09PSB2b2lkIDApIHsgaGlnaGxpZ2h0UGF0aCA9IENvbnN0YW50cy5TVEFUSUNfUEFUSC5oaWdobGlnaHQ7IH1cclxuICAgIHZhciBzdHlsZSA9IGhsanNPcHRpb24uc3R5bGU7XHJcbiAgICBpZiAoIUNvbnN0YW50cy5DT0RFX1RIRU1FLmluY2x1ZGVzKHN0eWxlKSkge1xyXG4gICAgICAgIHN0eWxlID0gXCJnaXRodWJcIjtcclxuICAgIH1cclxuICAgIHZhciB2ZGl0b3JIbGpzU3R5bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZkaXRvckhsanNTdHlsZVwiKTtcclxuICAgIHZhciBocmVmID0gaGlnaGxpZ2h0UGF0aCArIFwiL3N0eWxlcy9cIiArIHN0eWxlICsgXCIuY3NzXCI7XHJcbiAgICBpZiAodmRpdG9ySGxqc1N0eWxlICYmIHZkaXRvckhsanNTdHlsZS5ocmVmICE9PSBocmVmKSB7XHJcbiAgICAgICAgdmRpdG9ySGxqc1N0eWxlLnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gICAgYWRkU3R5bGUoaGlnaGxpZ2h0UGF0aCArIFwiL3N0eWxlcy9cIiArIHN0eWxlICsgXCIuY3NzXCIsIFwidmRpdG9ySGxqc1N0eWxlXCIpO1xyXG4gICAgaWYgKGhsanNPcHRpb24uZW5hYmxlID09PSBmYWxzZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciBjb2RlcyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcInByZSA+IGNvZGVcIik7XHJcbiAgICBpZiAoY29kZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgYWRkU2NyaXB0KGhpZ2hsaWdodFBhdGggKyBcIi9oaWdobGlnaHQucGFjay5qc1wiLCBcInZkaXRvckhsanNTY3JpcHRcIikudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgYWRkU2NyaXB0KGhpZ2hsaWdodFBhdGggKyBcIi9zb2xpZGl0eS5taW4uanNcIiwgXCJ2ZGl0b3JIbGpzU29saWRpdHlTY3JpcHRcIikudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGFkZFNjcmlwdChoaWdobGlnaHRQYXRoICsgXCIveXVsLm1pbi5qc1wiLCBcInZkaXRvckhsanNZdWxTY3JpcHRcIikudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJwcmUgPiBjb2RlXCIpLmZvckVhY2goZnVuY3Rpb24gKGJsb2NrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaXIgJiB3eXNpd3lnIOWMuuWfn+S4jea4suafk1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChibG9jay5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1pcl9fbWFya2VyLS1wcmVcIikgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2sucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3Itd3lzaXd5Z19fcHJlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrLmNsYXNzTGlzdC5jb250YWlucyhcImxhbmd1YWdlLW1lcm1haWRcIikgfHwgYmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtZmxvd2NoYXJ0XCIpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLmNsYXNzTGlzdC5jb250YWlucyhcImxhbmd1YWdlLWVjaGFydHNcIikgfHwgYmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtbWluZG1hcFwiKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5jbGFzc0xpc3QuY29udGFpbnMoXCJsYW5ndWFnZS1wbGFudHVtbFwiKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5jbGFzc0xpc3QuY29udGFpbnMoXCJsYW5ndWFnZS1hYmNcIikgfHwgYmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtZ3JhcGh2aXpcIikgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKFwibGFuZ3VhZ2UtbWF0aFwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChobGpzT3B0aW9uLmRlZmF1bHRMYW5nICE9PSBcIlwiICYmIGJsb2NrLmNsYXNzTmFtZS5pbmRleE9mKFwibGFuZ3VhZ2UtXCIpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5jbGFzc0xpc3QuYWRkKFwibGFuZ3VhZ2UtXCIgKyBobGpzT3B0aW9uLmRlZmF1bHRMYW5nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaGxqcy5oaWdobGlnaHRFbGVtZW50KGJsb2NrKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWhsanNPcHRpb24ubGluZU51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLmNsYXNzTGlzdC5hZGQoXCJ2ZGl0b3ItbGluZW51bWJlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGluZW5OdW1iZXJUZW1wID0gYmxvY2sucXVlcnlTZWxlY3RvcihcIi52ZGl0b3ItbGluZW51bWJlcl9fdGVtcFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWxpbmVuTnVtYmVyVGVtcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lbk51bWJlclRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lbk51bWJlclRlbXAuY2xhc3NOYW1lID0gXCJ2ZGl0b3ItbGluZW51bWJlcl9fdGVtcFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9jay5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJiZWZvcmVlbmRcIiwgbGluZW5OdW1iZXJUZW1wKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdoaXRlU3BhY2UgPSBnZXRDb21wdXRlZFN0eWxlKGJsb2NrKS53aGl0ZVNwYWNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1NvZnRXcmFwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdoaXRlU3BhY2UgPT09IFwicHJlLXdyYXBcIiB8fCB3aGl0ZVNwYWNlID09PSBcInByZS1saW5lXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTb2Z0V3JhcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5lTnVtYmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmVMaXN0ID0gYmxvY2sudGV4dENvbnRlbnQuc3BsaXQoL1xcclxcbnxcXHJ8XFxuL2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVMaXN0LnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVMaXN0Lm1hcChmdW5jdGlvbiAobGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGluZUhlaWdodCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1NvZnRXcmFwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lbk51bWJlclRlbXAudGV4dENvbnRlbnQgPSBsaW5lIHx8IFwiXFxuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gXCIgc3R5bGU9XFxcImhlaWdodDpcIiArIGxpbmVuTnVtYmVyVGVtcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgKyBcInB4XFxcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVOdW1iZXJIVE1MICs9IFwiPHNwYW5cIiArIGxpbmVIZWlnaHQgKyBcIj48L3NwYW4+XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZW5OdW1iZXJUZW1wLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lTnVtYmVySFRNTCA9IFwiPHNwYW4gY2xhc3M9XFxcInZkaXRvci1saW5lbnVtYmVyX19yb3dzXFxcIj5cIiArIGxpbmVOdW1iZXJIVE1MICsgXCI8L3NwYW4+XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYmxvY2suaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlZW5kXCIsIGxpbmVOdW1iZXJIVE1MKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG4iLCJpbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IGFkZFNjcmlwdCB9IGZyb20gXCIuLi91dGlsL2FkZFNjcmlwdFwiO1xyXG5pbXBvcnQgeyBtYXJrbWFwUmVuZGVyQWRhcHRlciB9IGZyb20gXCIuL2FkYXB0ZXJSZW5kZXJcIjtcclxudmFyIGVuYWJsZWQgPSB7fTtcclxudmFyIHRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0cmFuc2Zvcm1lciwgY29udGVudCkge1xyXG4gICAgdmFyIHJlc3VsdCA9IHRyYW5zZm9ybWVyLnRyYW5zZm9ybShjb250ZW50KTtcclxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMocmVzdWx0LmZlYXR1cmVzKS5maWx0ZXIoZnVuY3Rpb24gKGtleSkgeyByZXR1cm4gIWVuYWJsZWRba2V5XTsgfSk7XHJcbiAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIGVuYWJsZWRba2V5XSA9IHRydWU7XHJcbiAgICB9KTtcclxuICAgIHZhciBfYSA9IHRyYW5zZm9ybWVyLmdldEFzc2V0cyhrZXlzKSwgc3R5bGVzID0gX2Euc3R5bGVzLCBzY3JpcHRzID0gX2Euc2NyaXB0cztcclxuICAgIHZhciBtYXJrbWFwID0gd2luZG93Lm1hcmttYXA7XHJcbiAgICBpZiAoc3R5bGVzKVxyXG4gICAgICAgIG1hcmttYXAubG9hZENTUyhzdHlsZXMpO1xyXG4gICAgaWYgKHNjcmlwdHMpXHJcbiAgICAgICAgbWFya21hcC5sb2FkSlMoc2NyaXB0cyk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG52YXIgaW5pdCA9IGZ1bmN0aW9uIChlbCwgY29kZSkge1xyXG4gICAgdmFyIF9hID0gd2luZG93Lm1hcmttYXAsIFRyYW5zZm9ybWVyID0gX2EuVHJhbnNmb3JtZXIsIE1hcmttYXAgPSBfYS5NYXJrbWFwLCBkZXJpdmVPcHRpb25zID0gX2EuZGVyaXZlT3B0aW9ucywgZ2xvYmFsQ1NTID0gX2EuZ2xvYmFsQ1NTO1xyXG4gICAgdmFyIHRyYW5zZm9ybWVyID0gbmV3IFRyYW5zZm9ybWVyKCk7XHJcbiAgICBlbC5pbm5lckhUTUwgPSAnPHN2ZyBzdHlsZT1cIndpZHRoOjEwMCVcIj48L3N2Zz4nO1xyXG4gICAgdmFyIHN2ZyA9IGVsLmZpcnN0Q2hpbGQ7XHJcbiAgICB2YXIgbW0gPSBNYXJrbWFwLmNyZWF0ZShzdmcsIG51bGwpO1xyXG4gICAgdmFyIF9iID0gdHJhbnNmb3JtKHRyYW5zZm9ybWVyLCBjb2RlKSwgcm9vdCA9IF9iLnJvb3QsIGZyb250bWF0dGVyID0gX2IuZnJvbnRtYXR0ZXI7XHJcbiAgICB2YXIgbWFya21hcE9wdGlvbnMgPSBmcm9udG1hdHRlciA9PT0gbnVsbCB8fCBmcm9udG1hdHRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnJvbnRtYXR0ZXIubWFya21hcDtcclxuICAgIHZhciBmcm9udG1hdHRlck9wdGlvbnMgPSBkZXJpdmVPcHRpb25zKG1hcmttYXBPcHRpb25zKTtcclxuICAgIG1tLnNldERhdGEocm9vdCwgZnJvbnRtYXR0ZXJPcHRpb25zKTtcclxuICAgIG1tLmZpdCgpO1xyXG59O1xyXG5leHBvcnQgdmFyIG1hcmttYXBSZW5kZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgbWFya21hcFBhdGgsIHRoZW1lKSB7XHJcbiAgICBpZiAobWFya21hcFBhdGggPT09IHZvaWQgMCkgeyBtYXJrbWFwUGF0aCA9IENvbnN0YW50cy5TVEFUSUNfUEFUSC5tYXJrbWFwOyB9XHJcbiAgICB2YXIgbWFya21hcEVsZW1lbnRzID0gbWFya21hcFJlbmRlckFkYXB0ZXIuZ2V0RWxlbWVudHMoZWxlbWVudCk7XHJcbiAgICBpZiAobWFya21hcEVsZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGFkZFNjcmlwdChtYXJrbWFwUGF0aCwgXCJ2ZGl0b3JNZXJtYWlkU2NyaXB0XCIpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIG1hcmttYXBFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2RlID0gbWFya21hcFJlbmRlckFkYXB0ZXIuZ2V0Q29kZShpdGVtKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uZ2V0QXR0cmlidXRlKFwiZGF0YS1wcm9jZXNzZWRcIikgPT09IFwidHJ1ZVwiIHx8IGNvZGUudHJpbSgpID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlbmRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIHJlbmRlci5jbGFzc05hbWUgPSBcImxhbmd1YWdlLW1hcmttYXBcIjtcclxuICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHJlbmRlcik7XHJcbiAgICAgICAgICAgIGluaXQocmVuZGVyLCBjb2RlKTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ucGFyZW50Tm9kZS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09IFwiQ09ERVwiKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaXRlbS5wYXJlbnROb2RlLmNoaWxkTm9kZXNbMF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuIiwiaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBhZGRTY3JpcHQsIGFkZFNjcmlwdFN5bmMgfSBmcm9tIFwiLi4vdXRpbC9hZGRTY3JpcHRcIjtcclxuaW1wb3J0IHsgYWRkU3R5bGUgfSBmcm9tIFwiLi4vdXRpbC9hZGRTdHlsZVwiO1xyXG5pbXBvcnQgeyBjb2RlMTYwdG8zMiB9IGZyb20gXCIuLi91dGlsL2NvZGUxNjB0bzMyXCI7XHJcbmltcG9ydCB7IG1hdGhSZW5kZXJBZGFwdGVyIH0gZnJvbSBcIi4vYWRhcHRlclJlbmRlclwiO1xyXG5leHBvcnQgdmFyIG1hdGhSZW5kZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykge1xyXG4gICAgdmFyIG1hdGhFbGVtZW50cyA9IG1hdGhSZW5kZXJBZGFwdGVyLmdldEVsZW1lbnRzKGVsZW1lbnQpO1xyXG4gICAgaWYgKG1hdGhFbGVtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICAgICAga2F0ZXg6IENvbnN0YW50cy5TVEFUSUNfUEFUSC5rYXRleCxcclxuICAgICAgICBtYXRoamF4OiBDb25zdGFudHMuU1RBVElDX1BBVEgubWF0aGpheCxcclxuICAgICAgICBtYXRoOiB7XHJcbiAgICAgICAgICAgIGVuZ2luZTogXCJLYVRlWFwiLFxyXG4gICAgICAgICAgICBpbmxpbmVEaWdpdDogZmFsc2UsXHJcbiAgICAgICAgICAgIG1hY3Jvczoge30sXHJcbiAgICAgICAgfSxcclxuICAgIH07XHJcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLm1hdGgpIHtcclxuICAgICAgICBvcHRpb25zLm1hdGggPVxyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucy5tYXRoLCBvcHRpb25zLm1hdGgpO1xyXG4gICAgfVxyXG4gICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcclxuICAgIGlmIChvcHRpb25zLm1hdGguZW5naW5lID09PSBcIkthVGVYXCIpIHtcclxuICAgICAgICBhZGRTdHlsZShvcHRpb25zLmthdGV4ICsgXCIva2F0ZXgubWluLmNzc1wiLCBcInZkaXRvckthdGV4U3R5bGVcIik7XHJcbiAgICAgICAgYWRkU2NyaXB0KG9wdGlvbnMua2F0ZXggKyBcIi9rYXRleC5taW4uanNcIiwgXCJ2ZGl0b3JLYXRleFNjcmlwdFwiKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYWRkU2NyaXB0KG9wdGlvbnMua2F0ZXggKyBcIi9taGNoZW0ubWluLmpzXCIsIFwidmRpdG9yS2F0ZXhDaGVtU2NyaXB0XCIpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbWF0aEVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKG1hdGhFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGhFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLXd5c2l3eWdfX3ByZVwiKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRoRWxlbWVudC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1pcl9fbWFya2VyLS1wcmVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAobWF0aEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1tYXRoXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGggPSBjb2RlMTYwdG8zMihtYXRoUmVuZGVyQWRhcHRlci5nZXRDb2RlKG1hdGhFbGVtZW50KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1tYXRoXCIsIG1hdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGhFbGVtZW50LmlubmVySFRNTCA9IGthdGV4LnJlbmRlclRvU3RyaW5nKG1hdGgsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlNb2RlOiBtYXRoRWxlbWVudC50YWdOYW1lID09PSBcIkRJVlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiBcImh0bWxcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGhFbGVtZW50LmlubmVySFRNTCA9IGUubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0aEVsZW1lbnQuY2xhc3NOYW1lID0gXCJsYW5ndWFnZS1tYXRoIHZkaXRvci1yZXNldC0tZXJyb3JcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0aEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNvcHlcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmRpdG9yTWF0aEVsZW1lbnQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmNsb3Nlc3QoXCIubGFuZ3VhZ2UtbWF0aFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuY2xpcGJvYXJkRGF0YS5zZXREYXRhKFwidGV4dC9odG1sXCIsIHZkaXRvck1hdGhFbGVtZW50LmlubmVySFRNTCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmNsaXBib2FyZERhdGEuc2V0RGF0YShcInRleHQvcGxhaW5cIiwgdmRpdG9yTWF0aEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1tYXRoXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKG9wdGlvbnMubWF0aC5lbmdpbmUgPT09IFwiTWF0aEpheFwiKSB7XHJcbiAgICAgICAgdmFyIGNoYWluQXN5bmNfMSA9IGZ1bmN0aW9uIChmbnMpIHtcclxuICAgICAgICAgICAgaWYgKGZucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgY3VyciA9IDA7XHJcbiAgICAgICAgICAgIHZhciBsYXN0ID0gZm5zW2Zucy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgdmFyIG5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm4gPSBmbnNbY3VycisrXTtcclxuICAgICAgICAgICAgICAgIGZuID09PSBsYXN0ID8gZm4oKSA6IGZuKG5leHQpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoIXdpbmRvdy5NYXRoSmF4KSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4ID0ge1xyXG4gICAgICAgICAgICAgICAgbG9hZGVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aHM6IHsgbWF0aGpheDogb3B0aW9ucy5tYXRoamF4IH0sXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc3RhcnR1cDoge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGVzZXQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRleDoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hY3Jvczogb3B0aW9ucy5tYXRoLm1hY3JvcyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9WYW5lc3NhMjE5L3ZkaXRvci9pc3N1ZXMvMTQ1M1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHdpbmRvdy5NYXRoSmF4LCBvcHRpb25zLm1hdGgubWF0aEpheE9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlvqrnjq/liqDovb3kvJrmipvlvILluLhcclxuICAgICAgICBhZGRTY3JpcHRTeW5jKG9wdGlvbnMubWF0aGpheCArIFwiL3RleC1zdmctZnVsbC5qc1wiLCBcInByb3R5bGVNYXRoSmF4U2NyaXB0XCIpO1xyXG4gICAgICAgIHZhciByZW5kZXJNYXRoXzEgPSBmdW5jdGlvbiAobWF0aEVsZW1lbnQsIG5leHQpIHtcclxuICAgICAgICAgICAgdmFyIG1hdGggPSBjb2RlMTYwdG8zMihtYXRoRWxlbWVudC50ZXh0Q29udGVudCkudHJpbSgpO1xyXG4gICAgICAgICAgICB2YXIgbWF0aE9wdGlvbnMgPSB3aW5kb3cuTWF0aEpheC5nZXRNZXRyaWNzRm9yKG1hdGhFbGVtZW50KTtcclxuICAgICAgICAgICAgbWF0aE9wdGlvbnMuZGlzcGxheSA9IG1hdGhFbGVtZW50LnRhZ05hbWUgPT09IFwiRElWXCI7XHJcbiAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4LnRleDJzdmdQcm9taXNlKG1hdGgsIG1hdGhPcHRpb25zKS50aGVuKGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICAgICAgICAgICAgICBtYXRoRWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgbWF0aEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1tYXRoXCIsIG1hdGgpO1xyXG4gICAgICAgICAgICAgICAgbWF0aEVsZW1lbnQuYXBwZW5kKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXguc3RhcnR1cC5kb2N1bWVudC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXguc3RhcnR1cC5kb2N1bWVudC51cGRhdGVEb2N1bWVudCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yVGV4dEVsZW1lbnQgPSBub2RlLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1tbC1ub2RlPVwibWVycm9yXCJdJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3JUZXh0RWxlbWVudCAmJiBlcnJvclRleHRFbGVtZW50LnRleHRDb250ZW50LnRyaW0oKSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGhFbGVtZW50LmlubmVySFRNTCA9IGVycm9yVGV4dEVsZW1lbnQudGV4dENvbnRlbnQudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGhFbGVtZW50LmNsYXNzTmFtZSA9IFwidmRpdG9yLXJlc2V0LS1lcnJvclwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG5leHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgd2luZG93Lk1hdGhKYXguc3RhcnR1cC5wcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgY2hhaW5zID0gW107XHJcbiAgICAgICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXRoRWxlbWVudCA9IG1hdGhFbGVtZW50c1tpXTtcclxuICAgICAgICAgICAgICAgIGlmICghbWF0aEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3Itd3lzaXd5Z19fcHJlXCIpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgIW1hdGhFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLWlyX19tYXJrZXItLXByZVwiKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICFtYXRoRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLW1hdGhcIikgJiYgY29kZTE2MHRvMzIobWF0aEVsZW1lbnQudGV4dENvbnRlbnQpLnRyaW0oKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYWlucy5wdXNoKGZ1bmN0aW9uIChuZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBtYXRoRWxlbWVudHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyTWF0aF8xKG1hdGhFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlck1hdGhfMShtYXRoRWxlbWVudCwgbmV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXRoRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIF9sb29wXzEoaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2hhaW5Bc3luY18xKGNoYWlucyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcbiIsInZhciB2aWRlb1JlbmRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCB1cmwpIHtcclxuICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgXCI8dmlkZW8gY29udHJvbHM9XFxcImNvbnRyb2xzXFxcIiBzcmM9XFxcIlwiICsgdXJsICsgXCJcXFwiPjwvdmlkZW8+XCIpO1xyXG4gICAgZWxlbWVudC5yZW1vdmUoKTtcclxufTtcclxudmFyIGF1ZGlvUmVuZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHVybCkge1xyXG4gICAgZWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoXCJhZnRlcmVuZFwiLCBcIjxhdWRpbyBjb250cm9scz1cXFwiY29udHJvbHNcXFwiIHNyYz1cXFwiXCIgKyB1cmwgKyBcIlxcXCI+PC9hdWRpbz5cIik7XHJcbiAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG59O1xyXG52YXIgaWZyYW1lUmVuZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHVybCkge1xyXG4gICAgdmFyIHlvdXR1YmVNYXRjaCA9IHVybC5tYXRjaCgvXFwvXFwvKD86d3d3XFwuKT8oPzp5b3V0dVxcLmJlXFwvfHlvdXR1YmVcXC5jb21cXC8oPzplbWJlZFxcL3x2XFwvfHdhdGNoXFw/dj18d2F0Y2hcXD8uKyZ2PSkpKFtcXHd8LV17MTF9KSg/Oig/OltcXD8mXXQ9KShcXFMrKSk/Lyk7XHJcbiAgICB2YXIgeW91a3VNYXRjaCA9IHVybC5tYXRjaCgvXFwvXFwvdlxcLnlvdWt1XFwuY29tXFwvdl9zaG93XFwvaWRfKFxcdyspPSpcXC5odG1sLyk7XHJcbiAgICB2YXIgcXFNYXRjaCA9IHVybC5tYXRjaCgvXFwvXFwvdlxcLnFxXFwuY29tXFwveFxcL2NvdmVyXFwvLipcXC8oW15cXC9dKylcXC5odG1sXFw/Py4qLyk7XHJcbiAgICB2YXIgY291Yk1hdGNoID0gdXJsLm1hdGNoKC8oPzp3d3dcXC58XFwvXFwvKWNvdWJcXC5jb21cXC92aWV3XFwvKFxcdyspLyk7XHJcbiAgICB2YXIgZmFjZWJvb2tNYXRjaCA9IHVybC5tYXRjaCgvKD86d3d3XFwufFxcL1xcLylmYWNlYm9va1xcLmNvbVxcLyhbXlxcL10rKVxcL3ZpZGVvc1xcLyhbMC05XSspLyk7XHJcbiAgICB2YXIgZGFpbHltb3Rpb25NYXRjaCA9IHVybC5tYXRjaCgvLitkYWlseW1vdGlvbi5jb21cXC8odmlkZW98aHViKVxcLyhcXHcrKVxcPy8pO1xyXG4gICAgdmFyIGJpbGliaWxpTWF0Y2ggPSB1cmwubWF0Y2goLyg/Ond3d1xcLnxcXC9cXC8pYmlsaWJpbGlcXC5jb21cXC92aWRlb1xcLyhcXHcrKS8pO1xyXG4gICAgdmFyIHRlZE1hdGNoID0gdXJsLm1hdGNoKC8oPzp3d3dcXC58XFwvXFwvKXRlZFxcLmNvbVxcL3RhbGtzXFwvKFxcdyspLyk7XHJcbiAgICBpZiAoeW91dHViZU1hdGNoICYmIHlvdXR1YmVNYXRjaFsxXS5sZW5ndGggPT09IDExKSB7XHJcbiAgICAgICAgZWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoXCJhZnRlcmVuZFwiLCBcIjxpZnJhbWUgY2xhc3M9XFxcImlmcmFtZV9fdmlkZW9cXFwiIHNyYz1cXFwiLy93d3cueW91dHViZS5jb20vZW1iZWQvXCIgKyAoeW91dHViZU1hdGNoWzFdICtcclxuICAgICAgICAgICAgKHlvdXR1YmVNYXRjaFsyXSA/IFwiP3N0YXJ0PVwiICsgeW91dHViZU1hdGNoWzJdIDogXCJcIikpICsgXCJcXFwiPjwvaWZyYW1lPlwiKTtcclxuICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoeW91a3VNYXRjaCAmJiB5b3VrdU1hdGNoWzFdKSB7XHJcbiAgICAgICAgZWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoXCJhZnRlcmVuZFwiLCBcIjxpZnJhbWUgY2xhc3M9XFxcImlmcmFtZV9fdmlkZW9cXFwiIHNyYz1cXFwiLy9wbGF5ZXIueW91a3UuY29tL2VtYmVkL1wiICsgeW91a3VNYXRjaFsxXSArIFwiXFxcIj48L2lmcmFtZT5cIik7XHJcbiAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHFxTWF0Y2ggJiYgcXFNYXRjaFsxXSkge1xyXG4gICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgXCI8aWZyYW1lIGNsYXNzPVxcXCJpZnJhbWVfX3ZpZGVvXFxcIiBzcmM9XFxcImh0dHBzOi8vdi5xcS5jb20vdHhwL2lmcmFtZS9wbGF5ZXIuaHRtbD92aWQ9XCIgKyBxcU1hdGNoWzFdICsgXCJcXFwiPjwvaWZyYW1lPlwiKTtcclxuICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoY291Yk1hdGNoICYmIGNvdWJNYXRjaFsxXSkge1xyXG4gICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgXCI8aWZyYW1lIGNsYXNzPVxcXCJpZnJhbWVfX3ZpZGVvXFxcIlxcbiBzcmM9XFxcIi8vY291Yi5jb20vZW1iZWQvXCIgKyBjb3ViTWF0Y2hbMV0gKyBcIj9tdXRlZD1mYWxzZSZhdXRvc3RhcnQ9ZmFsc2Umb3JpZ2luYWxTaXplPXRydWUmc3RhcnRXaXRoSEQ9dHJ1ZVxcXCI+PC9pZnJhbWU+XCIpO1xyXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChmYWNlYm9va01hdGNoICYmIGZhY2Vib29rTWF0Y2hbMF0pIHtcclxuICAgICAgICBlbGVtZW50Lmluc2VydEFkamFjZW50SFRNTChcImFmdGVyZW5kXCIsIFwiPGlmcmFtZSBjbGFzcz1cXFwiaWZyYW1lX192aWRlb1xcXCJcXG4gc3JjPVxcXCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vcGx1Z2lucy92aWRlby5waHA/aHJlZj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChmYWNlYm9va01hdGNoWzBdKSArIFwiXFxcIj48L2lmcmFtZT5cIik7XHJcbiAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGRhaWx5bW90aW9uTWF0Y2ggJiYgZGFpbHltb3Rpb25NYXRjaFsyXSkge1xyXG4gICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgXCI8aWZyYW1lIGNsYXNzPVxcXCJpZnJhbWVfX3ZpZGVvXFxcIlxcbiBzcmM9XFxcImh0dHBzOi8vd3d3LmRhaWx5bW90aW9uLmNvbS9lbWJlZC92aWRlby9cIiArIGRhaWx5bW90aW9uTWF0Y2hbMl0gKyBcIlxcXCI+PC9pZnJhbWU+XCIpO1xyXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChiaWxpYmlsaU1hdGNoICYmIGJpbGliaWxpTWF0Y2hbMV0pIHtcclxuICAgICAgICBlbGVtZW50Lmluc2VydEFkamFjZW50SFRNTChcImFmdGVyZW5kXCIsIFwiPGlmcmFtZSBjbGFzcz1cXFwiaWZyYW1lX192aWRlb1xcXCJcXG4gc3JjPVxcXCIvL3BsYXllci5iaWxpYmlsaS5jb20vcGxheWVyLmh0bWw/YnZpZD1cIiArIGJpbGliaWxpTWF0Y2hbMV0gKyBcIlxcXCI+PC9pZnJhbWU+XCIpO1xyXG4gICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0ZWRNYXRjaCAmJiB0ZWRNYXRjaFsxXSkge1xyXG4gICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgXCI8aWZyYW1lIGNsYXNzPVxcXCJpZnJhbWVfX3ZpZGVvXFxcIiBzcmM9XFxcIi8vZW1iZWQudGVkLmNvbS90YWxrcy9cIiArIHRlZE1hdGNoWzFdICsgXCJcXFwiPjwvaWZyYW1lPlwiKTtcclxuICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfVxyXG59O1xyXG5leHBvcnQgdmFyIG1lZGlhUmVuZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgIGlmICghZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImFcIikuZm9yRWFjaChmdW5jdGlvbiAoYUVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgdXJsID0gYUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKTtcclxuICAgICAgICBpZiAoIXVybCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1cmwubWF0Y2goL14uKy4obXA0fG00dnxvZ2d8b2d2fHdlYm0pJC8pKSB7XHJcbiAgICAgICAgICAgIHZpZGVvUmVuZGVyKGFFbGVtZW50LCB1cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh1cmwubWF0Y2goL14uKy4obXAzfHdhdnxmbGFjKSQvKSkge1xyXG4gICAgICAgICAgICBhdWRpb1JlbmRlcihhRWxlbWVudCwgdXJsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmcmFtZVJlbmRlcihhRWxlbWVudCwgdXJsKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuIiwiaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBhZGRTY3JpcHQgfSBmcm9tIFwiLi4vdXRpbC9hZGRTY3JpcHRcIjtcclxuaW1wb3J0IHsgbWVybWFpZFJlbmRlckFkYXB0ZXIgfSBmcm9tIFwiLi9hZGFwdGVyUmVuZGVyXCI7XHJcbmV4cG9ydCB2YXIgbWVybWFpZFJlbmRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCBtZXJtYWlkUGF0aCwgdGhlbWUpIHtcclxuICAgIGlmIChtZXJtYWlkUGF0aCA9PT0gdm9pZCAwKSB7IG1lcm1haWRQYXRoID0gQ29uc3RhbnRzLlNUQVRJQ19QQVRILm1lcm1haWQ7IH1cclxuICAgIHZhciBtZXJtYWlkRWxlbWVudHMgPSBtZXJtYWlkUmVuZGVyQWRhcHRlci5nZXRFbGVtZW50cyhlbGVtZW50KTtcclxuICAgIGlmIChtZXJtYWlkRWxlbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgYWRkU2NyaXB0KG1lcm1haWRQYXRoLCBcInZkaXRvck1lcm1haWRTY3JpcHRcIikudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcclxuICAgICAgICAgICAgc2VjdXJpdHlMZXZlbDogXCJsb29zZVwiLFxyXG4gICAgICAgICAgICBhbHRGb250RmFtaWx5OiBcInNhbnMtc2VyaWZcIixcclxuICAgICAgICAgICAgZm9udEZhbWlseTogXCJzYW5zLXNlcmlmXCIsXHJcbiAgICAgICAgICAgIHN0YXJ0T25Mb2FkOiBmYWxzZSxcclxuICAgICAgICAgICAgZmxvd2NoYXJ0OiB7XHJcbiAgICAgICAgICAgICAgICBodG1sTGFiZWxzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdXNlTWF4V2lkdGg6ICEwXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNlcXVlbmNlOiB7XHJcbiAgICAgICAgICAgICAgICB1c2VNYXhXaWR0aDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGRpYWdyYW1NYXJnaW5YOiA4LFxyXG4gICAgICAgICAgICAgICAgZGlhZ3JhbU1hcmdpblk6IDgsXHJcbiAgICAgICAgICAgICAgICBib3hNYXJnaW46IDhcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ2FudHQ6IHtcclxuICAgICAgICAgICAgICAgIGxlZnRQYWRkaW5nOiA3NSxcclxuICAgICAgICAgICAgICAgIHJpZ2h0UGFkZGluZzogMjBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoZW1lID09PSBcImRhcmtcIikge1xyXG4gICAgICAgICAgICBjb25maWcudGhlbWUgPSBcImRhcmtcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWVybWFpZC5pbml0aWFsaXplKGNvbmZpZyk7XHJcbiAgICAgICAgbWVybWFpZEVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgdmFyIGNvZGUgPSBtZXJtYWlkUmVuZGVyQWRhcHRlci5nZXRDb2RlKGl0ZW0pO1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiKSA9PT0gXCJ0cnVlXCIgfHwgY29kZS50cmltKCkgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtZXJtYWlkLmluaXQodW5kZWZpbmVkLCBpdGVtKTtcclxuICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiLCBcInRydWVcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuIiwiaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBhZGRTY3JpcHQgfSBmcm9tIFwiLi4vdXRpbC9hZGRTY3JpcHRcIjtcclxuaW1wb3J0IHsgbWluZG1hcFJlbmRlckFkYXB0ZXIgfSBmcm9tIFwiLi9hZGFwdGVyUmVuZGVyXCI7XHJcbmV4cG9ydCB2YXIgbWluZG1hcFJlbmRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCBlY2hhcnRzUGF0aCwgdGhlbWUpIHtcclxuICAgIGlmIChlbGVtZW50ID09PSB2b2lkIDApIHsgZWxlbWVudCA9IGRvY3VtZW50OyB9XHJcbiAgICBpZiAoZWNoYXJ0c1BhdGggPT09IHZvaWQgMCkgeyBlY2hhcnRzUGF0aCA9IENvbnN0YW50cy5TVEFUSUNfUEFUSC5lY2hhcnRzOyB9XHJcbiAgICB2YXIgbWluZG1hcEVsZW1lbnRzID0gbWluZG1hcFJlbmRlckFkYXB0ZXIuZ2V0RWxlbWVudHMoZWxlbWVudCk7XHJcbiAgICBpZiAobWluZG1hcEVsZW1lbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhZGRTY3JpcHQoZWNoYXJ0c1BhdGgsIFwidmRpdG9yRWNoYXJ0c1NjcmlwdFwiKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbWluZG1hcEVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLXd5c2l3eWdfX3ByZVwiKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgIGUucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3ItaXJfX21hcmtlci0tcHJlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBtaW5kbWFwUmVuZGVyQWRhcHRlci5nZXRDb2RlKGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiKSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlY2hhcnRzLmluaXQoZSwgdGhlbWUgPT09IFwiZGFya1wiID8gXCJkYXJrXCIgOiB1bmRlZmluZWQpLnNldE9wdGlvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllczogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IFtKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudCh0ZXh0KSldLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxUcmVlRGVwdGg6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1TdHlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IFwiIzQyODVmNFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNmNmY4ZmFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IFwiI2QxZDVkYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcIiM1ODYwNjlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogMjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogWy01LCAwXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogWzAsIDVdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJpbnNpZGVSaWdodFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZVN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcIiNkMWQ1ZGFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2FtOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bWJvbDogZnVuY3Rpb24gKHZhbHVlLCBwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKF9hID0gcGFyYW1zID09PSBudWxsIHx8IHBhcmFtcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyYW1zLmRhdGEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY2lyY2xlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJwYXRoOi8vXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidHJlZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogXCJpdGVtXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyT246IFwibW91c2Vtb3ZlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXByb2Nlc3NlZFwiLCBcInRydWVcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBlLmNsYXNzTmFtZSA9IFwidmRpdG9yLXJlc2V0LS1lcnJvclwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuaW5uZXJIVE1MID0gXCJtaW5kbWFwIHJlbmRlciBlcnJvcjogPGJyPlwiICsgZXJyb3I7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG4iLCJpbXBvcnQgeyBoYXNDbG9zZXN0QnlIZWFkaW5ncyB9IGZyb20gXCIuLi91dGlsL2hhc0Nsb3Nlc3RCeUhlYWRpbmdzXCI7XHJcbmltcG9ydCB7IG1hdGhSZW5kZXIgfSBmcm9tIFwiLi9tYXRoUmVuZGVyXCI7XHJcbmV4cG9ydCB2YXIgb3V0bGluZVJlbmRlciA9IGZ1bmN0aW9uIChjb250ZW50RWxlbWVudCwgdGFyZ2V0RWxlbWVudCwgdmRpdG9yKSB7XHJcbiAgICB2YXIgdG9jSFRNTCA9IFwiXCI7XHJcbiAgICB2YXIgaWRzID0gW107XHJcbiAgICBBcnJheS5mcm9tKGNvbnRlbnRFbGVtZW50LmNoaWxkcmVuKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgIGlmIChoYXNDbG9zZXN0QnlIZWFkaW5ncyhpdGVtKSkge1xyXG4gICAgICAgICAgICBpZiAodmRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGFzdEluZGV4ID0gaXRlbS5pZC5sYXN0SW5kZXhPZihcIl9cIik7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmlkID0gaXRlbS5pZC5zdWJzdHJpbmcoMCwgbGFzdEluZGV4ID09PSAtMSA/IHVuZGVmaW5lZCA6IGxhc3RJbmRleCkgKyBcIl9cIiArIGluZGV4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlkcy5wdXNoKGl0ZW0uaWQpO1xyXG4gICAgICAgICAgICB0b2NIVE1MICs9IGl0ZW0ub3V0ZXJIVE1MLnJlcGxhY2UoXCI8d2JyPlwiLCBcIlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmICh0b2NIVE1MID09PSBcIlwiKSB7XHJcbiAgICAgICAgdGFyZ2V0RWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgfVxyXG4gICAgdmFyIHRlbXBFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIGlmICh2ZGl0b3IpIHtcclxuICAgICAgICB2ZGl0b3IubHV0ZS5TZXRUb0ModHJ1ZSk7XHJcbiAgICAgICAgaWYgKHZkaXRvci5jdXJyZW50TW9kZSA9PT0gXCJ3eXNpd3lnXCIgJiYgIXZkaXRvci5wcmV2aWV3LmVsZW1lbnQuY29udGFpbnMoY29udGVudEVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIHRlbXBFbGVtZW50LmlubmVySFRNTCA9IHZkaXRvci5sdXRlLlNwaW5WZGl0b3JET00oXCI8cD5bVG9DXTwvcD5cIiArIHRvY0hUTUwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh2ZGl0b3IuY3VycmVudE1vZGUgPT09IFwiaXJcIiAmJiAhdmRpdG9yLnByZXZpZXcuZWxlbWVudC5jb250YWlucyhjb250ZW50RWxlbWVudCkpIHtcclxuICAgICAgICAgICAgdGVtcEVsZW1lbnQuaW5uZXJIVE1MID0gdmRpdG9yLmx1dGUuU3BpblZkaXRvcklSRE9NKFwiPHA+W1RvQ108L3A+XCIgKyB0b2NIVE1MKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRlbXBFbGVtZW50LmlubmVySFRNTCA9IHZkaXRvci5sdXRlLkhUTUwyVmRpdG9yRE9NKFwiPHA+W1RvQ108L3A+XCIgKyB0b2NIVE1MKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmRpdG9yLmx1dGUuU2V0VG9DKHZkaXRvci5vcHRpb25zLnByZXZpZXcubWFya2Rvd24udG9jKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInZkaXRvci1vdXRsaW5lXCIpO1xyXG4gICAgICAgIHZhciBsdXRlID0gTHV0ZS5OZXcoKTtcclxuICAgICAgICBsdXRlLlNldFRvQyh0cnVlKTtcclxuICAgICAgICB0ZW1wRWxlbWVudC5pbm5lckhUTUwgPSBsdXRlLkhUTUwyVmRpdG9yRE9NKFwiPHA+W1RvQ108L3A+XCIgKyB0b2NIVE1MKTtcclxuICAgIH1cclxuICAgIHZhciBoZWFkaW5nc0VsZW1lbnQgPSB0ZW1wRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZC5xdWVyeVNlbGVjdG9yQWxsKFwibGkgPiBzcGFuW2RhdGEtdGFyZ2V0LWlkXVwiKTtcclxuICAgIGhlYWRpbmdzRWxlbWVudC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgIGlmIChpdGVtLm5leHRFbGVtZW50U2libGluZyAmJiBpdGVtLm5leHRFbGVtZW50U2libGluZy50YWdOYW1lID09PSBcIlVMXCIpIHtcclxuICAgICAgICAgICAgdmFyIGljb25IVE1MID0gXCI8c3ZnIGNsYXNzPSd2ZGl0b3Itb3V0bGluZV9fYWN0aW9uJz48dXNlIHhsaW5rOmhyZWY9JyN2ZGl0b3ItaWNvbi1kb3duJz48L3VzZT48L3N2Zz5cIjtcclxuICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZkaXRvckljb25TY3JpcHRcIikpIHtcclxuICAgICAgICAgICAgICAgIGljb25IVE1MID0gJzxzdmcgY2xhc3M9XCJ2ZGl0b3Itb3V0bGluZV9fYWN0aW9uXCIgdmlld0JveD1cIjAgMCAzMiAzMlwiPjxwYXRoIGQ9XCJNMy43NiA2LjEybDEyLjI0IDEyLjIxMyAxMi4yNC0xMi4yMTMgMy43NiAzLjc2LTE2IDE2LTE2LTE2IDMuNzYtMy43NnpcIj48L3BhdGg+PC9zdmc+JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpdGVtLmlubmVySFRNTCA9IGljb25IVE1MICsgXCI8c3Bhbj5cIiArIGl0ZW0uaW5uZXJIVE1MICsgXCI8L3NwYW4+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpdGVtLmlubmVySFRNTCA9IFwiPHN2Zz48L3N2Zz48c3Bhbj5cIiArIGl0ZW0uaW5uZXJIVE1MICsgXCI8L3NwYW4+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW0uc2V0QXR0cmlidXRlKFwiZGF0YS10YXJnZXQtaWRcIiwgaWRzW2luZGV4XSk7XHJcbiAgICB9KTtcclxuICAgIHRvY0hUTUwgPSB0ZW1wRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZC5pbm5lckhUTUw7XHJcbiAgICBpZiAoaGVhZGluZ3NFbGVtZW50Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHRhcmdldEVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICByZXR1cm4gdG9jSFRNTDtcclxuICAgIH1cclxuICAgIHRhcmdldEVsZW1lbnQuaW5uZXJIVE1MID0gdG9jSFRNTDtcclxuICAgIGlmICh2ZGl0b3IpIHtcclxuICAgICAgICBtYXRoUmVuZGVyKHRhcmdldEVsZW1lbnQsIHtcclxuICAgICAgICAgICAga2F0ZXg6IHZkaXRvci5vcHRpb25zLnN0YXRpY1BhdGgua2F0ZXgsXHJcbiAgICAgICAgICAgIG1hdGhqYXg6IHZkaXRvci5vcHRpb25zLnN0YXRpY1BhdGgubWF0aGpheCxcclxuICAgICAgICAgICAgbWF0aDogdmRpdG9yLm9wdGlvbnMucHJldmlldy5tYXRoLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGFyZ2V0RWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcclxuICAgICAgICB3aGlsZSAodGFyZ2V0ICYmICF0YXJnZXQuaXNFcXVhbE5vZGUodGFyZ2V0RWxlbWVudCkpIHtcclxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3Itb3V0bGluZV9fYWN0aW9uXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1vdXRsaW5lX19hY3Rpb24tLWNsb3NlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoXCJ2ZGl0b3Itb3V0bGluZV9fYWN0aW9uLS1jbG9zZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQucGFyZW50RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJkaXNwbGF5OmJsb2NrXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJ2ZGl0b3Itb3V0bGluZV9fYWN0aW9uLS1jbG9zZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQucGFyZW50RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJkaXNwbGF5Om5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS10YXJnZXQtaWRcIikpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIHZhciBpZEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS10YXJnZXQtaWRcIikpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodmRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZkaXRvci5vcHRpb25zLmhlaWdodCA9PT0gXCJhdXRvXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpbmRvd1Njcm9sbFkgPSBpZEVsZW1lbnQub2Zmc2V0VG9wICsgdmRpdG9yLmVsZW1lbnQub2Zmc2V0VG9wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZkaXRvci5vcHRpb25zLnRvb2xiYXJDb25maWcucGluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dTY3JvbGxZICs9IHZkaXRvci50b29sYmFyLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh3aW5kb3cuc2Nyb2xsWCwgd2luZG93U2Nyb2xsWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmRpdG9yLmVsZW1lbnQub2Zmc2V0VG9wIDwgd2luZG93LnNjcm9sbFkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh3aW5kb3cuc2Nyb2xsWCwgdmRpdG9yLmVsZW1lbnQub2Zmc2V0VG9wKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmRpdG9yLnByZXZpZXcuZWxlbWVudC5jb250YWlucyhjb250ZW50RWxlbWVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuc2Nyb2xsVG9wID0gaWRFbGVtZW50Lm9mZnNldFRvcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50LnNjcm9sbFRvcCA9IGlkRWxlbWVudC5vZmZzZXRUb3A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8od2luZG93LnNjcm9sbFgsIGlkRWxlbWVudC5vZmZzZXRUb3ApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdG9jSFRNTDtcclxufTtcclxuIiwiaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBhZGRTY3JpcHQgfSBmcm9tIFwiLi4vdXRpbC9hZGRTY3JpcHRcIjtcclxuaW1wb3J0IHsgcGxhbnR1bWxSZW5kZXJBZGFwdGVyIH0gZnJvbSBcIi4vYWRhcHRlclJlbmRlclwiO1xyXG5leHBvcnQgdmFyIHBsYW50dW1sUmVuZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHBsYW50dW1sUGF0aCkge1xyXG4gICAgaWYgKGVsZW1lbnQgPT09IHZvaWQgMCkgeyBlbGVtZW50ID0gZG9jdW1lbnQ7IH1cclxuICAgIGlmIChwbGFudHVtbFBhdGggPT09IHZvaWQgMCkgeyBwbGFudHVtbFBhdGggPSBDb25zdGFudHMuU1RBVElDX1BBVEgucGxhbnR1bWw7IH1cclxuICAgIHZhciBwbGFudHVtbEVsZW1lbnRzID0gcGxhbnR1bWxSZW5kZXJBZGFwdGVyLmdldEVsZW1lbnRzKGVsZW1lbnQpO1xyXG4gICAgaWYgKHBsYW50dW1sRWxlbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgYWRkU2NyaXB0KHBsYW50dW1sUGF0aCwgXCJ2ZGl0b3JQbGFudHVtbFNjcmlwdFwiKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBwbGFudHVtbEVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3Itd3lzaXd5Z19fcHJlXCIpIHx8XHJcbiAgICAgICAgICAgICAgICBlLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLWlyX19tYXJrZXItLXByZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB0ZXh0ID0gcGxhbnR1bWxSZW5kZXJBZGFwdGVyLmdldENvZGUoZSkudHJpbSgpO1xyXG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgZS5pbm5lckhUTUwgPSBcIjxpbWcgc3JjPVxcXCJodHRwOi8vd3d3LnBsYW50dW1sLmNvbS9wbGFudHVtbC9zdmcvfjFcIiArIHBsYW50dW1sRW5jb2Rlci5lbmNvZGUodGV4dCkgKyBcIlxcXCI+XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBlLmNsYXNzTmFtZSA9IFwidmRpdG9yLXJlc2V0LS1lcnJvclwiO1xyXG4gICAgICAgICAgICAgICAgZS5pbm5lckhUTUwgPSBcInBsYW50dW1sIHJlbmRlciBlcnJvcjogPGJyPlwiICsgZXJyb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG4iLCJleHBvcnQgdmFyIHNldEx1dGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgdmFyIGx1dGUgPSBMdXRlLk5ldygpO1xyXG4gICAgbHV0ZS5QdXRFbW9qaXMob3B0aW9ucy5lbW9qaXMpO1xyXG4gICAgbHV0ZS5TZXRFbW9qaVNpdGUob3B0aW9ucy5lbW9qaVNpdGUpO1xyXG4gICAgbHV0ZS5TZXRIZWFkaW5nQW5jaG9yKG9wdGlvbnMuaGVhZGluZ0FuY2hvcik7XHJcbiAgICBsdXRlLlNldElubGluZU1hdGhBbGxvd0RpZ2l0QWZ0ZXJPcGVuTWFya2VyKG9wdGlvbnMuaW5saW5lTWF0aERpZ2l0KTtcclxuICAgIGx1dGUuU2V0QXV0b1NwYWNlKG9wdGlvbnMuYXV0b1NwYWNlKTtcclxuICAgIGx1dGUuU2V0VG9DKG9wdGlvbnMudG9jKTtcclxuICAgIGx1dGUuU2V0Rm9vdG5vdGVzKG9wdGlvbnMuZm9vdG5vdGVzKTtcclxuICAgIGx1dGUuU2V0Rml4VGVybVR5cG8ob3B0aW9ucy5maXhUZXJtVHlwbyk7XHJcbiAgICBsdXRlLlNldFZkaXRvckNvZGVCbG9ja1ByZXZpZXcob3B0aW9ucy5jb2RlQmxvY2tQcmV2aWV3KTtcclxuICAgIGx1dGUuU2V0VmRpdG9yTWF0aEJsb2NrUHJldmlldyhvcHRpb25zLm1hdGhCbG9ja1ByZXZpZXcpO1xyXG4gICAgbHV0ZS5TZXRTYW5pdGl6ZShvcHRpb25zLnNhbml0aXplKTtcclxuICAgIGx1dGUuU2V0Q2hpbmVzZVBhcmFncmFwaEJlZ2lubmluZ1NwYWNlKG9wdGlvbnMucGFyYWdyYXBoQmVnaW5uaW5nU3BhY2UpO1xyXG4gICAgbHV0ZS5TZXRSZW5kZXJMaXN0U3R5bGUob3B0aW9ucy5saXN0U3R5bGUpO1xyXG4gICAgbHV0ZS5TZXRMaW5rQmFzZShvcHRpb25zLmxpbmtCYXNlKTtcclxuICAgIGx1dGUuU2V0TGlua1ByZWZpeChvcHRpb25zLmxpbmtQcmVmaXgpO1xyXG4gICAgbHV0ZS5TZXRNYXJrKG9wdGlvbnMubWFyayk7XHJcbiAgICBsdXRlLlNldEdGTUF1dG9MaW5rKG9wdGlvbnMuZ2ZtQXV0b0xpbmspO1xyXG4gICAgaWYgKG9wdGlvbnMubGF6eUxvYWRJbWFnZSkge1xyXG4gICAgICAgIGx1dGUuU2V0SW1hZ2VMYXp5TG9hZGluZyhvcHRpb25zLmxhenlMb2FkSW1hZ2UpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGx1dGU7XHJcbn07XHJcbiIsImV4cG9ydCB2YXIgcHJldmlld0ltYWdlID0gZnVuY3Rpb24gKG9sZEltZ0VsZW1lbnQsIGxhbmcsIHRoZW1lKSB7XHJcbiAgICBpZiAobGFuZyA9PT0gdm9pZCAwKSB7IGxhbmcgPSBcInpoX0NOXCI7IH1cclxuICAgIGlmICh0aGVtZSA9PT0gdm9pZCAwKSB7IHRoZW1lID0gXCJjbGFzc2ljXCI7IH1cclxuICAgIHZhciBvbGRJbWdSZWN0ID0gb2xkSW1nRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIHZhciBoZWlnaHQgPSAzNjtcclxuICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlZW5kXCIsIFwiPGRpdiBjbGFzcz1cXFwidmRpdG9yIHZkaXRvci1pbWdcIiArICh0aGVtZSA9PT0gXCJkYXJrXCIgPyBcIiB2ZGl0b3ItLWRhcmtcIiA6IFwiXCIpICsgXCJcXFwiPlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJ2ZGl0b3ItaW1nX19iYXJcXFwiPlxcbiAgICAgIDxzcGFuIGNsYXNzPVxcXCJ2ZGl0b3ItaW1nX19idG5cXFwiIGRhdGEtZGVnPVxcXCIwXFxcIj5cXG4gICAgICAgIDxzdmc+PHVzZSB4bGluazpocmVmPVxcXCIjdmRpdG9yLWljb24tcmVkb1xcXCI+PC91c2U+PC9zdmc+XFxuICAgICAgICBcIiArIHdpbmRvdy5WZGl0b3JJMThuLnNwaW4gKyBcIlxcbiAgICAgIDwvc3Bhbj5cXG4gICAgICA8c3BhbiBjbGFzcz1cXFwidmRpdG9yLWltZ19fYnRuXFxcIiAgb25jbGljaz1cXFwidGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQub3V0ZXJIVE1MID0gJyc7ZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICcnXFxcIj5cXG4gICAgICAgIFggJm5ic3A7XCIgKyB3aW5kb3cuVmRpdG9ySTE4bi5jbG9zZSArIFwiXFxuICAgICAgPC9zcGFuPlxcbiAgICA8L2Rpdj5cXG4gICAgPGRpdiBjbGFzcz1cXFwidmRpdG9yLWltZ19faW1nXFxcIiBvbmNsaWNrPVxcXCJ0aGlzLnBhcmVudEVsZW1lbnQub3V0ZXJIVE1MID0gJyc7ZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICcnXFxcIj5cXG4gICAgICA8aW1nIHN0eWxlPVxcXCJ3aWR0aDogXCIgKyBvbGRJbWdFbGVtZW50LndpZHRoICsgXCJweDtoZWlnaHQ6XCIgKyBvbGRJbWdFbGVtZW50LmhlaWdodCArIFwicHg7dHJhbnNmb3JtOiB0cmFuc2xhdGUzZChcIiArIG9sZEltZ1JlY3QubGVmdCArIFwicHgsIFwiICsgKG9sZEltZ1JlY3QudG9wIC0gaGVpZ2h0KSArIFwicHgsIDApXFxcIiBzcmM9XFxcIlwiICsgb2xkSW1nRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJzcmNcIikgKyBcIlxcXCI+XFxuICAgIDwvZGl2PlxcbjwvZGl2PlwiKTtcclxuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xyXG4gICAgLy8g5Zu+54mH5LuO5Y6f5aeL5L2N572u56e75Yqo5Yiw6aKE6KeI5q2j5Lit6Ze055qE5Yqo55S75pWI5p6cXHJcbiAgICB2YXIgaW1nRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmRpdG9yLWltZyBpbWdcIik7XHJcbiAgICB2YXIgdHJhbnNsYXRlM2QgPSBcInRyYW5zbGF0ZTNkKFwiICsgTWF0aC5tYXgoMCwgd2luZG93LmlubmVyV2lkdGggLSBvbGRJbWdFbGVtZW50Lm5hdHVyYWxXaWR0aCkgLyAyICsgXCJweCwgXCIgKyBNYXRoLm1heCgwLCB3aW5kb3cuaW5uZXJIZWlnaHQgLSBoZWlnaHQgLSBvbGRJbWdFbGVtZW50Lm5hdHVyYWxIZWlnaHQpIC8gMiArIFwicHgsIDApXCI7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpbWdFbGVtZW50LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwidHJhbnNpdGlvbjogdHJhbnNmb3JtIC4zcyBlYXNlLWluLW91dDt0cmFuc2Zvcm06IFwiICsgdHJhbnNsYXRlM2QpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpbWdFbGVtZW50LnBhcmVudEVsZW1lbnQuc2Nyb2xsVG8oKGltZ0VsZW1lbnQucGFyZW50RWxlbWVudC5zY3JvbGxXaWR0aCAtIGltZ0VsZW1lbnQucGFyZW50RWxlbWVudC5jbGllbnRXaWR0aCkgLyAyLCAoaW1nRWxlbWVudC5wYXJlbnRFbGVtZW50LnNjcm9sbEhlaWdodCAtIGltZ0VsZW1lbnQucGFyZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIC8gMik7XHJcbiAgICAgICAgfSwgNDAwKTtcclxuICAgIH0pO1xyXG4gICAgLy8g5peL6L2sXHJcbiAgICB2YXIgYnRuRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmRpdG9yLWltZ19fYnRuXCIpO1xyXG4gICAgYnRuRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBkZWcgPSBwYXJzZUludChidG5FbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtZGVnXCIpLCAxMCkgKyA5MDtcclxuICAgICAgICBpZiAoKGRlZyAvIDkwKSAlIDIgPT09IDEgJiYgb2xkSW1nRWxlbWVudC5uYXR1cmFsV2lkdGggPiBpbWdFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGltZ0VsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gXCJ0cmFuc2xhdGUzZChcIiArIE1hdGgubWF4KDAsIHdpbmRvdy5pbm5lcldpZHRoIC0gb2xkSW1nRWxlbWVudC5uYXR1cmFsV2lkdGgpIC8gMiArIFwicHgsIFwiICsgKG9sZEltZ0VsZW1lbnQubmF0dXJhbFdpZHRoIC8gMiAtIG9sZEltZ0VsZW1lbnQubmF0dXJhbEhlaWdodCAvIDIpICsgXCJweCwgMCkgcm90YXRlWihcIiArIGRlZyArIFwiZGVnKVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaW1nRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2xhdGUzZCArIFwiIHJvdGF0ZVooXCIgKyBkZWcgKyBcImRlZylcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnRuRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWRlZ1wiLCBkZWcudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGltZ0VsZW1lbnQucGFyZW50RWxlbWVudC5zY3JvbGxUbygoaW1nRWxlbWVudC5wYXJlbnRFbGVtZW50LnNjcm9sbFdpZHRoIC0gaW1nRWxlbWVudC5wYXJlbnRFbGVtZW50LmNsaWVudFdpZHRoKSAvIDIsIChpbWdFbGVtZW50LnBhcmVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gaW1nRWxlbWVudC5wYXJlbnRFbGVtZW50LmNsaWVudEhlaWdodCkgLyAyKTtcclxuICAgICAgICB9LCA0MDApO1xyXG4gICAgfSk7XHJcbn07XHJcbiIsImltcG9ydCB7IENvbnN0YW50cyB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcclxuaW1wb3J0IHsgYWRkU3R5bGUgfSBmcm9tIFwiLi4vdXRpbC9hZGRTdHlsZVwiO1xyXG5leHBvcnQgdmFyIHNldENvZGVUaGVtZSA9IGZ1bmN0aW9uIChjb2RlVGhlbWUsIGhpZ2hsaWdodFBhdGgpIHtcclxuICAgIGlmIChoaWdobGlnaHRQYXRoID09PSB2b2lkIDApIHsgaGlnaGxpZ2h0UGF0aCA9IENvbnN0YW50cy5TVEFUSUNfUEFUSC5oaWdobGlnaHQ7IH1cclxuICAgIGlmICghQ29uc3RhbnRzLkNPREVfVEhFTUUuaW5jbHVkZXMoY29kZVRoZW1lKSkge1xyXG4gICAgICAgIGNvZGVUaGVtZSA9IFwiZ2l0aHViXCI7XHJcbiAgICB9XHJcbiAgICB2YXIgdmRpdG9ySGxqc1N0eWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2ZGl0b3JIbGpzU3R5bGVcIik7XHJcbiAgICB2YXIgaHJlZiA9IGhpZ2hsaWdodFBhdGggKyBcIi9zdHlsZXMvXCIgKyBjb2RlVGhlbWUgKyBcIi5jc3NcIjtcclxuICAgIGlmICghdmRpdG9ySGxqc1N0eWxlKSB7XHJcbiAgICAgICAgYWRkU3R5bGUoaHJlZiwgXCJ2ZGl0b3JIbGpzU3R5bGVcIik7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh2ZGl0b3JIbGpzU3R5bGUuaHJlZiAhPT0gaHJlZikge1xyXG4gICAgICAgIHZkaXRvckhsanNTdHlsZS5yZW1vdmUoKTtcclxuICAgICAgICBhZGRTdHlsZShocmVmLCBcInZkaXRvckhsanNTdHlsZVwiKTtcclxuICAgIH1cclxufTtcclxuIiwiaW1wb3J0IHsgYWRkU3R5bGUgfSBmcm9tIFwiLi4vdXRpbC9hZGRTdHlsZVwiO1xyXG5leHBvcnQgdmFyIHNldENvbnRlbnRUaGVtZSA9IGZ1bmN0aW9uIChjb250ZW50VGhlbWUsIHBhdGgpIHtcclxuICAgIGlmICghY29udGVudFRoZW1lIHx8ICFwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIHZkaXRvckNvbnRlbnRUaGVtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmRpdG9yQ29udGVudFRoZW1lXCIpO1xyXG4gICAgdmFyIGNzc1BhdGggPSBwYXRoICsgXCIvXCIgKyBjb250ZW50VGhlbWUgKyBcIi5jc3NcIjtcclxuICAgIGlmICghdmRpdG9yQ29udGVudFRoZW1lKSB7XHJcbiAgICAgICAgYWRkU3R5bGUoY3NzUGF0aCwgXCJ2ZGl0b3JDb250ZW50VGhlbWVcIik7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh2ZGl0b3JDb250ZW50VGhlbWUuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKSAhPT0gY3NzUGF0aCkge1xyXG4gICAgICAgIHZkaXRvckNvbnRlbnRUaGVtZS5yZW1vdmUoKTtcclxuICAgICAgICBhZGRTdHlsZShjc3NQYXRoLCBcInZkaXRvckNvbnRlbnRUaGVtZVwiKTtcclxuICAgIH1cclxufTtcclxuIiwiZXhwb3J0IHZhciBhZGRTY3JpcHRTeW5jID0gZnVuY3Rpb24gKHBhdGgsIGlkKSB7XHJcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgdmFyIHhock9iaiA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgeGhyT2JqLm9wZW4oXCJHRVRcIiwgcGF0aCwgZmFsc2UpO1xyXG4gICAgeGhyT2JqLnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHRcIiwgXCJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCwgKi8qOyBxPTAuMDFcIik7XHJcbiAgICB4aHJPYmouc2VuZChcIlwiKTtcclxuICAgIHZhciBzY3JpcHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcclxuICAgIHNjcmlwdEVsZW1lbnQudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCI7XHJcbiAgICBzY3JpcHRFbGVtZW50LnRleHQgPSB4aHJPYmoucmVzcG9uc2VUZXh0O1xyXG4gICAgc2NyaXB0RWxlbWVudC5pZCA9IGlkO1xyXG4gICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHRFbGVtZW50KTtcclxufTtcclxuZXhwb3J0IHZhciBhZGRTY3JpcHQgPSBmdW5jdGlvbiAocGF0aCwgaWQpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkge1xyXG4gICAgICAgICAgICAvLyDohJrmnKzliqDovb3lkI7lho3mrKHosIPnlKjnm7TmjqXov5Tlm55cclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzY3JpcHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcclxuICAgICAgICBzY3JpcHRFbGVtZW50LnNyYyA9IHBhdGg7XHJcbiAgICAgICAgc2NyaXB0RWxlbWVudC5hc3luYyA9IHRydWU7XHJcbiAgICAgICAgLy8g5b6q546v6LCD55So5pe2IENocm9tZSDkuI3kvJrph43lpI3or7fmsYIganNcclxuICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdEVsZW1lbnQpO1xyXG4gICAgICAgIHNjcmlwdEVsZW1lbnQub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlvqrnjq/osIPnlKjpnIDmuIXpmaQgRE9NIOS4reeahCBzY3JpcHQg5qCH562+XHJcbiAgICAgICAgICAgICAgICBzY3JpcHRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNjcmlwdEVsZW1lbnQuaWQgPSBpZDtcclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufTtcclxuIiwiZXhwb3J0IHZhciBhZGRTdHlsZSA9IGZ1bmN0aW9uICh1cmwsIGlkKSB7XHJcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkge1xyXG4gICAgICAgIHZhciBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlua1wiKTtcclxuICAgICAgICBzdHlsZUVsZW1lbnQuaWQgPSBpZDtcclxuICAgICAgICBzdHlsZUVsZW1lbnQucmVsID0gXCJzdHlsZXNoZWV0XCI7XHJcbiAgICAgICAgc3R5bGVFbGVtZW50LnR5cGUgPSBcInRleHQvY3NzXCI7XHJcbiAgICAgICAgc3R5bGVFbGVtZW50LmhyZWYgPSB1cmw7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7XHJcbiAgICB9XHJcbn07XHJcbiIsImV4cG9ydCB2YXIgY29kZTE2MHRvMzIgPSBmdW5jdGlvbiAodGV4dCkge1xyXG4gICAgLy8g6Z2e5omT5pat56m65qC86L2s5o2i5Li656m65qC8XHJcbiAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHUwMGEwL2csIFwiIFwiKTtcclxufTtcclxuIiwiaW1wb3J0IHsgaGFzQ2xvc2VzdEJ5VGFnIH0gZnJvbSBcIi4vaGFzQ2xvc2VzdEJ5SGVhZGluZ3NcIjtcclxuZXhwb3J0IHZhciBoYXNUb3BDbG9zZXN0QnlDbGFzc05hbWUgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcbiAgICB2YXIgY2xvc2VzdCA9IGhhc0Nsb3Nlc3RCeUNsYXNzTmFtZShlbGVtZW50LCBjbGFzc05hbWUpO1xyXG4gICAgdmFyIHBhcmVudENsb3Nlc3QgPSBmYWxzZTtcclxuICAgIHZhciBmaW5kVG9wID0gZmFsc2U7XHJcbiAgICB3aGlsZSAoY2xvc2VzdCAmJiAhY2xvc2VzdC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3ItcmVzZXRcIikgJiYgIWZpbmRUb3ApIHtcclxuICAgICAgICBwYXJlbnRDbG9zZXN0ID0gaGFzQ2xvc2VzdEJ5Q2xhc3NOYW1lKGNsb3Nlc3QucGFyZW50RWxlbWVudCwgY2xhc3NOYW1lKTtcclxuICAgICAgICBpZiAocGFyZW50Q2xvc2VzdCkge1xyXG4gICAgICAgICAgICBjbG9zZXN0ID0gcGFyZW50Q2xvc2VzdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGZpbmRUb3AgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBjbG9zZXN0IHx8IGZhbHNlO1xyXG59O1xyXG5leHBvcnQgdmFyIGhhc1RvcENsb3Nlc3RCeUF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBhdHRyLCB2YWx1ZSkge1xyXG4gICAgdmFyIGNsb3Nlc3QgPSBoYXNDbG9zZXN0QnlBdHRyaWJ1dGUoZWxlbWVudCwgYXR0ciwgdmFsdWUpO1xyXG4gICAgdmFyIHBhcmVudENsb3Nlc3QgPSBmYWxzZTtcclxuICAgIHZhciBmaW5kVG9wID0gZmFsc2U7XHJcbiAgICB3aGlsZSAoY2xvc2VzdCAmJiAhY2xvc2VzdC5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3ItcmVzZXRcIikgJiYgIWZpbmRUb3ApIHtcclxuICAgICAgICBwYXJlbnRDbG9zZXN0ID0gaGFzQ2xvc2VzdEJ5QXR0cmlidXRlKGNsb3Nlc3QucGFyZW50RWxlbWVudCwgYXR0ciwgdmFsdWUpO1xyXG4gICAgICAgIGlmIChwYXJlbnRDbG9zZXN0KSB7XHJcbiAgICAgICAgICAgIGNsb3Nlc3QgPSBwYXJlbnRDbG9zZXN0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZmluZFRvcCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNsb3Nlc3QgfHwgZmFsc2U7XHJcbn07XHJcbmV4cG9ydCB2YXIgaGFzVG9wQ2xvc2VzdEJ5VGFnID0gZnVuY3Rpb24gKGVsZW1lbnQsIG5vZGVOYW1lKSB7XHJcbiAgICB2YXIgY2xvc2VzdCA9IGhhc0Nsb3Nlc3RCeVRhZyhlbGVtZW50LCBub2RlTmFtZSk7XHJcbiAgICB2YXIgcGFyZW50Q2xvc2VzdCA9IGZhbHNlO1xyXG4gICAgdmFyIGZpbmRUb3AgPSBmYWxzZTtcclxuICAgIHdoaWxlIChjbG9zZXN0ICYmICFjbG9zZXN0LmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1yZXNldFwiKSAmJiAhZmluZFRvcCkge1xyXG4gICAgICAgIHBhcmVudENsb3Nlc3QgPSBoYXNDbG9zZXN0QnlUYWcoY2xvc2VzdC5wYXJlbnRFbGVtZW50LCBub2RlTmFtZSk7XHJcbiAgICAgICAgaWYgKHBhcmVudENsb3Nlc3QpIHtcclxuICAgICAgICAgICAgY2xvc2VzdCA9IHBhcmVudENsb3Nlc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmaW5kVG9wID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2xvc2VzdCB8fCBmYWxzZTtcclxufTtcclxuZXhwb3J0IHZhciBnZXRUb3BMaXN0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgIHZhciB0b3BVbEVsZW1lbnQgPSBoYXNUb3BDbG9zZXN0QnlUYWcoZWxlbWVudCwgXCJVTFwiKTtcclxuICAgIHZhciB0b3BPbEVsZW1lbnQgPSBoYXNUb3BDbG9zZXN0QnlUYWcoZWxlbWVudCwgXCJPTFwiKTtcclxuICAgIHZhciB0b3BMaXN0RWxlbWVudCA9IHRvcFVsRWxlbWVudDtcclxuICAgIGlmICh0b3BPbEVsZW1lbnQgJiYgKCF0b3BVbEVsZW1lbnQgfHwgKHRvcFVsRWxlbWVudCAmJiB0b3BPbEVsZW1lbnQuY29udGFpbnModG9wVWxFbGVtZW50KSkpKSB7XHJcbiAgICAgICAgdG9wTGlzdEVsZW1lbnQgPSB0b3BPbEVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG9wTGlzdEVsZW1lbnQ7XHJcbn07XHJcbmV4cG9ydCB2YXIgaGFzQ2xvc2VzdEJ5QXR0cmlidXRlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGF0dHIsIHZhbHVlKSB7XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICB2YXIgZSA9IGVsZW1lbnQ7XHJcbiAgICB2YXIgaXNDbG9zZXN0ID0gZmFsc2U7XHJcbiAgICB3aGlsZSAoZSAmJiAhaXNDbG9zZXN0ICYmICFlLmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1yZXNldFwiKSkge1xyXG4gICAgICAgIGlmIChlLmdldEF0dHJpYnV0ZShhdHRyKSA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgaXNDbG9zZXN0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGUgPSBlLnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlzQ2xvc2VzdCAmJiBlO1xyXG59O1xyXG5leHBvcnQgdmFyIGhhc0Nsb3Nlc3RCbG9jayA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICB2YXIgZSA9IGVsZW1lbnQ7XHJcbiAgICB2YXIgaXNDbG9zZXN0ID0gZmFsc2U7XHJcbiAgICB2YXIgYmxvY2tFbGVtZW50ID0gaGFzQ2xvc2VzdEJ5QXR0cmlidXRlKGVsZW1lbnQsIFwiZGF0YS1ibG9ja1wiLCBcIjBcIik7XHJcbiAgICBpZiAoYmxvY2tFbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIGJsb2NrRWxlbWVudDtcclxuICAgIH1cclxuICAgIHdoaWxlIChlICYmICFpc0Nsb3Nlc3QgJiYgIWUuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLXJlc2V0XCIpKSB7XHJcbiAgICAgICAgaWYgKGUudGFnTmFtZSA9PT0gXCJIMVwiIHx8XHJcbiAgICAgICAgICAgIGUudGFnTmFtZSA9PT0gXCJIMlwiIHx8XHJcbiAgICAgICAgICAgIGUudGFnTmFtZSA9PT0gXCJIM1wiIHx8XHJcbiAgICAgICAgICAgIGUudGFnTmFtZSA9PT0gXCJINFwiIHx8XHJcbiAgICAgICAgICAgIGUudGFnTmFtZSA9PT0gXCJINVwiIHx8XHJcbiAgICAgICAgICAgIGUudGFnTmFtZSA9PT0gXCJINlwiIHx8XHJcbiAgICAgICAgICAgIGUudGFnTmFtZSA9PT0gXCJQXCIgfHxcclxuICAgICAgICAgICAgZS50YWdOYW1lID09PSBcIkJMT0NLUVVPVEVcIiB8fFxyXG4gICAgICAgICAgICBlLnRhZ05hbWUgPT09IFwiT0xcIiB8fFxyXG4gICAgICAgICAgICBlLnRhZ05hbWUgPT09IFwiVUxcIikge1xyXG4gICAgICAgICAgICBpc0Nsb3Nlc3QgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZSA9IGUucGFyZW50RWxlbWVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXNDbG9zZXN0ICYmIGU7XHJcbn07XHJcbmV4cG9ydCB2YXIgaGFzQ2xvc2VzdEJ5TWF0Y2hUYWcgPSBmdW5jdGlvbiAoZWxlbWVudCwgbm9kZU5hbWUpIHtcclxuICAgIGlmICghZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChlbGVtZW50Lm5vZGVUeXBlID09PSAzKSB7XHJcbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudDtcclxuICAgIH1cclxuICAgIHZhciBlID0gZWxlbWVudDtcclxuICAgIHZhciBpc0Nsb3Nlc3QgPSBmYWxzZTtcclxuICAgIHdoaWxlIChlICYmICFpc0Nsb3Nlc3QgJiYgIWUuY2xhc3NMaXN0LmNvbnRhaW5zKFwidmRpdG9yLXJlc2V0XCIpKSB7XHJcbiAgICAgICAgaWYgKGUubm9kZU5hbWUgPT09IG5vZGVOYW1lKSB7XHJcbiAgICAgICAgICAgIGlzQ2xvc2VzdCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBlID0gZS5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBpc0Nsb3Nlc3QgJiYgZTtcclxufTtcclxuZXhwb3J0IHZhciBoYXNDbG9zZXN0QnlDbGFzc05hbWUgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICB2YXIgZSA9IGVsZW1lbnQ7XHJcbiAgICB2YXIgaXNDbG9zZXN0ID0gZmFsc2U7XHJcbiAgICB3aGlsZSAoZSAmJiAhaXNDbG9zZXN0ICYmICFlLmNsYXNzTGlzdC5jb250YWlucyhcInZkaXRvci1yZXNldFwiKSkge1xyXG4gICAgICAgIGlmIChlLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpKSB7XHJcbiAgICAgICAgICAgIGlzQ2xvc2VzdCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBlID0gZS5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBpc0Nsb3Nlc3QgJiYgZTtcclxufTtcclxuZXhwb3J0IHZhciBnZXRMYXN0Tm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICB3aGlsZSAobm9kZSAmJiBub2RlLmxhc3RDaGlsZCkge1xyXG4gICAgICAgIG5vZGUgPSBub2RlLmxhc3RDaGlsZDtcclxuICAgIH1cclxuICAgIHJldHVybiBub2RlO1xyXG59O1xyXG4iLCIvLyBOT1RFOiDlh4/lsJEgbWV0aG9kLnRzIOaJk+WMhe+8jOaVheS7jiBoYXNDbG9zZXN0LnRzIOS4reaLhuWIhlxyXG5leHBvcnQgdmFyIGhhc0Nsb3Nlc3RCeVRhZyA9IGZ1bmN0aW9uIChlbGVtZW50LCBub2RlTmFtZSkge1xyXG4gICAgaWYgKCFlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKGVsZW1lbnQubm9kZVR5cGUgPT09IDMpIHtcclxuICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnRFbGVtZW50O1xyXG4gICAgfVxyXG4gICAgdmFyIGUgPSBlbGVtZW50O1xyXG4gICAgdmFyIGlzQ2xvc2VzdCA9IGZhbHNlO1xyXG4gICAgd2hpbGUgKGUgJiYgIWlzQ2xvc2VzdCAmJiAhZS5jbGFzc0xpc3QuY29udGFpbnMoXCJ2ZGl0b3ItcmVzZXRcIikpIHtcclxuICAgICAgICBpZiAoZS5ub2RlTmFtZS5pbmRleE9mKG5vZGVOYW1lKSA9PT0gMCkge1xyXG4gICAgICAgICAgICBpc0Nsb3Nlc3QgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZSA9IGUucGFyZW50RWxlbWVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXNDbG9zZXN0ICYmIGU7XHJcbn07XHJcbmV4cG9ydCB2YXIgaGFzQ2xvc2VzdEJ5SGVhZGluZ3MgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgdmFyIGhlYWRpbmdFbGVtZW50ID0gaGFzQ2xvc2VzdEJ5VGFnKGVsZW1lbnQsIFwiSFwiKTtcclxuICAgIGlmIChoZWFkaW5nRWxlbWVudCAmJiBoZWFkaW5nRWxlbWVudC50YWdOYW1lLmxlbmd0aCA9PT0gMiAmJiBoZWFkaW5nRWxlbWVudC50YWdOYW1lICE9PSBcIkhSXCIpIHtcclxuICAgICAgICByZXR1cm4gaGVhZGluZ0VsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn07XHJcbiIsImV4cG9ydCB2YXIgbWVyZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgb3B0aW9ucyA9IFtdO1xyXG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICBvcHRpb25zW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICB9XHJcbiAgICB2YXIgdGFyZ2V0ID0ge307XHJcbiAgICB2YXIgbWVyZ2VyID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkocHJvcCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqW3Byb3BdKSA9PT0gXCJbb2JqZWN0IE9iamVjdF1cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IG1lcmdlKHRhcmdldFtwcm9wXSwgb2JqW3Byb3BdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IG9ialtwcm9wXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBtZXJnZXIob3B0aW9uc1tpXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGFyZ2V0O1xyXG59O1xyXG4iLCJpbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IGlzQ2hyb21lIH0gZnJvbSBcIi4vY29tcGF0aWJpbGl0eVwiO1xyXG5pbXBvcnQgeyBoYXNDbG9zZXN0QmxvY2ssIGhhc0Nsb3Nlc3RCeUNsYXNzTmFtZSB9IGZyb20gXCIuL2hhc0Nsb3Nlc3RcIjtcclxuZXhwb3J0IHZhciBnZXRFZGl0b3JSYW5nZSA9IGZ1bmN0aW9uICh2ZGl0b3IpIHtcclxuICAgIHZhciByYW5nZTtcclxuICAgIHZhciBlbGVtZW50ID0gdmRpdG9yW3ZkaXRvci5jdXJyZW50TW9kZV0uZWxlbWVudDtcclxuICAgIGlmIChnZXRTZWxlY3Rpb24oKS5yYW5nZUNvdW50ID4gMCkge1xyXG4gICAgICAgIHJhbmdlID0gZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKTtcclxuICAgICAgICBpZiAoZWxlbWVudC5pc0VxdWFsTm9kZShyYW5nZS5zdGFydENvbnRhaW5lcikgfHwgZWxlbWVudC5jb250YWlucyhyYW5nZS5zdGFydENvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJhbmdlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh2ZGl0b3JbdmRpdG9yLmN1cnJlbnRNb2RlXS5yYW5nZSkge1xyXG4gICAgICAgIHJldHVybiB2ZGl0b3JbdmRpdG9yLmN1cnJlbnRNb2RlXS5yYW5nZTtcclxuICAgIH1cclxuICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgIHJhbmdlID0gZWxlbWVudC5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XHJcbiAgICByYW5nZS5zZXRTdGFydChlbGVtZW50LCAwKTtcclxuICAgIHJhbmdlLmNvbGxhcHNlKHRydWUpO1xyXG4gICAgcmV0dXJuIHJhbmdlO1xyXG59O1xyXG5leHBvcnQgdmFyIGdldEN1cnNvclBvc2l0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xyXG4gICAgdmFyIHJhbmdlID0gd2luZG93LmdldFNlbGVjdGlvbigpLmdldFJhbmdlQXQoMCk7XHJcbiAgICBpZiAoIWVkaXRvci5jb250YWlucyhyYW5nZS5zdGFydENvbnRhaW5lcikgJiYgIWhhc0Nsb3Nlc3RCeUNsYXNzTmFtZShyYW5nZS5zdGFydENvbnRhaW5lciwgXCJ2ZGl0b3ItcGFuZWwtLW5vbmVcIikpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHZhciBwYXJlbnRSZWN0ID0gZWRpdG9yLnBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICB2YXIgY3Vyc29yUmVjdDtcclxuICAgIGlmIChyYW5nZS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGlmIChyYW5nZS5zdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgICAgICAvLyDnqbrooYzml7bvvIzkvJrlh7rnjrDmsqHmnIkgYnIg55qE5oOF5Ya177yM6ZyA6KaB5qC55o2u54i25YWD57SgIDxwPiDojrflj5bkvY3nva7kv6Hmga9cclxuICAgICAgICAgICAgdmFyIHBhcmVudF8xID0gcmFuZ2Uuc3RhcnRDb250YWluZXIucGFyZW50RWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKHBhcmVudF8xICYmIHBhcmVudF8xLmdldENsaWVudFJlY3RzKCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yUmVjdCA9IHBhcmVudF8xLmdldENsaWVudFJlY3RzKClbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gcmFuZ2Uuc3RhcnRDb250YWluZXIuY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGlmIChjaGlsZHJlbltyYW5nZS5zdGFydE9mZnNldF0gJiZcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW3JhbmdlLnN0YXJ0T2Zmc2V0XS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vIG1hcmtkb3duIOaooeW8j+Wbnui9plxyXG4gICAgICAgICAgICAgICAgY3Vyc29yUmVjdCA9IGNoaWxkcmVuW3JhbmdlLnN0YXJ0T2Zmc2V0XS5nZXRDbGllbnRSZWN0cygpWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHJhbmdlLnN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW4gdGFibGUgb3IgY29kZSBibG9ja1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb25lUmFuZ2UgPSByYW5nZS5jbG9uZVJhbmdlKCk7XHJcbiAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3ROb2RlKHJhbmdlLnN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXNbTWF0aC5tYXgoMCwgcmFuZ2Uuc3RhcnRPZmZzZXQgLSAxKV0pO1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yUmVjdCA9IHJhbmdlLmdldENsaWVudFJlY3RzKClbMF07XHJcbiAgICAgICAgICAgICAgICByYW5nZS5zZXRFbmQoY2xvbmVSYW5nZS5lbmRDb250YWluZXIsIGNsb25lUmFuZ2UuZW5kT2Zmc2V0KTtcclxuICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0KGNsb25lUmFuZ2Uuc3RhcnRDb250YWluZXIsIGNsb25lUmFuZ2Uuc3RhcnRPZmZzZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yUmVjdCA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyLmdldENsaWVudFJlY3RzKClbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFjdXJzb3JSZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50RWxlbWVudCA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyLmNoaWxkTm9kZXNbcmFuZ2Uuc3RhcnRPZmZzZXRdO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFwYXJlbnRFbGVtZW50LmdldENsaWVudFJlY3RzIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgKHBhcmVudEVsZW1lbnQuZ2V0Q2xpZW50UmVjdHMgJiYgcGFyZW50RWxlbWVudC5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCA9PT0gMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRFbGVtZW50ID0gcGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3Vyc29yUmVjdCA9IHBhcmVudEVsZW1lbnQuZ2V0Q2xpZW50UmVjdHMoKVswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGN1cnNvclJlY3QgPSByYW5nZS5nZXRDbGllbnRSZWN0cygpWzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsZWZ0OiBjdXJzb3JSZWN0LmxlZnQgLSBwYXJlbnRSZWN0LmxlZnQsXHJcbiAgICAgICAgdG9wOiBjdXJzb3JSZWN0LnRvcCAtIHBhcmVudFJlY3QudG9wLFxyXG4gICAgfTtcclxufTtcclxuZXhwb3J0IHZhciBzZWxlY3RJc0VkaXRvciA9IGZ1bmN0aW9uIChlZGl0b3IsIHJhbmdlKSB7XHJcbiAgICBpZiAoIXJhbmdlKSB7XHJcbiAgICAgICAgaWYgKGdldFNlbGVjdGlvbigpLnJhbmdlQ291bnQgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmFuZ2UgPSBnZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciBjb250YWluZXIgPSByYW5nZS5jb21tb25BbmNlc3RvckNvbnRhaW5lcjtcclxuICAgIHJldHVybiBlZGl0b3IuaXNFcXVhbE5vZGUoY29udGFpbmVyKSB8fCBlZGl0b3IuY29udGFpbnMoY29udGFpbmVyKTtcclxufTtcclxuZXhwb3J0IHZhciBzZXRTZWxlY3Rpb25Gb2N1cyA9IGZ1bmN0aW9uIChyYW5nZSkge1xyXG4gICAgdmFyIHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcclxuICAgIHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcclxuICAgIHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XHJcbn07XHJcbmV4cG9ydCB2YXIgZ2V0U2VsZWN0UG9zaXRpb24gPSBmdW5jdGlvbiAoc2VsZWN0RWxlbWVudCwgZWRpdG9yRWxlbWVudCwgcmFuZ2UpIHtcclxuICAgIHZhciBwb3NpdGlvbiA9IHtcclxuICAgICAgICBlbmQ6IDAsXHJcbiAgICAgICAgc3RhcnQ6IDAsXHJcbiAgICB9O1xyXG4gICAgaWYgKCFyYW5nZSkge1xyXG4gICAgICAgIGlmIChnZXRTZWxlY3Rpb24oKS5yYW5nZUNvdW50ID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwb3NpdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmFuZ2UgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKTtcclxuICAgIH1cclxuICAgIGlmIChzZWxlY3RJc0VkaXRvcihlZGl0b3JFbGVtZW50LCByYW5nZSkpIHtcclxuICAgICAgICB2YXIgcHJlU2VsZWN0aW9uUmFuZ2UgPSByYW5nZS5jbG9uZVJhbmdlKCk7XHJcbiAgICAgICAgaWYgKHNlbGVjdEVsZW1lbnQuY2hpbGROb2Rlc1swXSAmJiBzZWxlY3RFbGVtZW50LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXSkge1xyXG4gICAgICAgICAgICBwcmVTZWxlY3Rpb25SYW5nZS5zZXRTdGFydChzZWxlY3RFbGVtZW50LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwcmVTZWxlY3Rpb25SYW5nZS5zZWxlY3ROb2RlQ29udGVudHMoc2VsZWN0RWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByZVNlbGVjdGlvblJhbmdlLnNldEVuZChyYW5nZS5zdGFydENvbnRhaW5lciwgcmFuZ2Uuc3RhcnRPZmZzZXQpO1xyXG4gICAgICAgIHBvc2l0aW9uLnN0YXJ0ID0gcHJlU2VsZWN0aW9uUmFuZ2UudG9TdHJpbmcoKS5sZW5ndGg7XHJcbiAgICAgICAgcG9zaXRpb24uZW5kID0gcG9zaXRpb24uc3RhcnQgKyByYW5nZS50b1N0cmluZygpLmxlbmd0aDtcclxuICAgIH1cclxuICAgIHJldHVybiBwb3NpdGlvbjtcclxufTtcclxuZXhwb3J0IHZhciBzZXRTZWxlY3Rpb25CeVBvc2l0aW9uID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIGVkaXRvcikge1xyXG4gICAgdmFyIGNoYXJJbmRleCA9IDA7XHJcbiAgICB2YXIgbGluZSA9IDA7XHJcbiAgICB2YXIgcE5vZGUgPSBlZGl0b3IuY2hpbGROb2Rlc1tsaW5lXTtcclxuICAgIHZhciBmb3VuZFN0YXJ0ID0gZmFsc2U7XHJcbiAgICB2YXIgc3RvcCA9IGZhbHNlO1xyXG4gICAgc3RhcnQgPSBNYXRoLm1heCgwLCBzdGFydCk7XHJcbiAgICBlbmQgPSBNYXRoLm1heCgwLCBlbmQpO1xyXG4gICAgdmFyIHJhbmdlID0gZWRpdG9yLm93bmVyRG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcclxuICAgIHJhbmdlLnNldFN0YXJ0KHBOb2RlIHx8IGVkaXRvciwgMCk7XHJcbiAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcclxuICAgIHdoaWxlICghc3RvcCAmJiBwTm9kZSkge1xyXG4gICAgICAgIHZhciBuZXh0Q2hhckluZGV4ID0gY2hhckluZGV4ICsgcE5vZGUudGV4dENvbnRlbnQubGVuZ3RoO1xyXG4gICAgICAgIGlmICghZm91bmRTdGFydCAmJiBzdGFydCA+PSBjaGFySW5kZXggJiYgc3RhcnQgPD0gbmV4dENoYXJJbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoc3RhcnQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0KHBOb2RlLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChwTm9kZS5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnQocE5vZGUuY2hpbGROb2Rlc1swXSwgc3RhcnQgLSBjaGFySW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocE5vZGUubmV4dFNpYmxpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZXRTdGFydEJlZm9yZShwTm9kZS5uZXh0U2libGluZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZXRTdGFydEFmdGVyKHBOb2RlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3VuZFN0YXJ0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSBlbmQpIHtcclxuICAgICAgICAgICAgICAgIHN0b3AgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZvdW5kU3RhcnQgJiYgZW5kID49IGNoYXJJbmRleCAmJiBlbmQgPD0gbmV4dENoYXJJbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoZW5kID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByYW5nZS5zZXRFbmQocE5vZGUsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBOb2RlLmNoaWxkTm9kZXNbMF0ubm9kZVR5cGUgPT09IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZXRFbmQocE5vZGUuY2hpbGROb2Rlc1swXSwgZW5kIC0gY2hhckluZGV4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBOb2RlLm5leHRTaWJsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc2V0RW5kQmVmb3JlKHBOb2RlLm5leHRTaWJsaW5nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNldEVuZEFmdGVyKHBOb2RlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdG9wID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hhckluZGV4ID0gbmV4dENoYXJJbmRleDtcclxuICAgICAgICBwTm9kZSA9IGVkaXRvci5jaGlsZE5vZGVzWysrbGluZV07XHJcbiAgICB9XHJcbiAgICBpZiAoIXN0b3AgJiYgZWRpdG9yLmNoaWxkTm9kZXNbbGluZSAtIDFdKSB7XHJcbiAgICAgICAgcmFuZ2Uuc2V0U3RhcnRCZWZvcmUoZWRpdG9yLmNoaWxkTm9kZXNbbGluZSAtIDFdKTtcclxuICAgIH1cclxuICAgIHNldFNlbGVjdGlvbkZvY3VzKHJhbmdlKTtcclxuICAgIHJldHVybiByYW5nZTtcclxufTtcclxuZXhwb3J0IHZhciBzZXRSYW5nZUJ5V2JyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHJhbmdlKSB7XHJcbiAgICB2YXIgd2JyRWxlbWVudCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihcIndiclwiKTtcclxuICAgIGlmICghd2JyRWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghd2JyRWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKSB7XHJcbiAgICAgICAgaWYgKHdickVsZW1lbnQucHJldmlvdXNTaWJsaW5nKSB7XHJcbiAgICAgICAgICAgIC8vIHRleHQ8d2JyPlxyXG4gICAgICAgICAgICByYW5nZS5zZXRTdGFydCh3YnJFbGVtZW50LnByZXZpb3VzU2libGluZywgd2JyRWxlbWVudC5wcmV2aW91c1NpYmxpbmcudGV4dENvbnRlbnQubGVuZ3RoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAod2JyRWxlbWVudC5uZXh0U2libGluZykge1xyXG4gICAgICAgICAgICBpZiAod2JyRWxlbWVudC5uZXh0U2libGluZy5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgICAgICAgICAgLy8gPHdicj50ZXh0XHJcbiAgICAgICAgICAgICAgICByYW5nZS5zZXRTdGFydCh3YnJFbGVtZW50Lm5leHRTaWJsaW5nLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIDx3YnI+PGJyPiBodHRwczovL2dpdGh1Yi5jb20vVmFuZXNzYTIxOS92ZGl0b3IvaXNzdWVzLzQwMFxyXG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnRCZWZvcmUod2JyRWxlbWVudC5uZXh0U2libGluZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOWGheWuueS4uuepulxyXG4gICAgICAgICAgICByYW5nZS5zZXRTdGFydCh3YnJFbGVtZW50LnBhcmVudEVsZW1lbnQsIDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmICh3YnJFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmcuaXNTYW1lTm9kZSh3YnJFbGVtZW50LnByZXZpb3VzU2libGluZykpIHtcclxuICAgICAgICAgICAgaWYgKHdickVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZy5sYXN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIC8vIDxlbT50ZXh0PC9lbT48d2JyPlxyXG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnRCZWZvcmUod2JyRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvbkZvY3VzKHJhbmdlKTtcclxuICAgICAgICAgICAgICAgIC8vIGZpeCBDaHJvbWUgc2V0IHJhbmdlIGJ1ZzogKipjKipcclxuICAgICAgICAgICAgICAgIGlmIChpc0Nocm9tZSgpICYmICh3YnJFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZSA9PT0gXCJFTVwiIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgd2JyRWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLnRhZ05hbWUgPT09IFwiU1RST05HXCIgfHxcclxuICAgICAgICAgICAgICAgICAgICB3YnJFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmcudGFnTmFtZSA9PT0gXCJTXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UuaW5zZXJ0Tm9kZShkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShDb25zdGFudHMuWldTUCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHdickVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyA8YnI+PHdicj5cclxuICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0QWZ0ZXIod2JyRWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gPGVtPnRleHQ8L2VtPnRleHQ8d2JyPlxyXG4gICAgICAgICAgICByYW5nZS5zZXRTdGFydCh3YnJFbGVtZW50LnByZXZpb3VzU2libGluZywgd2JyRWxlbWVudC5wcmV2aW91c1NpYmxpbmcudGV4dENvbnRlbnQubGVuZ3RoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcclxuICAgIHdickVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICBzZXRTZWxlY3Rpb25Gb2N1cyhyYW5nZSk7XHJcbn07XHJcbmV4cG9ydCB2YXIgaW5zZXJ0SFRNTCA9IGZ1bmN0aW9uIChodG1sLCB2ZGl0b3IpIHtcclxuICAgIC8vIOS9v+eUqCBsdXRlIOaWueazleS8mua3u+WKoCBwIOWFg+e0oO+8jOWPquacieS4gOS4qiBwIOWFg+e0oOeahOaXtuWAmei/m+ihjOWIoOmZpFxyXG4gICAgdmFyIHRlbXBFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIHRlbXBFbGVtZW50LmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICB2YXIgdGVtcEJsb2NrRWxlbWVudCA9IHRlbXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJwXCIpO1xyXG4gICAgaWYgKHRlbXBCbG9ja0VsZW1lbnQubGVuZ3RoID09PSAxICYmICF0ZW1wQmxvY2tFbGVtZW50WzBdLnByZXZpb3VzU2libGluZyAmJiAhdGVtcEJsb2NrRWxlbWVudFswXS5uZXh0U2libGluZyAmJlxyXG4gICAgICAgIHZkaXRvclt2ZGl0b3IuY3VycmVudE1vZGVdLmVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiB0ZW1wRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZC50YWdOYW1lID09PSBcIlBcIikge1xyXG4gICAgICAgIGh0bWwgPSB0ZW1wQmxvY2tFbGVtZW50WzBdLmlubmVySFRNTC50cmltKCk7XHJcbiAgICB9XHJcbiAgICB2YXIgcGFzdGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIHBhc3RlRWxlbWVudC5pbm5lckhUTUwgPSBodG1sO1xyXG4gICAgdmFyIHJhbmdlID0gZ2V0RWRpdG9yUmFuZ2UodmRpdG9yKTtcclxuICAgIGlmIChyYW5nZS50b1N0cmluZygpICE9PSBcIlwiKSB7XHJcbiAgICAgICAgdmRpdG9yW3ZkaXRvci5jdXJyZW50TW9kZV0ucHJldmVudElucHV0ID0gdHJ1ZTtcclxuICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZChcImRlbGV0ZVwiLCBmYWxzZSwgXCJcIik7XHJcbiAgICB9XHJcbiAgICBpZiAocGFzdGVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkICYmXHJcbiAgICAgICAgcGFzdGVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkLmdldEF0dHJpYnV0ZShcImRhdGEtYmxvY2tcIikgPT09IFwiMFwiKSB7XHJcbiAgICAgICAgLy8g57KY6LS05YaF5a655Li65Z2X5YWD57Sg5pe277yM5bqU5Zyo5LiL5LiA5q616JC95Lit5o+S5YWlXHJcbiAgICAgICAgcGFzdGVFbGVtZW50Lmxhc3RFbGVtZW50Q2hpbGQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlZW5kXCIsIFwiPHdicj5cIik7XHJcbiAgICAgICAgdmFyIGJsb2NrRWxlbWVudCA9IGhhc0Nsb3Nlc3RCbG9jayhyYW5nZS5zdGFydENvbnRhaW5lcik7XHJcbiAgICAgICAgaWYgKCFibG9ja0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgdmRpdG9yW3ZkaXRvci5jdXJyZW50TW9kZV0uZWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVlbmRcIiwgcGFzdGVFbGVtZW50LmlubmVySFRNTCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBibG9ja0VsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJlbmRcIiwgcGFzdGVFbGVtZW50LmlubmVySFRNTCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldFJhbmdlQnlXYnIodmRpdG9yW3ZkaXRvci5jdXJyZW50TW9kZV0uZWxlbWVudCwgcmFuZ2UpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgdmFyIHBhc3RlVGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGVtcGxhdGVcIik7XHJcbiAgICAgICAgcGFzdGVUZW1wbGF0ZS5pbm5lckhUTUwgPSBodG1sO1xyXG4gICAgICAgIHJhbmdlLmluc2VydE5vZGUocGFzdGVUZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKSk7XHJcbiAgICAgICAgcmFuZ2UuY29sbGFwc2UoZmFsc2UpO1xyXG4gICAgICAgIHNldFNlbGVjdGlvbkZvY3VzKHJhbmdlKTtcclxuICAgIH1cclxufTtcclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJleHBvcnQgdmFyIGxhenlMb2FkSW1hZ2VSZW5kZXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgaWYgKGVsZW1lbnQgPT09IHZvaWQgMCkgeyBlbGVtZW50ID0gZG9jdW1lbnQ7IH1cclxuICAgIHZhciBsb2FkSW1nID0gZnVuY3Rpb24gKGl0KSB7XHJcbiAgICAgICAgdmFyIHRlc3RJbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgICAgdGVzdEltYWdlLnNyYyA9IGl0LmdldEF0dHJpYnV0ZShcImRhdGEtc3JjXCIpO1xyXG4gICAgICAgIHRlc3RJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghaXQuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikgJiYgIWl0LmdldEF0dHJpYnV0ZShcImNsYXNzXCIpICYmXHJcbiAgICAgICAgICAgICAgICAhaXQuZ2V0QXR0cmlidXRlKFwid2lkdGhcIikgJiYgIWl0LmdldEF0dHJpYnV0ZShcImhlaWdodFwiKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlc3RJbWFnZS5uYXR1cmFsSGVpZ2h0ID4gdGVzdEltYWdlLm5hdHVyYWxXaWR0aCAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RJbWFnZS5uYXR1cmFsV2lkdGggLyB0ZXN0SW1hZ2UubmF0dXJhbEhlaWdodCA8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmRpdG9yLXJlc2V0XCIpLmNsaWVudFdpZHRoIC8gKHdpbmRvdy5pbm5lckhlaWdodCAtIDQwKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RJbWFnZS5uYXR1cmFsSGVpZ2h0ID4gKHdpbmRvdy5pbm5lckhlaWdodCAtIDQwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0LnN0eWxlLmhlaWdodCA9ICh3aW5kb3cuaW5uZXJIZWlnaHQgLSA0MCkgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaXQuc3JjID0gdGVzdEltYWdlLnNyYztcclxuICAgICAgICB9KTtcclxuICAgICAgICBpdC5yZW1vdmVBdHRyaWJ1dGUoXCJkYXRhLXNyY1wiKTtcclxuICAgIH07XHJcbiAgICBpZiAoIShcIkludGVyc2VjdGlvbk9ic2VydmVyXCIgaW4gd2luZG93KSkge1xyXG4gICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImltZ1wiKS5mb3JFYWNoKGZ1bmN0aW9uIChpbWdFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChpbWdFbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtc3JjXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBsb2FkSW1nKGltZ0VsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHdpbmRvdy52ZGl0b3JJbWFnZUludGVyc2VjdGlvbk9ic2VydmVyKSB7XHJcbiAgICAgICAgd2luZG93LnZkaXRvckltYWdlSW50ZXJzZWN0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xyXG4gICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImltZ1wiKS5mb3JFYWNoKGZ1bmN0aW9uIChpbWdFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy52ZGl0b3JJbWFnZUludGVyc2VjdGlvbk9ic2VydmVyLm9ic2VydmUoaW1nRWxlbWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB3aW5kb3cudmRpdG9ySW1hZ2VJbnRlcnNlY3Rpb25PYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihmdW5jdGlvbiAoZW50cmllcykge1xyXG4gICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZnVuY3Rpb24gKGVudHJpZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCh0eXBlb2YgZW50cmllLmlzSW50ZXJzZWN0aW5nID09PSBcInVuZGVmaW5lZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgPyBlbnRyaWUuaW50ZXJzZWN0aW9uUmF0aW8gIT09IDBcclxuICAgICAgICAgICAgICAgICAgICA6IGVudHJpZS5pc0ludGVyc2VjdGluZylcclxuICAgICAgICAgICAgICAgICAgICAmJiBlbnRyaWUudGFyZ2V0LmdldEF0dHJpYnV0ZShcImRhdGEtc3JjXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZEltZyhlbnRyaWUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW1nXCIpLmZvckVhY2goZnVuY3Rpb24gKGltZ0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgd2luZG93LnZkaXRvckltYWdlSW50ZXJzZWN0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShpbWdFbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuIiwiZXhwb3J0IHZhciBhbmNob3JSZW5kZXIgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi52ZGl0b3ItYW5jaG9yXCIpLmZvckVhY2goZnVuY3Rpb24gKGFuY2hvcikge1xyXG4gICAgICAgIGlmICh0eXBlID09PSAxKSB7XHJcbiAgICAgICAgICAgIGFuY2hvci5jbGFzc0xpc3QuYWRkKFwidmRpdG9yLWFuY2hvci0tbGVmdFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYW5jaG9yLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBpZCA9IGFuY2hvci5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpLnN1YnN0cigxKTtcclxuICAgICAgICAgICAgdmFyIHRvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmRpdG9yQW5jaG9yLVwiICsgaWQpLm9mZnNldFRvcDtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImh0bWxcIikuc2Nyb2xsVG9wID0gdG9wO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZkaXRvckFuY2hvci1cIiArIGRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpKTtcclxuICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5zY3JvbGxUb3AgPSBlbGVtZW50Lm9mZnNldFRvcDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59O1xyXG4iLCJpbXBvcnQgeyBzZXRTZWxlY3Rpb25Gb2N1cyB9IGZyb20gXCIuLi91dGlsL3NlbGVjdGlvblwiO1xyXG5leHBvcnQgdmFyIHNwZWVjaFJlbmRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCBsYW5nKSB7XHJcbiAgICBpZiAobGFuZyA9PT0gdm9pZCAwKSB7IGxhbmcgPSBcInpoX0NOXCI7IH1cclxuICAgIGlmICh0eXBlb2Ygc3BlZWNoU3ludGhlc2lzID09PSBcInVuZGVmaW5lZFwiIHx8IHR5cGVvZiBTcGVlY2hTeW50aGVzaXNVdHRlcmFuY2UgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgcGxheVNWRyA9ICc8c3ZnPjx1c2UgeGxpbms6aHJlZj1cIiN2ZGl0b3ItaWNvbi1wbGF5XCI+PC91c2U+PC9zdmc+JztcclxuICAgIHZhciBwYXVzZVNWRyA9ICc8c3ZnPjx1c2UgeGxpbms6aHJlZj1cIiN2ZGl0b3ItaWNvbi1wYXVzZVwiPjwvdXNlPjwvc3ZnPic7XHJcbiAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmRpdG9ySWNvblNjcmlwdFwiKSkge1xyXG4gICAgICAgIHBsYXlTVkcgPSAnPHN2ZyB2aWV3Qm94PVwiMCAwIDMyIDMyXCI+PHBhdGggZD1cIk0zLjQzNiAwbDI1LjEyOCAxNi0yNS4xMjggMTZ2LTMyelwiPjwvcGF0aD48L3N2Zz4nO1xyXG4gICAgICAgIHBhdXNlU1ZHID0gJzxzdmcgdmlld0JveD1cIjAgMCAzMiAzMlwiPjxwYXRoIGQ9XCJNMjAuNjE3IDBoOS4xMjh2MzJoLTkuMTI4di0zMnpNMi4yNTUgMzJ2LTMyaDkuMTI4djMyaC05LjEyOHpcIj48L3BhdGg+PC9zdmc+JztcclxuICAgIH1cclxuICAgIHZhciBzcGVlY2hEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnZkaXRvci1zcGVlY2hcIik7XHJcbiAgICBpZiAoIXNwZWVjaERvbSkge1xyXG4gICAgICAgIHNwZWVjaERvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgc3BlZWNoRG9tLmNsYXNzTmFtZSA9IFwidmRpdG9yLXNwZWVjaFwiO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFwiYmVmb3JlZW5kXCIsIHNwZWVjaERvbSk7XHJcbiAgICAgICAgdmFyIGdldFZvaWNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdm9pY2VzID0gc3BlZWNoU3ludGhlc2lzLmdldFZvaWNlcygpO1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudFZvaWNlO1xyXG4gICAgICAgICAgICB2YXIgZGVmYXVsdFZvaWNlO1xyXG4gICAgICAgICAgICB2b2ljZXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ubGFuZyA9PT0gbGFuZy5yZXBsYWNlKFwiX1wiLCBcIi1cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Vm9pY2UgPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGVmYXVsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWb2ljZSA9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRWb2ljZSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFZvaWNlID0gZGVmYXVsdFZvaWNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50Vm9pY2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoc3BlZWNoU3ludGhlc2lzLm9udm9pY2VzY2hhbmdlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHNwZWVjaFN5bnRoZXNpcy5vbnZvaWNlc2NoYW5nZWQgPSBnZXRWb2ljZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHZvaWNlXzEgPSBnZXRWb2ljZSgpO1xyXG4gICAgICAgIHNwZWVjaERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoc3BlZWNoRG9tLmNsYXNzTmFtZSA9PT0gXCJ2ZGl0b3Itc3BlZWNoXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciB1dHRlclRoaXMgPSBuZXcgU3BlZWNoU3ludGhlc2lzVXR0ZXJhbmNlKHNwZWVjaERvbS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXRleHRcIikpO1xyXG4gICAgICAgICAgICAgICAgdXR0ZXJUaGlzLnZvaWNlID0gdm9pY2VfMTtcclxuICAgICAgICAgICAgICAgIHV0dGVyVGhpcy5vbmVuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzcGVlY2hEb20uY2xhc3NOYW1lID0gXCJ2ZGl0b3Itc3BlZWNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BlZWNoU3ludGhlc2lzLmNhbmNlbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwZWVjaERvbS5pbm5lckhUTUwgPSBwbGF5U1ZHO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHNwZWVjaFN5bnRoZXNpcy5zcGVhayh1dHRlclRoaXMpO1xyXG4gICAgICAgICAgICAgICAgc3BlZWNoRG9tLmNsYXNzTmFtZSA9IFwidmRpdG9yLXNwZWVjaCB2ZGl0b3Itc3BlZWNoLS1jdXJyZW50XCI7XHJcbiAgICAgICAgICAgICAgICBzcGVlY2hEb20uaW5uZXJIVE1MID0gcGF1c2VTVkc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3BlZWNoU3ludGhlc2lzLnNwZWFraW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWVjaFN5bnRoZXNpcy5wYXVzZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWNoU3ludGhlc2lzLnJlc3VtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVlY2hEb20uaW5uZXJIVE1MID0gcGF1c2VTVkc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVlY2hTeW50aGVzaXMucGF1c2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWNoRG9tLmlubmVySFRNTCA9IHBsYXlTVkc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFNlbGVjdGlvbkZvY3VzKHdpbmRvdy52ZGl0b3JTcGVlY2hSYW5nZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChnZXRTZWxlY3Rpb24oKS50b1N0cmluZygpLnRyaW0oKSA9PT0gXCJcIiAmJiBzcGVlY2hEb20uc3R5bGUuZGlzcGxheSA9PT0gXCJibG9ja1wiKSB7XHJcbiAgICAgICAgICAgICAgICBzcGVlY2hEb20uY2xhc3NOYW1lID0gXCJ2ZGl0b3Itc3BlZWNoXCI7XHJcbiAgICAgICAgICAgICAgICBzcGVlY2hTeW50aGVzaXMuY2FuY2VsKCk7XHJcbiAgICAgICAgICAgICAgICBzcGVlY2hEb20uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciB0ZXh0ID0gZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKS50cmltKCk7XHJcbiAgICAgICAgc3BlZWNoU3ludGhlc2lzLmNhbmNlbCgpO1xyXG4gICAgICAgIGlmIChnZXRTZWxlY3Rpb24oKS50b1N0cmluZygpLnRyaW0oKSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICBpZiAoc3BlZWNoRG9tLnN0eWxlLmRpc3BsYXkgPT09IFwiYmxvY2tcIikge1xyXG4gICAgICAgICAgICAgICAgc3BlZWNoRG9tLmNsYXNzTmFtZSA9IFwidmRpdG9yLXNwZWVjaFwiO1xyXG4gICAgICAgICAgICAgICAgc3BlZWNoRG9tLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdpbmRvdy52ZGl0b3JTcGVlY2hSYW5nZSA9IGdldFNlbGVjdGlvbigpLmdldFJhbmdlQXQoMCkuY2xvbmVSYW5nZSgpO1xyXG4gICAgICAgIHZhciByZWN0ID0gZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBzcGVlY2hEb20uaW5uZXJIVE1MID0gcGxheVNWRztcclxuICAgICAgICBzcGVlY2hEb20uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICBzcGVlY2hEb20uc3R5bGUudG9wID0gKHJlY3QudG9wICsgcmVjdC5oZWlnaHQgKyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaHRtbFwiKS5zY3JvbGxUb3AgLSAyMCkgKyBcInB4XCI7XHJcbiAgICAgICAgc3BlZWNoRG9tLnN0eWxlLmxlZnQgPSAoZXZlbnQuY2xpZW50WCArIDIpICsgXCJweFwiO1xyXG4gICAgICAgIHNwZWVjaERvbS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXRleHRcIiwgdGV4dCk7XHJcbiAgICB9KTtcclxufTtcclxuIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG52YXIgX19nZW5lcmF0b3IgPSAodGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn07XHJcbmltcG9ydCB7IENvbnN0YW50cyB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcclxuaW1wb3J0IHsgc2V0Q29udGVudFRoZW1lIH0gZnJvbSBcIi4uL3VpL3NldENvbnRlbnRUaGVtZVwiO1xyXG5pbXBvcnQgeyBhZGRTY3JpcHQgfSBmcm9tIFwiLi4vdXRpbC9hZGRTY3JpcHRcIjtcclxuaW1wb3J0IHsgaGFzQ2xvc2VzdEJ5Q2xhc3NOYW1lLCBoYXNDbG9zZXN0QnlNYXRjaFRhZyB9IGZyb20gXCIuLi91dGlsL2hhc0Nsb3Nlc3RcIjtcclxuaW1wb3J0IHsgbWVyZ2UgfSBmcm9tIFwiLi4vdXRpbC9tZXJnZVwiO1xyXG5pbXBvcnQgeyBhYmNSZW5kZXIgfSBmcm9tIFwiLi9hYmNSZW5kZXJcIjtcclxuaW1wb3J0IHsgYW5jaG9yUmVuZGVyIH0gZnJvbSBcIi4vYW5jaG9yUmVuZGVyXCI7XHJcbmltcG9ydCB7IGNoYXJ0UmVuZGVyIH0gZnJvbSBcIi4vY2hhcnRSZW5kZXJcIjtcclxuaW1wb3J0IHsgY29kZVJlbmRlciB9IGZyb20gXCIuL2NvZGVSZW5kZXJcIjtcclxuaW1wb3J0IHsgZmxvd2NoYXJ0UmVuZGVyIH0gZnJvbSBcIi4vZmxvd2NoYXJ0UmVuZGVyXCI7XHJcbmltcG9ydCB7IGdyYXBodml6UmVuZGVyIH0gZnJvbSBcIi4vZ3JhcGh2aXpSZW5kZXJcIjtcclxuaW1wb3J0IHsgaGlnaGxpZ2h0UmVuZGVyIH0gZnJvbSBcIi4vaGlnaGxpZ2h0UmVuZGVyXCI7XHJcbmltcG9ydCB7IGxhenlMb2FkSW1hZ2VSZW5kZXIgfSBmcm9tIFwiLi9sYXp5TG9hZEltYWdlUmVuZGVyXCI7XHJcbmltcG9ydCB7IG1hdGhSZW5kZXIgfSBmcm9tIFwiLi9tYXRoUmVuZGVyXCI7XHJcbmltcG9ydCB7IG1lZGlhUmVuZGVyIH0gZnJvbSBcIi4vbWVkaWFSZW5kZXJcIjtcclxuaW1wb3J0IHsgbWVybWFpZFJlbmRlciB9IGZyb20gXCIuL21lcm1haWRSZW5kZXJcIjtcclxuaW1wb3J0IHsgbWFya21hcFJlbmRlciB9IGZyb20gXCIuLi9tYXJrZG93bi9tYXJrbWFwUmVuZGVyXCI7XHJcbmltcG9ydCB7IG1pbmRtYXBSZW5kZXIgfSBmcm9tIFwiLi9taW5kbWFwUmVuZGVyXCI7XHJcbmltcG9ydCB7IHBsYW50dW1sUmVuZGVyIH0gZnJvbSBcIi4vcGxhbnR1bWxSZW5kZXJcIjtcclxuaW1wb3J0IHsgc2V0THV0ZSB9IGZyb20gXCIuL3NldEx1dGVcIjtcclxuaW1wb3J0IHsgc3BlZWNoUmVuZGVyIH0gZnJvbSBcIi4vc3BlZWNoUmVuZGVyXCI7XHJcbnZhciBtZXJnZU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgdmFyIGRlZmF1bHRPcHRpb24gPSB7XHJcbiAgICAgICAgYW5jaG9yOiAwLFxyXG4gICAgICAgIGNkbjogQ29uc3RhbnRzLkNETixcclxuICAgICAgICBkaXN0OiBDb25zdGFudHMuRElTVCxcclxuICAgICAgICBzdGF0aWNQYXRoOiBDb25zdGFudHMuU1RBVElDX1BBVEgsXHJcbiAgICAgICAgY3VzdG9tRW1vamk6IHt9LFxyXG4gICAgICAgIGVtb2ppUGF0aDogKChvcHRpb25zICYmIG9wdGlvbnMuZW1vamlQYXRoKSB8fCBDb25zdGFudHMuQ0ROKSArIFwiL1wiICsgQ29uc3RhbnRzLkRJU1QgKyBcIi9cIiArIENvbnN0YW50cy5fU1RBVElDX1BBVEguZW1vamksXHJcbiAgICAgICAgaGxqczogQ29uc3RhbnRzLkhMSlNfT1BUSU9OUyxcclxuICAgICAgICBpY29uOiBcImFudFwiLFxyXG4gICAgICAgIGxhbmc6IFwiemhfQ05cIixcclxuICAgICAgICBtYXJrZG93bjogQ29uc3RhbnRzLk1BUktET1dOX09QVElPTlMsXHJcbiAgICAgICAgbWF0aDogQ29uc3RhbnRzLk1BVEhfT1BUSU9OUyxcclxuICAgICAgICBtb2RlOiBcImxpZ2h0XCIsXHJcbiAgICAgICAgc3BlZWNoOiB7XHJcbiAgICAgICAgICAgIGVuYWJsZTogZmFsc2UsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aGVtZTogQ29uc3RhbnRzLlRIRU1FX09QVElPTlMsXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG1lcmdlKGRlZmF1bHRPcHRpb24sIG9wdGlvbnMpO1xyXG59O1xyXG5leHBvcnQgdmFyIG1kMmh0bWwgPSBmdW5jdGlvbiAobWRUZXh0LCBvcHRpb25zKSB7XHJcbiAgICB2YXIgbWVyZ2VkT3B0aW9ucyA9IG1lcmdlT3B0aW9ucyhvcHRpb25zKTtcclxuICAgIHJldHVybiBhZGRTY3JpcHQobWVyZ2VkT3B0aW9ucy5zdGF0aWNQYXRoLmx1dGUsIFwidmRpdG9yTHV0ZVNjcmlwdFwiKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgbHV0ZSA9IHNldEx1dGUoe1xyXG4gICAgICAgICAgICBhdXRvU3BhY2U6IG1lcmdlZE9wdGlvbnMubWFya2Rvd24uYXV0b1NwYWNlLFxyXG4gICAgICAgICAgICBnZm1BdXRvTGluazogbWVyZ2VkT3B0aW9ucy5tYXJrZG93bi5nZm1BdXRvTGluayxcclxuICAgICAgICAgICAgY29kZUJsb2NrUHJldmlldzogbWVyZ2VkT3B0aW9ucy5tYXJrZG93bi5jb2RlQmxvY2tQcmV2aWV3LFxyXG4gICAgICAgICAgICBlbW9qaVNpdGU6IG1lcmdlZE9wdGlvbnMuZW1vamlQYXRoLFxyXG4gICAgICAgICAgICBlbW9qaXM6IG1lcmdlZE9wdGlvbnMuY3VzdG9tRW1vamksXHJcbiAgICAgICAgICAgIGZpeFRlcm1UeXBvOiBtZXJnZWRPcHRpb25zLm1hcmtkb3duLmZpeFRlcm1UeXBvLFxyXG4gICAgICAgICAgICBmb290bm90ZXM6IG1lcmdlZE9wdGlvbnMubWFya2Rvd24uZm9vdG5vdGVzLFxyXG4gICAgICAgICAgICBoZWFkaW5nQW5jaG9yOiBtZXJnZWRPcHRpb25zLmFuY2hvciAhPT0gMCxcclxuICAgICAgICAgICAgaW5saW5lTWF0aERpZ2l0OiBtZXJnZWRPcHRpb25zLm1hdGguaW5saW5lRGlnaXQsXHJcbiAgICAgICAgICAgIGxhenlMb2FkSW1hZ2U6IG1lcmdlZE9wdGlvbnMubGF6eUxvYWRJbWFnZSxcclxuICAgICAgICAgICAgbGlua0Jhc2U6IG1lcmdlZE9wdGlvbnMubWFya2Rvd24ubGlua0Jhc2UsXHJcbiAgICAgICAgICAgIGxpbmtQcmVmaXg6IG1lcmdlZE9wdGlvbnMubWFya2Rvd24ubGlua1ByZWZpeCxcclxuICAgICAgICAgICAgbGlzdFN0eWxlOiBtZXJnZWRPcHRpb25zLm1hcmtkb3duLmxpc3RTdHlsZSxcclxuICAgICAgICAgICAgbWFyazogbWVyZ2VkT3B0aW9ucy5tYXJrZG93bi5tYXJrLFxyXG4gICAgICAgICAgICBtYXRoQmxvY2tQcmV2aWV3OiBtZXJnZWRPcHRpb25zLm1hcmtkb3duLm1hdGhCbG9ja1ByZXZpZXcsXHJcbiAgICAgICAgICAgIHBhcmFncmFwaEJlZ2lubmluZ1NwYWNlOiBtZXJnZWRPcHRpb25zLm1hcmtkb3duLnBhcmFncmFwaEJlZ2lubmluZ1NwYWNlLFxyXG4gICAgICAgICAgICBzYW5pdGl6ZTogbWVyZ2VkT3B0aW9ucy5tYXJrZG93bi5zYW5pdGl6ZSxcclxuICAgICAgICAgICAgdG9jOiBtZXJnZWRPcHRpb25zLm1hcmtkb3duLnRvYyxcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnJlbmRlcmVycykge1xyXG4gICAgICAgICAgICBsdXRlLlNldEpTUmVuZGVyZXJzKHtcclxuICAgICAgICAgICAgICAgIHJlbmRlcmVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgIE1kMkhUTUw6IG9wdGlvbnMucmVuZGVyZXJzLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGx1dGUuU2V0SGVhZGluZ0lEKHRydWUpO1xyXG4gICAgICAgIHJldHVybiBsdXRlLk1kMkhUTUwobWRUZXh0KTtcclxuICAgIH0pO1xyXG59O1xyXG5leHBvcnQgdmFyIHByZXZpZXdSZW5kZXIgPSBmdW5jdGlvbiAocHJldmlld0VsZW1lbnQsIG1hcmtkb3duLCBvcHRpb25zKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1lcmdlZE9wdGlvbnMsIGh0bWwsIGkxOG5TY3JpcHRQcmVmaXgsIGkxOG5TY3JpcHRJRF8xO1xyXG4gICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcclxuICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgbWVyZ2VkT3B0aW9ucyA9IG1lcmdlT3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG1kMmh0bWwobWFya2Rvd24sIG1lcmdlZE9wdGlvbnMpXTtcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgaHRtbCA9IF9hLnNlbnQoKTtcclxuICAgICAgICAgICAgICAgIGlmIChtZXJnZWRPcHRpb25zLnRyYW5zZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGh0bWwgPSBtZXJnZWRPcHRpb25zLnRyYW5zZm9ybShodG1sKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHByZXZpZXdFbGVtZW50LmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICAgICAgICAgICAgICBwcmV2aWV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidmRpdG9yLXJlc2V0XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEhbWVyZ2VkT3B0aW9ucy5pMThuKSByZXR1cm4gWzMgLypicmVhayovLCA1XTtcclxuICAgICAgICAgICAgICAgIGlmICghIVtcImVuX1VTXCIsIFwiZnJfRlJcIiwgXCJwdF9CUlwiLCBcImphX0pQXCIsIFwia29fS1JcIiwgXCJydV9SVVwiLCBcInN2X1NFXCIsIFwiemhfQ05cIiwgXCJ6aF9UV1wiXS5pbmNsdWRlcyhtZXJnZWRPcHRpb25zLmxhbmcpKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIm9wdGlvbnMubGFuZyBlcnJvciwgc2VlIGh0dHBzOi8vbGQyNDYuY29tL2FydGljbGUvMTU0OTYzODc0NTYzMCNvcHRpb25zXCIpO1xyXG4gICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICBpMThuU2NyaXB0UHJlZml4ID0gXCJ2ZGl0b3JJMThuU2NyaXB0XCI7XHJcbiAgICAgICAgICAgICAgICBpMThuU2NyaXB0SURfMSA9IGkxOG5TY3JpcHRQcmVmaXggKyBtZXJnZWRPcHRpb25zLmxhbmc7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaGVhZCBzY3JpcHRbaWRePVxcXCJcIiArIGkxOG5TY3JpcHRQcmVmaXggKyBcIlxcXCJdXCIpLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmlkICE9PSBpMThuU2NyaXB0SURfMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLnJlbW92ZUNoaWxkKGVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFkZFNjcmlwdChtZXJnZWRPcHRpb25zLnN0YXRpY1BhdGguaTE4biArIFwiL1wiICsgbWVyZ2VkT3B0aW9ucy5sYW5nICsgXCIuanNcIiwgaTE4blNjcmlwdElEXzEpXTtcclxuICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgX2EubGFiZWwgPSA0O1xyXG4gICAgICAgICAgICBjYXNlIDQ6IHJldHVybiBbMyAvKmJyZWFrKi8sIDZdO1xyXG4gICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cuVmRpdG9ySTE4biA9IG1lcmdlZE9wdGlvbnMuaTE4bjtcclxuICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gNjtcclxuICAgICAgICAgICAgY2FzZSA2OlxyXG4gICAgICAgICAgICAgICAgaWYgKCFtZXJnZWRPcHRpb25zLmljb24pIHJldHVybiBbMyAvKmJyZWFrKi8sIDhdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYWRkU2NyaXB0KG1lcmdlZE9wdGlvbnMuc3RhdGljUGF0aC5pY29ucyArIFwiL1wiICsgbWVyZ2VkT3B0aW9ucy5pY29uICsgXCIuanNcIiwgXCJ2ZGl0b3JJY29uU2NyaXB0XCIpXTtcclxuICAgICAgICAgICAgY2FzZSA3OlxyXG4gICAgICAgICAgICAgICAgX2Euc2VudCgpO1xyXG4gICAgICAgICAgICAgICAgX2EubGFiZWwgPSA4O1xyXG4gICAgICAgICAgICBjYXNlIDg6XHJcbiAgICAgICAgICAgICAgICBzZXRDb250ZW50VGhlbWUobWVyZ2VkT3B0aW9ucy50aGVtZS5jdXJyZW50LCBtZXJnZWRPcHRpb25zLnRoZW1lLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1lcmdlZE9wdGlvbnMuYW5jaG9yID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJldmlld0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcInZkaXRvci1yZXNldC0tYW5jaG9yXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29kZVJlbmRlcihwcmV2aWV3RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRSZW5kZXIobWVyZ2VkT3B0aW9ucy5obGpzLCBwcmV2aWV3RWxlbWVudCwgbWVyZ2VkT3B0aW9ucy5zdGF0aWNQYXRoLmhpZ2hsaWdodCk7XHJcbiAgICAgICAgICAgICAgICBtYXRoUmVuZGVyKHByZXZpZXdFbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAga2F0ZXg6IG1lcmdlZE9wdGlvbnMuc3RhdGljUGF0aC5rYXRleCxcclxuICAgICAgICAgICAgICAgICAgICBtYXRoamF4OiBtZXJnZWRPcHRpb25zLnN0YXRpY1BhdGgubWF0aGpheCxcclxuICAgICAgICAgICAgICAgICAgICBtYXRoOiBtZXJnZWRPcHRpb25zLm1hdGgsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIG1lcm1haWRSZW5kZXIocHJldmlld0VsZW1lbnQsIG1lcmdlZE9wdGlvbnMuc3RhdGljUGF0aC5tZXJtYWlkLCBtZXJnZWRPcHRpb25zLm1vZGUpO1xyXG4gICAgICAgICAgICAgICAgbWFya21hcFJlbmRlcihwcmV2aWV3RWxlbWVudCwgbWVyZ2VkT3B0aW9ucy5zdGF0aWNQYXRoLm1hcmttYXAsIG1lcmdlZE9wdGlvbnMubW9kZSk7XHJcbiAgICAgICAgICAgICAgICBmbG93Y2hhcnRSZW5kZXIocHJldmlld0VsZW1lbnQsIG1lcmdlZE9wdGlvbnMuc3RhdGljUGF0aC5mbG93Y2hhcnQpO1xyXG4gICAgICAgICAgICAgICAgZ3JhcGh2aXpSZW5kZXIocHJldmlld0VsZW1lbnQsIG1lcmdlZE9wdGlvbnMuc3RhdGljUGF0aC5ncmFwaHZpeik7XHJcbiAgICAgICAgICAgICAgICBjaGFydFJlbmRlcihwcmV2aWV3RWxlbWVudCwgbWVyZ2VkT3B0aW9ucy5zdGF0aWNQYXRoLmVjaGFydHMsIG1lcmdlZE9wdGlvbnMubW9kZSk7XHJcbiAgICAgICAgICAgICAgICBtaW5kbWFwUmVuZGVyKHByZXZpZXdFbGVtZW50LCBtZXJnZWRPcHRpb25zLnN0YXRpY1BhdGguZWNoYXJ0cywgbWVyZ2VkT3B0aW9ucy5tb2RlKTtcclxuICAgICAgICAgICAgICAgIHBsYW50dW1sUmVuZGVyKHByZXZpZXdFbGVtZW50LCBtZXJnZWRPcHRpb25zLnN0YXRpY1BhdGgucGxhbnR1bWwpO1xyXG4gICAgICAgICAgICAgICAgYWJjUmVuZGVyKHByZXZpZXdFbGVtZW50LCBtZXJnZWRPcHRpb25zLnN0YXRpY1BhdGguYWJjKTtcclxuICAgICAgICAgICAgICAgIG1lZGlhUmVuZGVyKHByZXZpZXdFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGlmIChtZXJnZWRPcHRpb25zLnNwZWVjaC5lbmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzcGVlY2hSZW5kZXIocHJldmlld0VsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG1lcmdlZE9wdGlvbnMuYW5jaG9yICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5jaG9yUmVuZGVyKG1lcmdlZE9wdGlvbnMuYW5jaG9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChtZXJnZWRPcHRpb25zLmFmdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VkT3B0aW9ucy5hZnRlcigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG1lcmdlZE9wdGlvbnMubGF6eUxvYWRJbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhenlMb2FkSW1hZ2VSZW5kZXIocHJldmlld0VsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcHJldmlld0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzcGFuRWxlbWVudCA9IGhhc0Nsb3Nlc3RCeU1hdGNoVGFnKGV2ZW50LnRhcmdldCwgXCJTUEFOXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGFuRWxlbWVudCAmJiBoYXNDbG9zZXN0QnlDbGFzc05hbWUoc3BhbkVsZW1lbnQsIFwidmRpdG9yLXRvY1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZGluZ0VsZW1lbnQgPSBwcmV2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI1wiICsgc3BhbkVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS10YXJnZXQtaWRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGVhZGluZ0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh3aW5kb3cuc2Nyb2xsWCwgaGVhZGluZ0VsZW1lbnQub2Zmc2V0VG9wKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pOyB9O1xyXG4iLCJpbXBvcnQgeyBhYmNSZW5kZXIgfSBmcm9tIFwiLi90cy9tYXJrZG93bi9hYmNSZW5kZXJcIjtcclxuaW1wb3J0ICogYXMgYWRhcHRlclJlbmRlciBmcm9tIFwiLi90cy9tYXJrZG93bi9hZGFwdGVyUmVuZGVyXCI7XHJcbmltcG9ydCB7IGNoYXJ0UmVuZGVyIH0gZnJvbSBcIi4vdHMvbWFya2Rvd24vY2hhcnRSZW5kZXJcIjtcclxuaW1wb3J0IHsgY29kZVJlbmRlciB9IGZyb20gXCIuL3RzL21hcmtkb3duL2NvZGVSZW5kZXJcIjtcclxuaW1wb3J0IHsgZmxvd2NoYXJ0UmVuZGVyIH0gZnJvbSBcIi4vdHMvbWFya2Rvd24vZmxvd2NoYXJ0UmVuZGVyXCI7XHJcbmltcG9ydCB7IGdyYXBodml6UmVuZGVyIH0gZnJvbSBcIi4vdHMvbWFya2Rvd24vZ3JhcGh2aXpSZW5kZXJcIjtcclxuaW1wb3J0IHsgaGlnaGxpZ2h0UmVuZGVyIH0gZnJvbSBcIi4vdHMvbWFya2Rvd24vaGlnaGxpZ2h0UmVuZGVyXCI7XHJcbmltcG9ydCB7IGxhenlMb2FkSW1hZ2VSZW5kZXIgfSBmcm9tIFwiLi90cy9tYXJrZG93bi9sYXp5TG9hZEltYWdlUmVuZGVyXCI7XHJcbmltcG9ydCB7IG1hdGhSZW5kZXIgfSBmcm9tIFwiLi90cy9tYXJrZG93bi9tYXRoUmVuZGVyXCI7XHJcbmltcG9ydCB7IG1lZGlhUmVuZGVyIH0gZnJvbSBcIi4vdHMvbWFya2Rvd24vbWVkaWFSZW5kZXJcIjtcclxuaW1wb3J0IHsgbWVybWFpZFJlbmRlciB9IGZyb20gXCIuL3RzL21hcmtkb3duL21lcm1haWRSZW5kZXJcIjtcclxuaW1wb3J0IHsgbWFya21hcFJlbmRlciB9IGZyb20gXCIuL3RzL21hcmtkb3duL21hcmttYXBSZW5kZXJcIjtcclxuaW1wb3J0IHsgbWluZG1hcFJlbmRlciB9IGZyb20gXCIuL3RzL21hcmtkb3duL21pbmRtYXBSZW5kZXJcIjtcclxuaW1wb3J0IHsgb3V0bGluZVJlbmRlciB9IGZyb20gXCIuL3RzL21hcmtkb3duL291dGxpbmVSZW5kZXJcIjtcclxuaW1wb3J0IHsgcGxhbnR1bWxSZW5kZXIgfSBmcm9tIFwiLi90cy9tYXJrZG93bi9wbGFudHVtbFJlbmRlclwiO1xyXG5pbXBvcnQgeyBtZDJodG1sLCBwcmV2aWV3UmVuZGVyIH0gZnJvbSBcIi4vdHMvbWFya2Rvd24vcHJldmlld1JlbmRlclwiO1xyXG5pbXBvcnQgeyBzcGVlY2hSZW5kZXIgfSBmcm9tIFwiLi90cy9tYXJrZG93bi9zcGVlY2hSZW5kZXJcIjtcclxuaW1wb3J0IHsgcHJldmlld0ltYWdlIH0gZnJvbSBcIi4vdHMvcHJldmlldy9pbWFnZVwiO1xyXG5pbXBvcnQgeyBzZXRDb2RlVGhlbWUgfSBmcm9tIFwiLi90cy91aS9zZXRDb2RlVGhlbWVcIjtcclxuaW1wb3J0IHsgc2V0Q29udGVudFRoZW1lIH0gZnJvbSBcIi4vdHMvdWkvc2V0Q29udGVudFRoZW1lXCI7XHJcbnZhciBWZGl0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWZGl0b3IoKSB7XHJcbiAgICB9XHJcbiAgICAvKiog54K55Ye75Zu+54mH5pS+5aSnICovXHJcbiAgICBWZGl0b3IuYWRhcHRlclJlbmRlciA9IGFkYXB0ZXJSZW5kZXI7XHJcbiAgICAvKiog54K55Ye75Zu+54mH5pS+5aSnICovXHJcbiAgICBWZGl0b3IucHJldmlld0ltYWdlID0gcHJldmlld0ltYWdlO1xyXG4gICAgLyoqIOS4uiBlbGVtZW50IOS4reeahOS7o+eggeWdl+a3u+WKoOWkjeWItuaMiemSriAqL1xyXG4gICAgVmRpdG9yLmNvZGVSZW5kZXIgPSBjb2RlUmVuZGVyO1xyXG4gICAgLyoqIOWvuSBncmFwaHZpeiDov5vooYzmuLLmn5MgKi9cclxuICAgIFZkaXRvci5ncmFwaHZpelJlbmRlciA9IGdyYXBodml6UmVuZGVyO1xyXG4gICAgLyoqIOS4uiBlbGVtZW50IOS4reeahOS7o+eggeWdl+i/m+ihjOmrmOS6rua4suafkyAqL1xyXG4gICAgVmRpdG9yLmhpZ2hsaWdodFJlbmRlciA9IGhpZ2hsaWdodFJlbmRlcjtcclxuICAgIC8qKiDlr7nmlbDlrablhazlvI/ov5vooYzmuLLmn5MgKi9cclxuICAgIFZkaXRvci5tYXRoUmVuZGVyID0gbWF0aFJlbmRlcjtcclxuICAgIC8qKiDmtYHnqIvlm74v5pe25bqP5Zu+L+eUmOeJueWbvua4suafkyAqL1xyXG4gICAgVmRpdG9yLm1lcm1haWRSZW5kZXIgPSBtZXJtYWlkUmVuZGVyO1xyXG4gICAgLyoqIOaUr+aMgW1hcmtkb3du55qE5oCd57u05a+85Zu+ICovXHJcbiAgICBWZGl0b3IubWFya21hcFJlbmRlciA9IG1hcmttYXBSZW5kZXI7XHJcbiAgICAvKiogZmxvd2NoYXJ0LmpzIOa4suafkyAqL1xyXG4gICAgVmRpdG9yLmZsb3djaGFydFJlbmRlciA9IGZsb3djaGFydFJlbmRlcjtcclxuICAgIC8qKiDlm77ooajmuLLmn5MgKi9cclxuICAgIFZkaXRvci5jaGFydFJlbmRlciA9IGNoYXJ0UmVuZGVyO1xyXG4gICAgLyoqIOS6lOe6v+iwsea4suafkyAqL1xyXG4gICAgVmRpdG9yLmFiY1JlbmRlciA9IGFiY1JlbmRlcjtcclxuICAgIC8qKiDohJHlm77muLLmn5MgKi9cclxuICAgIFZkaXRvci5taW5kbWFwUmVuZGVyID0gbWluZG1hcFJlbmRlcjtcclxuICAgIC8qKiBwbGFudHVtbOa4suafkyAqL1xyXG4gICAgVmRpdG9yLnBsYW50dW1sUmVuZGVyID0gcGxhbnR1bWxSZW5kZXI7XHJcbiAgICAvKiog5aSn57qy5riy5p+TICovXHJcbiAgICBWZGl0b3Iub3V0bGluZVJlbmRlciA9IG91dGxpbmVSZW5kZXI7XHJcbiAgICAvKiog5Li6W+eJueWumumTvuaOpV0oaHR0cHM6Ly9naXRodWIuY29tL1ZhbmVzc2EyMTkvdmRpdG9yL2lzc3Vlcy83KeWIhuWIq+a4suafk+S4uuinhumikeOAgemfs+mikeOAgeW1jOWFpeeahCBpZnJhbWUgKi9cclxuICAgIFZkaXRvci5tZWRpYVJlbmRlciA9IG1lZGlhUmVuZGVyO1xyXG4gICAgLyoqIOWvuemAieS4reeahOaWh+Wtl+i/m+ihjOmYheivuyAqL1xyXG4gICAgVmRpdG9yLnNwZWVjaFJlbmRlciA9IHNwZWVjaFJlbmRlcjtcclxuICAgIC8qKiDlr7nlm77niYfov5vooYzmh5LliqDovb0gKi9cclxuICAgIFZkaXRvci5sYXp5TG9hZEltYWdlUmVuZGVyID0gbGF6eUxvYWRJbWFnZVJlbmRlcjtcclxuICAgIC8qKiBNYXJrZG93biDmlofmnKzovazmjaLkuLogSFRNTO+8jOivpeaWueazlemcgOS9v+eUqFvlvILmraXnvJbnqItdKGh0dHBzOi8vbGQyNDYuY29tL2FydGljbGUvMTU0NjgyODQzNDA4Mz9yPVZhbmVzcykgKi9cclxuICAgIFZkaXRvci5tZDJodG1sID0gbWQyaHRtbDtcclxuICAgIC8qKiDpobXpnaIgTWFya2Rvd24g5paH56ug5riy5p+TICovXHJcbiAgICBWZGl0b3IucHJldmlldyA9IHByZXZpZXdSZW5kZXI7XHJcbiAgICAvKiog6K6+572u5Luj56CB5Li76aKYICovXHJcbiAgICBWZGl0b3Iuc2V0Q29kZVRoZW1lID0gc2V0Q29kZVRoZW1lO1xyXG4gICAgLyoqIOiuvue9ruWGheWuueS4u+mimCAqL1xyXG4gICAgVmRpdG9yLnNldENvbnRlbnRUaGVtZSA9IHNldENvbnRlbnRUaGVtZTtcclxuICAgIHJldHVybiBWZGl0b3I7XHJcbn0oKSk7XHJcbmV4cG9ydCBkZWZhdWx0IFZkaXRvcjtcclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9